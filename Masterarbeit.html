<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-08-31">

<title>Master Thesis Lina Becker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Masterarbeit_files/libs/clipboard/clipboard.min.js"></script>
<script src="Masterarbeit_files/libs/quarto-html/quarto.js"></script>
<script src="Masterarbeit_files/libs/quarto-html/popper.min.js"></script>
<script src="Masterarbeit_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Masterarbeit_files/libs/quarto-html/anchor.min.js"></script>
<link href="Masterarbeit_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Masterarbeit_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Masterarbeit_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Masterarbeit_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Masterarbeit_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#install-and-load-packages" id="toc-install-and-load-packages" class="nav-link active" data-scroll-target="#install-and-load-packages">Install and Load Packages</a></li>
  <li><a href="#data-reading" id="toc-data-reading" class="nav-link" data-scroll-target="#data-reading">Data Reading</a></li>
  <li><a href="#data-cleaning" id="toc-data-cleaning" class="nav-link" data-scroll-target="#data-cleaning">Data Cleaning</a>
  <ul>
  <li><a href="#missings" id="toc-missings" class="nav-link" data-scroll-target="#missings">Missings</a></li>
  <li><a href="#duplicates" id="toc-duplicates" class="nav-link" data-scroll-target="#duplicates">Duplicates</a>
  <ul class="collapse">
  <li><a href="#identicalexact-duplicates" id="toc-identicalexact-duplicates" class="nav-link" data-scroll-target="#identicalexact-duplicates">Identical/Exact Duplicates</a></li>
  <li><a href="#duplicates-with-same-serial.number-but-different-glucose-value" id="toc-duplicates-with-same-serial.number-but-different-glucose-value" class="nav-link" data-scroll-target="#duplicates-with-same-serial.number-but-different-glucose-value">Duplicates with Same Serial.Number but Different Glucose Value</a></li>
  <li><a href="#duplicates-with-different-serial.number-but-same-glucose-value" id="toc-duplicates-with-different-serial.number-but-same-glucose-value" class="nav-link" data-scroll-target="#duplicates-with-different-serial.number-but-same-glucose-value">Duplicates with different Serial.Number but same glucose value</a></li>
  </ul></li>
  <li><a href="#irregular-timestamps-less-than-4min-more-than-6min" id="toc-irregular-timestamps-less-than-4min-more-than-6min" class="nav-link" data-scroll-target="#irregular-timestamps-less-than-4min-more-than-6min">Irregular Timestamps: Less than 4min, more than 6min</a>
  <ul class="collapse">
  <li><a href="#gaps-more-than-6min" id="toc-gaps-more-than-6min" class="nav-link" data-scroll-target="#gaps-more-than-6min">Gaps: more than 6min</a></li>
  <li><a href="#gaps-between-1-and-3min" id="toc-gaps-between-1-and-3min" class="nav-link" data-scroll-target="#gaps-between-1-and-3min">Gaps: between 1 and 3min</a></li>
  <li><a href="#plotting-those-timegaps" id="toc-plotting-those-timegaps" class="nav-link" data-scroll-target="#plotting-those-timegaps">Plotting those Timegaps</a></li>
  </ul></li>
  <li><a href="#serial-numbers" id="toc-serial-numbers" class="nav-link" data-scroll-target="#serial-numbers">Serial Numbers</a></li>
  <li><a href="#create-dataset-without-duplicates" id="toc-create-dataset-without-duplicates" class="nav-link" data-scroll-target="#create-dataset-without-duplicates">Create Dataset without Duplicates</a></li>
  <li><a href="#missings-in-duplicated-dataset" id="toc-missings-in-duplicated-dataset" class="nav-link" data-scroll-target="#missings-in-duplicated-dataset">Missings in Duplicated Dataset</a></li>
  </ul></li>
  <li><a href="#time-in-range" id="toc-time-in-range" class="nav-link" data-scroll-target="#time-in-range">Time in range</a>
  <ul>
  <li><a href="#general-overview-on-hyper-and-hypo-glucose-per-id" id="toc-general-overview-on-hyper-and-hypo-glucose-per-id" class="nav-link" data-scroll-target="#general-overview-on-hyper-and-hypo-glucose-per-id">General overview on hyper and hypo glucose per ID</a></li>
  <li><a href="#hyper-and-hypo-in-day-and-night" id="toc-hyper-and-hypo-in-day-and-night" class="nav-link" data-scroll-target="#hyper-and-hypo-in-day-and-night">Hyper and Hypo in Day and Night</a></li>
  <li><a href="#create-a-graph" id="toc-create-a-graph" class="nav-link" data-scroll-target="#create-a-graph">Create a Graph</a></li>
  <li><a href="#stacked-chart" id="toc-stacked-chart" class="nav-link" data-scroll-target="#stacked-chart">Stacked Chart</a></li>
  <li><a href="#improved-visualization-of-high-low-and-very-low" id="toc-improved-visualization-of-high-low-and-very-low" class="nav-link" data-scroll-target="#improved-visualization-of-high-low-and-very-low">Improved visualization of High, Low and Very Low</a></li>
  </ul></li>
  <li><a href="#spike-analysis" id="toc-spike-analysis" class="nav-link" data-scroll-target="#spike-analysis">Spike Analysis</a>
  <ul>
  <li><a href="#category-change" id="toc-category-change" class="nav-link" data-scroll-target="#category-change">Category Change</a></li>
  <li><a href="#spike-duration" id="toc-spike-duration" class="nav-link" data-scroll-target="#spike-duration">Spike Duration</a></li>
  </ul></li>
  <li><a href="#day-and-night-analysis" id="toc-day-and-night-analysis" class="nav-link" data-scroll-target="#day-and-night-analysis">Day and Night Analysis</a>
  <ul>
  <li><a href="#defining-day-and-night" id="toc-defining-day-and-night" class="nav-link" data-scroll-target="#defining-day-and-night">Defining Day and Night</a></li>
  <li><a href="#plotting-day-vs-night" id="toc-plotting-day-vs-night" class="nav-link" data-scroll-target="#plotting-day-vs-night">Plotting Day vs Night</a></li>
  <li><a href="#nighttime-glucose-hourly-bins" id="toc-nighttime-glucose-hourly-bins" class="nav-link" data-scroll-target="#nighttime-glucose-hourly-bins">Nighttime Glucose: Hourly Bins</a></li>
  <li><a href="#nighttime-glucose-5min-bins" id="toc-nighttime-glucose-5min-bins" class="nav-link" data-scroll-target="#nighttime-glucose-5min-bins">Nighttime Glucose: 5min bins</a></li>
  <li><a href="#create-a-double-plot" id="toc-create-a-double-plot" class="nav-link" data-scroll-target="#create-a-double-plot">Create a double plot</a></li>
  </ul></li>
  <li><a href="#cosine-fit" id="toc-cosine-fit" class="nav-link" data-scroll-target="#cosine-fit">Cosine fit</a>
  <ul>
  <li><a href="#first-fit-for-every-id" id="toc-first-fit-for-every-id" class="nav-link" data-scroll-target="#first-fit-for-every-id">First fit for every ID</a></li>
  <li><a href="#cosinus-fit-with-cosinor" id="toc-cosinus-fit-with-cosinor" class="nav-link" data-scroll-target="#cosinus-fit-with-cosinor">Cosinus Fit with Cosinor()</a></li>
  <li><a href="#manual-cosine-fit" id="toc-manual-cosine-fit" class="nav-link" data-scroll-target="#manual-cosine-fit">Manual Cosine fit</a></li>
  <li><a href="#comparison-of-outputs-of-the-different-fits" id="toc-comparison-of-outputs-of-the-different-fits" class="nav-link" data-scroll-target="#comparison-of-outputs-of-the-different-fits">Comparison of outputs of the different fits</a></li>
  <li><a href="#trouble-shooting-cosine-fit" id="toc-trouble-shooting-cosine-fit" class="nav-link" data-scroll-target="#trouble-shooting-cosine-fit">Trouble Shooting: Cosine Fit</a></li>
  <li><a href="#cosine-fit-with-lm" id="toc-cosine-fit-with-lm" class="nav-link" data-scroll-target="#cosine-fit-with-lm">Cosine fit with lm()</a></li>
  <li><a href="#moving-window" id="toc-moving-window" class="nav-link" data-scroll-target="#moving-window">Moving window</a>
  <ul class="collapse">
  <li><a href="#moving-window-with-cosinor.lm" id="toc-moving-window-with-cosinor.lm" class="nav-link" data-scroll-target="#moving-window-with-cosinor.lm">Moving Window with cosinor.lm()</a></li>
  <li><a href="#moving-window-with-lm" id="toc-moving-window-with-lm" class="nav-link" data-scroll-target="#moving-window-with-lm">Moving Window with lm()</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#seasonal-analysis" id="toc-seasonal-analysis" class="nav-link" data-scroll-target="#seasonal-analysis">Seasonal Analysis</a>
  <ul>
  <li><a href="#acrophase-linear-mixed-effects-model-standard-time" id="toc-acrophase-linear-mixed-effects-model-standard-time" class="nav-link" data-scroll-target="#acrophase-linear-mixed-effects-model-standard-time">Acrophase: Linear Mixed Effects Model Standard Time</a></li>
  <li><a href="#amplitude-linear-mixed-effects-model-standard-time" id="toc-amplitude-linear-mixed-effects-model-standard-time" class="nav-link" data-scroll-target="#amplitude-linear-mixed-effects-model-standard-time">Amplitude: Linear Mixed Effects Model Standard Time</a></li>
  <li><a href="#intercept-linear-mixed-effects-model-standard-time" id="toc-intercept-linear-mixed-effects-model-standard-time" class="nav-link" data-scroll-target="#intercept-linear-mixed-effects-model-standard-time">Intercept: Linear Mixed Effects Model Standard Time</a></li>
  <li><a href="#acrophase-linear-mixed-effects-model-daylight-saving-time" id="toc-acrophase-linear-mixed-effects-model-daylight-saving-time" class="nav-link" data-scroll-target="#acrophase-linear-mixed-effects-model-daylight-saving-time">Acrophase: Linear Mixed Effects Model Daylight Saving Time</a></li>
  <li><a href="#amplitude-linear-mixed-effects-model-daylight-saving-time" id="toc-amplitude-linear-mixed-effects-model-daylight-saving-time" class="nav-link" data-scroll-target="#amplitude-linear-mixed-effects-model-daylight-saving-time">Amplitude: Linear Mixed Effects Model Daylight Saving Time</a></li>
  <li><a href="#intercept-linear-mixed-effects-model-daylight-saving-time" id="toc-intercept-linear-mixed-effects-model-daylight-saving-time" class="nav-link" data-scroll-target="#intercept-linear-mixed-effects-model-daylight-saving-time">Intercept: Linear Mixed Effects Model Daylight Saving Time</a></li>
  <li><a href="#polar-plots" id="toc-polar-plots" class="nav-link" data-scroll-target="#polar-plots">Polar Plots</a>
  <ul class="collapse">
  <li><a href="#polar-plot-for-acrophase-for-all-ids" id="toc-polar-plot-for-acrophase-for-all-ids" class="nav-link" data-scroll-target="#polar-plot-for-acrophase-for-all-ids">Polar Plot for Acrophase for all IDs</a></li>
  <li><a href="#polar-plot-of-all-ids-with-seasons" id="toc-polar-plot-of-all-ids-with-seasons" class="nav-link" data-scroll-target="#polar-plot-of-all-ids-with-seasons">Polar Plot of all IDs with Seasons</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#photoperiod-analysis" id="toc-photoperiod-analysis" class="nav-link" data-scroll-target="#photoperiod-analysis">Photoperiod Analysis</a>
  <ul>
  <li><a href="#acrophase-linear-mixed-model" id="toc-acrophase-linear-mixed-model" class="nav-link" data-scroll-target="#acrophase-linear-mixed-model">Acrophase: Linear Mixed Model</a></li>
  <li><a href="#amplitude-linear-mixed-model" id="toc-amplitude-linear-mixed-model" class="nav-link" data-scroll-target="#amplitude-linear-mixed-model">Amplitude: Linear Mixed Model</a></li>
  <li><a href="#intercept-linear-mixed-model" id="toc-intercept-linear-mixed-model" class="nav-link" data-scroll-target="#intercept-linear-mixed-model">Intercept: Linear Mixed Model</a></li>
  <li><a href="#acrophase-linear-mixed-model-daylight-saving-time" id="toc-acrophase-linear-mixed-model-daylight-saving-time" class="nav-link" data-scroll-target="#acrophase-linear-mixed-model-daylight-saving-time">Acrophase: Linear Mixed Model Daylight Saving Time</a></li>
  <li><a href="#arcrophase-seasons" id="toc-arcrophase-seasons" class="nav-link" data-scroll-target="#arcrophase-seasons">Arcrophase &amp; Seasons</a></li>
  <li><a href="#amplitude-seasons" id="toc-amplitude-seasons" class="nav-link" data-scroll-target="#amplitude-seasons">Amplitude &amp; Seasons</a></li>
  <li><a href="#intercept-seasons" id="toc-intercept-seasons" class="nav-link" data-scroll-target="#intercept-seasons">Intercept &amp; Seasons</a></li>
  </ul></li>
  <li><a href="#frequency-analysis-of-night-data" id="toc-frequency-analysis-of-night-data" class="nav-link" data-scroll-target="#frequency-analysis-of-night-data">Frequency Analysis of Night Data</a>
  <ul>
  <li><a href="#lomb-scargle" id="toc-lomb-scargle" class="nav-link" data-scroll-target="#lomb-scargle">Lomb-Scargle</a></li>
  <li><a href="#wavelet" id="toc-wavelet" class="nav-link" data-scroll-target="#wavelet">Wavelet</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Master Thesis Lina Becker</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 31, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="install-and-load-packages" class="level2">
<h2 class="anchored" data-anchor-id="install-and-load-packages">Install and Load Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"dplyr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"lubridate"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"ggplot2"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"tidyr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"tidyr"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"knitr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"knitr"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"stringr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"stringr"</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"pheatmap"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lubridate'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    date, intersect, setdiff, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-reading" class="level2">
<h2 class="anchored" data-anchor-id="data-reading">Data Reading</h2>
<p><strong>Description:</strong> Define Directory and Combine Single Data Files into one Dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the directory containing the files</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data_directory <span class="ot">&lt;-</span> <span class="st">"/Users/linabecker/Documents/M.Sc. Health Science/Masterarbeit/Masterarbeit/Datensätze"</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># List all CSV files in the directory</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>file_list <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> data_directory, <span class="at">pattern =</span> <span class="st">"*.csv"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store individual data frames</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>data_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop over each file to read, process, and add to data_list</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> file_list) {</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the ID from the filename</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="fu">sub</span>(<span class="st">"_.*"</span>, <span class="st">""</span>, <span class="fu">basename</span>(file))</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the file, skipping the first row and using the second row as the header</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(file, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the ID column</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>ID <span class="ot">&lt;-</span> id</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the processed data frame to the list</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  data_list[[<span class="fu">length</span>(data_list) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> df</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all individual data frames into one</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data_list)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co"># View the combined data </span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Device                        Serial.Number Device.Timestamp
1 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:07
2 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:12
3 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:17
4 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:22
5 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:27
6 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:32
  Record.Type Historic.Glucose.mg.dL Scan.Glucose.mg.dL
1           0                     94                 NA
2           0                     90                 NA
3           0                     90                 NA
4           0                     92                 NA
5           0                     97                 NA
6           0                     98                 NA
  Non.numeric.Rapid.Acting.Insulin Rapid.Acting.Insulin..units.
1                               NA                           NA
2                               NA                           NA
3                               NA                           NA
4                               NA                           NA
5                               NA                           NA
6                               NA                           NA
  Non.numeric.Food Carbohydrates..grams. Carbohydrates..servings.
1               NA                    NA                       NA
2               NA                    NA                       NA
3               NA                    NA                       NA
4               NA                    NA                       NA
5               NA                    NA                       NA
6               NA                    NA                       NA
  Non.numeric.Long.Acting.Insulin Long.Acting.Insulin.Value..units. Notes
1                              NA                                NA      
2                              NA                                NA      
3                              NA                                NA      
4                              NA                                NA      
5                              NA                                NA      
6                              NA                                NA      
  Strip.Glucose.mg.dL Ketone.mmol.L Meal.Insulin..units.
1                  NA            NA                   NA
2                  NA            NA                   NA
3                  NA            NA                   NA
4                  NA            NA                   NA
5                  NA            NA                   NA
6                  NA            NA                   NA
  Correction.Insulin..units. User.Change.Insulin..units.          ID
1                         NA                          NA 102Ecosleep
2                         NA                          NA 102Ecosleep
3                         NA                          NA 102Ecosleep
4                         NA                          NA 102Ecosleep
5                         NA                          NA 102Ecosleep
6                         NA                          NA 102Ecosleep</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get a summary of unique IDs</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>id_summary <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>()</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>id_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  n
1 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert ID to a factor</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.factor</span>(ID))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the columns</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">DeviceTimestamp =</span> Device.Timestamp,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Glucose levels (mg/dl)</span><span class="st">`</span> <span class="ot">=</span> Historic.Glucose.mg.dL,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Scan glucose levels (mg/dl)</span><span class="st">`</span> <span class="ot">=</span> Scan.Glucose.mg.dL</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># View the updated column names (optional)</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Device"                            "Serial.Number"                    
 [3] "DeviceTimestamp"                   "Record.Type"                      
 [5] "Glucose levels (mg/dl)"            "Scan glucose levels (mg/dl)"      
 [7] "Non.numeric.Rapid.Acting.Insulin"  "Rapid.Acting.Insulin..units."     
 [9] "Non.numeric.Food"                  "Carbohydrates..grams."            
[11] "Carbohydrates..servings."          "Non.numeric.Long.Acting.Insulin"  
[13] "Long.Acting.Insulin.Value..units." "Notes"                            
[15] "Strip.Glucose.mg.dL"               "Ketone.mmol.L"                    
[17] "Meal.Insulin..units."              "Correction.Insulin..units."       
[19] "User.Change.Insulin..units."       "ID"                               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the timestamp column to POSIXct format</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>combined_data<span class="sc">$</span>Timestamp <span class="ot">&lt;-</span> <span class="fu">as.POSIXct</span>(combined_data<span class="sc">$</span>DeviceTimestamp, <span class="at">format =</span> <span class="st">"%d-%m-%Y %H:%M"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Verify the structure to confirm the change</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(combined_data<span class="sc">$</span>Timestamp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> POSIXct[1:445497], format: "2024-03-11 09:07:00" "2024-03-11 09:12:00" "2024-03-11 09:17:00" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns, placing timestamp as the fourth column</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, Timestamp, <span class="fu">everything</span>())<span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Timestamp)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Check all values of record types</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(combined_data<span class="sc">$</span>Record.Type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   0.00    0.00    0.00    1.15    0.00    6.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(combined_data<span class="sc">$</span>Record.Type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1      5      6 
353202   8254     11  84030 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process the data as specified</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove rows where Record.Type is 5 or 6</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(Record.Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a new column 'Glucose level'</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Glucose (mg/dl)"</span> <span class="ot">=</span> <span class="fu">if_else</span>(</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Glucose levels (mg/dl)</span><span class="st">`</span>), </span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose levels (mg/dl)</span><span class="st">`</span>, </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Scan glucose levels (mg/dl)</span><span class="st">`</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># View the first few rows to verify</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Device                        Serial.Number  DeviceTimestamp
1 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:07
2 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:12
3 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:17
4 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:22
5 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:27
6 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:32
            Timestamp Record.Type Glucose levels (mg/dl)
1 2024-03-11 09:07:00           0                     94
2 2024-03-11 09:12:00           0                     90
3 2024-03-11 09:17:00           0                     90
4 2024-03-11 09:22:00           0                     92
5 2024-03-11 09:27:00           0                     97
6 2024-03-11 09:32:00           0                     98
  Scan glucose levels (mg/dl) Non.numeric.Rapid.Acting.Insulin
1                          NA                               NA
2                          NA                               NA
3                          NA                               NA
4                          NA                               NA
5                          NA                               NA
6                          NA                               NA
  Rapid.Acting.Insulin..units. Non.numeric.Food Carbohydrates..grams.
1                           NA               NA                    NA
2                           NA               NA                    NA
3                           NA               NA                    NA
4                           NA               NA                    NA
5                           NA               NA                    NA
6                           NA               NA                    NA
  Carbohydrates..servings. Non.numeric.Long.Acting.Insulin
1                       NA                              NA
2                       NA                              NA
3                       NA                              NA
4                       NA                              NA
5                       NA                              NA
6                       NA                              NA
  Long.Acting.Insulin.Value..units. Notes Strip.Glucose.mg.dL Ketone.mmol.L
1                                NA                        NA            NA
2                                NA                        NA            NA
3                                NA                        NA            NA
4                                NA                        NA            NA
5                                NA                        NA            NA
6                                NA                        NA            NA
  Meal.Insulin..units. Correction.Insulin..units. User.Change.Insulin..units.
1                   NA                         NA                          NA
2                   NA                         NA                          NA
3                   NA                         NA                          NA
4                   NA                         NA                          NA
5                   NA                         NA                          NA
6                   NA                         NA                          NA
           ID Glucose (mg/dl)
1 102Ecosleep              94
2 102Ecosleep              90
3 102Ecosleep              90
4 102Ecosleep              92
5 102Ecosleep              97
6 102Ecosleep              98</code></pre>
</div>
</div>
<p><strong>Description:</strong> Remove “Ecosleep” from ID Names</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>combined_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">str_remove</span>(ID, <span class="fu">regex</span>(<span class="st">"Ecosleep$"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span> )))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Get an Overview of Distribution of Historic and Scanned Glucose Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows where both glucose values are missing</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>glucose_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Glucose levels (mg/dl)</span><span class="st">`</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Scan glucose levels (mg/dl)</span><span class="st">`</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot all participants in one faceted plot</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(glucose_data, <span class="fu">aes</span>(<span class="at">x =</span> Timestamp)) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose levels (mg/dl)</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Scan glucose levels (mg/dl)</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.1</span>, <span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span>  <span class="co"># One plot per ID</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Glucose Measurements Over Time by Participant"</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Blue = Historic Glucose (5 min), Red = Scan Glucose (Manual Scan)"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose Level (mg/dl)"</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 8266 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 353202 rows containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h2>
<p><strong>Description:</strong> Filter out all Columns not Needed and not Historic</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out rows with NA or infinite values in timestamp and glucose levels columns --&gt; filter out all glucose levels, which are not historic glucose levels (which are scan glucose levels)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span> combined_data <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Timestamp), <span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">Glucose levels (mg/dl)</span><span class="st">`</span>), <span class="fu">is.finite</span>(<span class="st">`</span><span class="at">Glucose levels (mg/dl)</span><span class="st">`</span>))</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cleaned_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Device                        Serial.Number  DeviceTimestamp
1 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:07
2 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:12
3 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:17
4 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:22
5 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:27
6 FreeStyle Libre 3 445B278E-A42C-4AAD-9A7F-133BF591A6A7 11-03-2024 09:32
            Timestamp Record.Type Glucose levels (mg/dl)
1 2024-03-11 09:07:00           0                     94
2 2024-03-11 09:12:00           0                     90
3 2024-03-11 09:17:00           0                     90
4 2024-03-11 09:22:00           0                     92
5 2024-03-11 09:27:00           0                     97
6 2024-03-11 09:32:00           0                     98
  Scan glucose levels (mg/dl) Non.numeric.Rapid.Acting.Insulin
1                          NA                               NA
2                          NA                               NA
3                          NA                               NA
4                          NA                               NA
5                          NA                               NA
6                          NA                               NA
  Rapid.Acting.Insulin..units. Non.numeric.Food Carbohydrates..grams.
1                           NA               NA                    NA
2                           NA               NA                    NA
3                           NA               NA                    NA
4                           NA               NA                    NA
5                           NA               NA                    NA
6                           NA               NA                    NA
  Carbohydrates..servings. Non.numeric.Long.Acting.Insulin
1                       NA                              NA
2                       NA                              NA
3                       NA                              NA
4                       NA                              NA
5                       NA                              NA
6                       NA                              NA
  Long.Acting.Insulin.Value..units. Notes Strip.Glucose.mg.dL Ketone.mmol.L
1                                NA                        NA            NA
2                                NA                        NA            NA
3                                NA                        NA            NA
4                                NA                        NA            NA
5                                NA                        NA            NA
6                                NA                        NA            NA
  Meal.Insulin..units. Correction.Insulin..units. User.Change.Insulin..units.
1                   NA                         NA                          NA
2                   NA                         NA                          NA
3                   NA                         NA                          NA
4                   NA                         NA                          NA
5                   NA                         NA                          NA
6                   NA                         NA                          NA
   ID Glucose (mg/dl)
1 102              94
2 102              90
3 102              90
4 102              92
5 102              97
6 102              98</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span> cleaned_data <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Rapid.Acting.Insulin..units., <span class="sc">-</span>Ketone.mmol.L, <span class="sc">-</span>Non.numeric.Rapid.Acting.Insulin, <span class="sc">-</span>Non.numeric.Food, <span class="sc">-</span>Carbohydrates..grams.,<span class="sc">-</span>Carbohydrates..servings., <span class="sc">-</span>Non.numeric.Long.Acting.Insulin, <span class="sc">-</span>Long.Acting.Insulin.Value..units., <span class="sc">-</span>Notes, <span class="sc">-</span>Strip.Glucose.mg.dL, <span class="sc">-</span>Meal.Insulin..units., <span class="sc">-</span>Correction.Insulin..units., <span class="sc">-</span>User.Change.Insulin..units.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="missings" class="level3">
<h3 class="anchored" data-anchor-id="missings">Missings</h3>
<p><strong>Description:</strong> Check if there are Missings in Glucose Values</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a column to indicate missing or non-finite values in Glucose (1 = Missing/Non-finite, 0 = Present)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>cleaned_data <span class="ot">&lt;-</span> cleaned_data <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Missing =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>) <span class="sc">|</span> <span class="sc">!</span><span class="fu">is.finite</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Check how many columns have the value 1 in Missings</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(cleaned_data<span class="sc">$</span>Missing <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p><strong>Description</strong>: Create a Table Showing an Overview of Expected Number versus Real Number of Measurements per ID per Month</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the start date for each ID (earliest timestamp)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>id_start_dates <span class="ot">&lt;-</span> cleaned_data <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Start_Date =</span> <span class="fu">min</span>(Timestamp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) , <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the start date back to the main data and filter to include only records from the start date onward</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>cleaned_data_filtered <span class="ot">&lt;-</span> cleaned_data <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(id_start_dates, <span class="at">by =</span> <span class="st">"ID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Timestamp <span class="sc">&gt;=</span> Start_Date <span class="sc">|</span> <span class="fu">is.na</span>(Timestamp))  <span class="co"># include rows where Timestamp is NA as well</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description</strong>: Table with Overview</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add Month and Year</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>glucose_monthly_summary <span class="ot">&lt;-</span> cleaned_data <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">floor_date</span>(Timestamp, <span class="st">"month"</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Month) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Measured_Values =</span> <span class="fu">n</span>(),  <span class="co"># measured values</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Days_Observed =</span> <span class="fu">n_distinct</span>(<span class="fu">as.Date</span>(Timestamp)),  <span class="co"># observed days per month</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Expected_Values =</span> Days_Observed <span class="sc">*</span> <span class="dv">288</span>,  <span class="co"># Expected: 288 per day</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Missing_Values =</span> Expected_Values <span class="sc">-</span> Measured_Values,</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Missing_Percentage =</span> <span class="fu">round</span>((Missing_Values <span class="sc">/</span> Expected_Values) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data set</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>glucose_monthly_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 59 × 7
   ID    Month               Measured_Values Days_Observed Expected_Values
   &lt;chr&gt; &lt;dttm&gt;                        &lt;int&gt;         &lt;int&gt;           &lt;dbl&gt;
 1 102   2024-03-01 00:00:00            5896            21            6048
 2 102   2024-04-01 00:00:00            8244            31            8928
 3 102   2024-05-01 00:00:00            7502            29            8352
 4 102   2024-06-01 00:00:00            4898            19            5472
 5 102   2024-07-01 00:00:00            2084             9            2592
 6 102   2024-08-01 00:00:00            7502            28            8064
 7 102   2024-09-01 00:00:00            8019            30            8640
 8 102   2024-10-01 00:00:00            6023            23            6624
 9 102   2024-11-01 00:00:00            3787            14            4032
10 102   2024-12-01 00:00:00            5947            24            6912
# ℹ 49 more rows
# ℹ 2 more variables: Missing_Values &lt;dbl&gt;, Missing_Percentage &lt;dbl&gt;</code></pre>
</div>
</div>
<p><strong>Description:</strong> Add Months to Table when no Measurement Took Place</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># claculate month</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>data_with_month <span class="ot">&lt;-</span> cleaned_data <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">floor_date</span>(Timestamp, <span class="st">"month"</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co"># firt month per ID</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>first_months <span class="ot">&lt;-</span> data_with_month <span class="sc">%&gt;%</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">First_Month =</span> <span class="fu">min</span>(Month), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 13 month from start per ID</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>full_months_per_id <span class="ot">&lt;-</span> first_months <span class="sc">%&gt;%</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Month =</span> <span class="fu">list</span>(<span class="fu">seq</span>(First_Month, <span class="at">by =</span> <span class="st">"1 month"</span>, <span class="at">length.out =</span> <span class="dv">13</span>))</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(Month) <span class="sc">%&gt;%</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co"># count measured values per ID and month</span></span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>monthly_counts <span class="ot">&lt;-</span> data_with_month <span class="sc">%&gt;%</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Month) <span class="sc">%&gt;%</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Measured_Values =</span> <span class="fu">n</span>(),</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">Days_Observed =</span> <span class="fu">n_distinct</span>(<span class="fu">as.Date</span>(Timestamp)),</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a><span class="co"># join with full months</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>monthly_summary <span class="ot">&lt;-</span> full_months_per_id <span class="sc">%&gt;%</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(monthly_counts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"Month"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">Measured_Values =</span> <span class="fu">replace_na</span>(Measured_Values, <span class="dv">0</span>),</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">Days_Observed =</span> <span class="fu">replace_na</span>(Days_Observed, <span class="dv">0</span>),</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">Expected_Values =</span> <span class="fu">days_in_month</span>(Month) <span class="sc">*</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">12</span>,  <span class="co"># 12 measurements per hour with 5min frequence </span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">Missing_Values =</span> Expected_Values <span class="sc">-</span> Measured_Values,</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">Missing_Percentage =</span> <span class="fu">ifelse</span>(Expected_Values <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>, <span class="fu">round</span>((Missing_Values <span class="sc">/</span> Expected_Values) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>))</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Duplicates were Found, because Missings were Minus -&gt; Remove Duplicates Using cleaned_data_filtered</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for duplicates first</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>cleaned_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,940 × 11
# Groups:   ID, Timestamp [1,470]
   Device          Serial.Number DeviceTimestamp Timestamp           Record.Type
   &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;           &lt;dttm&gt;                    &lt;int&gt;
 1 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:16:00           0
 2 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:16:00           0
 3 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:21:00           0
 4 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:21:00           0
 5 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:26:00           0
 6 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:26:00           0
 7 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:31:00           0
 8 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:31:00           0
 9 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:36:00           0
10 FreeStyle Libr… 445B278E-A42… 17-05-2024 15:… 2024-05-17 15:36:00           0
# ℹ 2,930 more rows
# ℹ 6 more variables: `Glucose levels (mg/dl)` &lt;int&gt;,
#   `Scan glucose levels (mg/dl)` &lt;int&gt;, ID &lt;chr&gt;, `Glucose (mg/dl)` &lt;int&gt;,
#   Missing &lt;dbl&gt;, Start_Date &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="duplicates" class="level3">
<h3 class="anchored" data-anchor-id="duplicates">Duplicates</h3>
<p><strong>Description:</strong> Check for Duplicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All Duplicates</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>dup_timestamps <span class="ot">&lt;-</span> cleaned_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, Timestamp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="identicalexact-duplicates" class="level4">
<h4 class="anchored" data-anchor-id="identicalexact-duplicates">Identical/Exact Duplicates</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>exact_duplicates <span class="ot">&lt;-</span> dup_timestamps <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Timestamp, <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, Serial.Number) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>exact_duplicates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 11
   Device          Serial.Number DeviceTimestamp Timestamp           Record.Type
   &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;           &lt;dttm&gt;                    &lt;int&gt;
 1 FreeStyle Libr… 445B278E-A42… 05-08-2024 15:… 2024-08-05 15:34:00           0
 2 FreeStyle Libr… 445B278E-A42… 05-08-2024 15:… 2024-08-05 15:34:00           0
 3 FreeStyle Libr… 445B278E-A42… 24-11-2024 08:… 2024-11-24 08:06:00           0
 4 FreeStyle Libr… 445B278E-A42… 24-11-2024 08:… 2024-11-24 08:06:00           0
 5 FreeStyle Libr… 445B278E-A42… 24-11-2024 08:… 2024-11-24 08:11:00           0
 6 FreeStyle Libr… 445B278E-A42… 24-11-2024 08:… 2024-11-24 08:11:00           0
 7 FreeStyle Libr… DBE03CAB-A7A… 13-12-2024 11:… 2024-12-13 11:05:00           0
 8 FreeStyle Libr… DBE03CAB-A7A… 13-12-2024 11:… 2024-12-13 11:05:00           0
 9 FreeStyle Libr… DBE03CAB-A7A… 13-12-2024 11:… 2024-12-13 11:55:00           0
10 FreeStyle Libr… DBE03CAB-A7A… 13-12-2024 11:… 2024-12-13 11:55:00           0
11 FreeStyle Libr… 31C3AD69-BB1… 18-06-2024 09:… 2024-06-18 09:54:00           0
12 FreeStyle Libr… 31C3AD69-BB1… 18-06-2024 09:… 2024-06-18 09:54:00           0
13 FreeStyle Libr… 31C3AD69-BB1… 27-10-2024 02:… 2024-10-27 02:56:00           0
14 FreeStyle Libr… 31C3AD69-BB1… 27-10-2024 02:… 2024-10-27 02:56:00           0
# ℹ 6 more variables: `Glucose levels (mg/dl)` &lt;int&gt;,
#   `Scan glucose levels (mg/dl)` &lt;int&gt;, ID &lt;chr&gt;, `Glucose (mg/dl)` &lt;int&gt;,
#   Missing &lt;dbl&gt;, Start_Date &lt;dttm&gt;</code></pre>
</div>
</div>
</section>
<section id="duplicates-with-same-serial.number-but-different-glucose-value" class="level4">
<h4 class="anchored" data-anchor-id="duplicates-with-same-serial.number-but-different-glucose-value">Duplicates with Same Serial.Number but Different Glucose Value</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>conflicting_duplicates <span class="ot">&lt;-</span> dup_timestamps <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Timestamp, Serial.Number) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>conflict_summary <span class="ot">&lt;-</span> conflicting_duplicates <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ID, <span class="at">name =</span> <span class="st">"Conflicting_Measurements"</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>conflict_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  ID    Conflicting_Measurements
  &lt;chr&gt;                    &lt;int&gt;
1 102                        132
2 104                         44
3 107                         22</code></pre>
</div>
</div>
<p><strong>Description:</strong> Plotting those Conflicting Duplicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>conflicting_duplicates <span class="ot">&lt;-</span> conflicting_duplicates <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Timestamp, Serial.Number) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Glucose_Row =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># wide-format</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>conflicts_wide <span class="ot">&lt;-</span> conflicting_duplicates <span class="sc">%&gt;%</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Timestamp, Serial.Number, <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, Glucose_Row) <span class="sc">%&gt;%</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> Glucose_Row,</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>,</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"Glucose_"</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Glucose_1) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(Glucose_2))</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatterplot: Glucose_1 vs Glucose_2</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(conflicts_wide, <span class="fu">aes</span>(<span class="at">x =</span> Glucose_1, <span class="at">y =</span> Glucose_2, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of glucose values in conflicting duplicates </span><span class="sc">\n</span><span class="st">(same timestamp, same serialnumber)"</span>,</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Glucose Value 1"</span>,</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose Value 2"</span>,</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"ID"</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Checking differences of duplicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>conflicts_wide <span class="ot">&lt;-</span> conflicts_wide <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duplicate_difference =</span> Glucose_2 <span class="sc">-</span> Glucose_1)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(conflicts_wide, <span class="fu">aes</span>(<span class="at">x =</span> duplicate_difference, <span class="at">fill =</span> ID)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Differences between Glucose Values"</span>,</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Difference: Glucose (mg/dl)"</span>,</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Number"</span>,</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"ID"</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="duplicates-with-different-serial.number-but-same-glucose-value" class="level4">
<h4 class="anchored" data-anchor-id="duplicates-with-different-serial.number-but-same-glucose-value">Duplicates with different Serial.Number but same glucose value</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>duplicates_diff_serial <span class="ot">&lt;-</span> dup_timestamps <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Timestamp, <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n_distinct</span>(Serial.Number) <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>summary_diff_serial <span class="ot">&lt;-</span> duplicates_diff_serial <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ID, <span class="at">name =</span> <span class="st">"Same_Glucose_Diff_Serial_Count"</span>)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>summary_diff_serial</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
  ID    Same_Glucose_Diff_Serial_Count
  &lt;chr&gt;                          &lt;int&gt;
1 109                             2728</code></pre>
</div>
</div>
</section>
</section>
<section id="irregular-timestamps-less-than-4min-more-than-6min" class="level3">
<h3 class="anchored" data-anchor-id="irregular-timestamps-less-than-4min-more-than-6min">Irregular Timestamps: Less than 4min, more than 6min</h3>
<p><strong>Description:</strong> Calculate Timegaps</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>time_gaps <span class="ot">&lt;-</span> cleaned_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, Timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time_Diff_Minutes =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(Timestamp, <span class="fu">lag</span>(Timestamp), <span class="at">units =</span> <span class="st">"mins"</span>))</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>time_gaps</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 353,190 × 12
   Device          Serial.Number DeviceTimestamp Timestamp           Record.Type
   &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;           &lt;dttm&gt;                    &lt;int&gt;
 1 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:07:00           0
 2 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:12:00           0
 3 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:17:00           0
 4 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:22:00           0
 5 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:27:00           0
 6 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:32:00           0
 7 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:37:00           0
 8 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:42:00           0
 9 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:47:00           0
10 FreeStyle Libr… 445B278E-A42… 11-03-2024 09:… 2024-03-11 09:52:00           0
# ℹ 353,180 more rows
# ℹ 7 more variables: `Glucose levels (mg/dl)` &lt;int&gt;,
#   `Scan glucose levels (mg/dl)` &lt;int&gt;, ID &lt;chr&gt;, `Glucose (mg/dl)` &lt;int&gt;,
#   Missing &lt;dbl&gt;, Start_Date &lt;dttm&gt;, Time_Diff_Minutes &lt;dbl&gt;</code></pre>
</div>
</div>
<section id="gaps-more-than-6min" class="level4">
<h4 class="anchored" data-anchor-id="gaps-more-than-6min">Gaps: more than 6min</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>gaps_over_6min <span class="ot">&lt;-</span> time_gaps <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Time_Diff_Minutes) <span class="sc">&amp;</span> Time_Diff_Minutes <span class="sc">&gt;</span> <span class="dv">6</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>gaps_over_6min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 290 × 12
   Device          Serial.Number DeviceTimestamp Timestamp           Record.Type
   &lt;chr&gt;           &lt;chr&gt;         &lt;chr&gt;           &lt;dttm&gt;                    &lt;int&gt;
 1 FreeStyle Libr… 445B278E-A42… 14-03-2024 19:… 2024-03-14 19:22:00           0
 2 FreeStyle Libr… 445B278E-A42… 25-03-2024 10:… 2024-03-25 10:26:00           0
 3 FreeStyle Libr… 445B278E-A42… 29-03-2024 19:… 2024-03-29 19:41:00           0
 4 FreeStyle Libr… 445B278E-A42… 01-04-2024 15:… 2024-04-01 15:31:00           0
 5 FreeStyle Libr… 445B278E-A42… 04-04-2024 12:… 2024-04-04 12:21:00           0
 6 FreeStyle Libr… 445B278E-A42… 09-04-2024 10:… 2024-04-09 10:40:00           0
 7 FreeStyle Libr… 445B278E-A42… 11-04-2024 19:… 2024-04-11 19:35:00           0
 8 FreeStyle Libr… 445B278E-A42… 11-04-2024 20:… 2024-04-11 20:00:00           0
 9 FreeStyle Libr… 445B278E-A42… 11-04-2024 20:… 2024-04-11 20:20:00           0
10 FreeStyle Libr… 445B278E-A42… 11-04-2024 22:… 2024-04-11 22:20:00           0
# ℹ 280 more rows
# ℹ 7 more variables: `Glucose levels (mg/dl)` &lt;int&gt;,
#   `Scan glucose levels (mg/dl)` &lt;int&gt;, ID &lt;chr&gt;, `Glucose (mg/dl)` &lt;int&gt;,
#   Missing &lt;dbl&gt;, Start_Date &lt;dttm&gt;, Time_Diff_Minutes &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>summary_over_6min <span class="ot">&lt;-</span> gaps_over_6min <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span> (ID, <span class="at">name =</span> <span class="st">"Gaps_More_Than_6min"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>summary_over_6min_detail <span class="ot">&lt;-</span> gaps_over_6min <span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_Diff_Minutes) <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Count =</span> <span class="fu">n</span>(),</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, Time_Diff_Minutes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="gaps-between-1-and-3min" class="level4">
<h4 class="anchored" data-anchor-id="gaps-between-1-and-3min">Gaps: between 1 and 3min</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>gaps_1_to_3_min <span class="ot">&lt;-</span> time_gaps <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Time_Diff_Minutes) <span class="sc">&amp;</span> Time_Diff_Minutes <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> Time_Diff_Minutes <span class="sc">&lt;=</span> <span class="dv">3</span>)</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>summary_1_to_3_min <span class="ot">&lt;-</span> gaps_1_to_3_min <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ID, <span class="at">name =</span> <span class="st">"Gaps_Between_1_and_3min"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Categorize Time Gaps</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>time_gaps_plot <span class="ot">&lt;-</span> time_gaps <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Gap_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(Time_Diff_Minutes) <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>      Time_Diff_Minutes <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> Time_Diff_Minutes <span class="sc">&lt;=</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Between 1 and 3"</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>      Time_Diff_Minutes <span class="sc">&gt;</span> <span class="dv">6</span> <span class="sc">~</span> <span class="st">"Over 6 min"</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>      Time_Diff_Minutes <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Duplicate"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Normal (4-6 min)"</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-those-timegaps" class="level4">
<h4 class="anchored" data-anchor-id="plotting-those-timegaps">Plotting those Timegaps</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_gaps_plot, <span class="fu">aes</span>(<span class="at">x =</span> Timestamp)) <span class="sc">+</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normal (4–6 Minutes) – as Background</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">subset</span>(time_gaps_plot, Gap_Category <span class="sc">==</span> <span class="st">"Normal (4-6 min)"</span>),</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> Time_Diff_Minutes),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"gray70"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">1.5</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gaps &gt; 6 Minutes – red</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">subset</span>(time_gaps_plot, Gap_Category <span class="sc">==</span> <span class="st">"Over 6 min"</span>),</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> Time_Diff_Minutes),</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red3"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">1.5</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gaps 1–3 Minutes – green</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">subset</span>(time_gaps_plot, Gap_Category <span class="sc">==</span> <span class="st">"Between 1 and 3"</span>),</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> Time_Diff_Minutes),</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"green3"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>, <span class="at">size =</span> <span class="fl">1.5</span></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Time Intervals Between Timestamps per ID"</span>,</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"red = &gt;6min, green = 1–3min, grey = 4–6min"</span>,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time Interval Between Timestamps (min)"</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="serial-numbers" class="level3">
<h3 class="anchored" data-anchor-id="serial-numbers">Serial Numbers</h3>
<p><strong>Description:</strong> Check how many Serial Numbers per ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>serial_number_summary <span class="ot">&lt;-</span> cleaned_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Serial.Number) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">First_Timestamp =</span> <span class="fu">min</span>(Timestamp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Last_Timestamp =</span> <span class="fu">max</span>(Timestamp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Count =</span> <span class="fu">n</span>(),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, First_Timestamp)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>serial_number_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 5
  ID    Serial.Number              First_Timestamp     Last_Timestamp      Count
  &lt;chr&gt; &lt;chr&gt;                      &lt;dttm&gt;              &lt;dttm&gt;              &lt;int&gt;
1 102   445B278E-A42C-4AAD-9A7F-1… 2024-03-11 09:07:00 2025-03-14 14:53:00 77366
2 104   6BEA15A5-6DDE-488C-89DB-4… 2024-03-18 08:54:00 2024-05-10 07:47:00 15178
3 104   DBE03CAB-A7A2-4E06-9617-A… 2024-05-16 13:00:00 2025-03-12 22:46:00 76461
4 107   31C3AD69-BB17-44A8-8489-B… 2024-03-25 09:03:00 2025-02-26 12:39:00 56134
5 108   0175A853-C2D3-46AD-95D7-4… 2024-04-22 10:13:00 2024-06-03 07:50:00 12035
6 109   2dca51a8-cc16-4887-b718-1… 2024-04-22 11:35:00 2024-06-08 08:51:00 11680
7 109   F6C5F96A-7168-44F8-B964-5… 2024-06-03 15:01:00 2025-03-26 11:08:00 34854
8 112   NAGD171-G1255              2024-08-11 22:51:00 2025-07-02 16:04:00 69482</code></pre>
</div>
</div>
</section>
<section id="create-dataset-without-duplicates" class="level3">
<h3 class="anchored" data-anchor-id="create-dataset-without-duplicates">Create Dataset without Duplicates</h3>
<p><strong>Description:</strong> deduplicate: exact Duplicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="ot">&lt;-</span> cleaned_data_filtered <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ID, Timestamp, Serial.Number, <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> deduplicate: Duplicates with same Timestamp and Glucose Value but not same Serial Number</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(ID, Timestamp, <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> deduplicate: Duplicates with same Timestamp but Different Glucose Value</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  cleaned_data_deduplicated,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  conflicting_duplicates,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"ID"</span>, <span class="st">"Timestamp"</span>, <span class="st">"Serial.Number"</span>, <span class="st">"Glucose (mg/dl)"</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Check how many Rows were Deleted</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(cleaned_data_filtered) <span class="sc">-</span> <span class="fu">nrow</span>(cleaned_data_deduplicated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1569</code></pre>
</div>
</div>
</section>
<section id="missings-in-duplicated-dataset" class="level3">
<h3 class="anchored" data-anchor-id="missings-in-duplicated-dataset">Missings in Duplicated Dataset</h3>
<p><strong>Description:</strong> per ID, check how many data points there are from the first day of measurement on for one year</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 102</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>target_id_102 <span class="ot">&lt;-</span> <span class="st">"102"</span>               </span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>start_date_102 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-03-11"</span>)  </span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for this ID and 1-year window</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>filtered_data_102 <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">==</span> target_id_102,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&gt;=</span> start_date_102,</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&lt;</span> start_date_102 <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of measurements</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>measurement_count_102 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(filtered_data_102)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 104</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>target_id_104 <span class="ot">&lt;-</span> <span class="st">"104"</span></span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>start_date_104 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-03-18"</span>) </span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for this ID and 1-year window</span></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>filtered_data_104 <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">==</span> target_id_104,</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&gt;=</span> start_date_104,</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&lt;</span> start_date_104 <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of measurements</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>measurement_count_104 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(filtered_data_104)</span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 107</span></span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>target_id_107 <span class="ot">&lt;-</span> <span class="st">"107"</span>            </span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>start_date_107 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-03-25"</span>) </span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for this ID and 1-year window</span></span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>filtered_data_107 <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">==</span> target_id_107,</span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&gt;=</span> start_date_107,</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&lt;</span> start_date_107 <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of measurements</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>measurement_count_107 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(filtered_data_107)</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 108</span></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>target_id_108 <span class="ot">&lt;-</span> <span class="st">"108"</span>              </span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>start_date_108 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-04-22"</span>)  </span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-53"><a href="#cb63-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for this ID and 1-year window</span></span>
<span id="cb63-54"><a href="#cb63-54" aria-hidden="true" tabindex="-1"></a>filtered_data_108 <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb63-55"><a href="#cb63-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb63-56"><a href="#cb63-56" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">==</span> target_id_108,</span>
<span id="cb63-57"><a href="#cb63-57" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&gt;=</span> start_date_108,</span>
<span id="cb63-58"><a href="#cb63-58" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&lt;</span> start_date_108 <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb63-59"><a href="#cb63-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-60"><a href="#cb63-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-61"><a href="#cb63-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of measurements</span></span>
<span id="cb63-62"><a href="#cb63-62" aria-hidden="true" tabindex="-1"></a>measurement_count_108 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(filtered_data_108)</span>
<span id="cb63-63"><a href="#cb63-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-64"><a href="#cb63-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-65"><a href="#cb63-65" aria-hidden="true" tabindex="-1"></a><span class="co"># 109</span></span>
<span id="cb63-66"><a href="#cb63-66" aria-hidden="true" tabindex="-1"></a>target_id_109 <span class="ot">&lt;-</span> <span class="st">"109"</span>            </span>
<span id="cb63-67"><a href="#cb63-67" aria-hidden="true" tabindex="-1"></a>start_date_109 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-04-22"</span>)</span>
<span id="cb63-68"><a href="#cb63-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-69"><a href="#cb63-69" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for this ID and 1-year window</span></span>
<span id="cb63-70"><a href="#cb63-70" aria-hidden="true" tabindex="-1"></a>filtered_data_109 <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb63-71"><a href="#cb63-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb63-72"><a href="#cb63-72" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">==</span> target_id_109,</span>
<span id="cb63-73"><a href="#cb63-73" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&gt;=</span> start_date_109,</span>
<span id="cb63-74"><a href="#cb63-74" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&lt;</span> start_date_109 <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb63-75"><a href="#cb63-75" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-76"><a href="#cb63-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-77"><a href="#cb63-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of measurements</span></span>
<span id="cb63-78"><a href="#cb63-78" aria-hidden="true" tabindex="-1"></a>measurement_count_109 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(filtered_data_109)</span>
<span id="cb63-79"><a href="#cb63-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-80"><a href="#cb63-80" aria-hidden="true" tabindex="-1"></a><span class="co"># 112</span></span>
<span id="cb63-81"><a href="#cb63-81" aria-hidden="true" tabindex="-1"></a>target_id_112 <span class="ot">&lt;-</span> <span class="st">"112"</span>            </span>
<span id="cb63-82"><a href="#cb63-82" aria-hidden="true" tabindex="-1"></a>start_date_112 <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(<span class="st">"2024-08-11"</span>)  </span>
<span id="cb63-83"><a href="#cb63-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-84"><a href="#cb63-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for this ID and 1-year window</span></span>
<span id="cb63-85"><a href="#cb63-85" aria-hidden="true" tabindex="-1"></a>filtered_data_112 <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb63-86"><a href="#cb63-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb63-87"><a href="#cb63-87" aria-hidden="true" tabindex="-1"></a>    ID <span class="sc">==</span> target_id_112,</span>
<span id="cb63-88"><a href="#cb63-88" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&gt;=</span> start_date_112,</span>
<span id="cb63-89"><a href="#cb63-89" aria-hidden="true" tabindex="-1"></a>    Timestamp <span class="sc">&lt;</span> start_date_112 <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>)</span>
<span id="cb63-90"><a href="#cb63-90" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-91"><a href="#cb63-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-92"><a href="#cb63-92" aria-hidden="true" tabindex="-1"></a><span class="co"># Count number of measurements</span></span>
<span id="cb63-93"><a href="#cb63-93" aria-hidden="true" tabindex="-1"></a>measurement_count_112 <span class="ot">&lt;-</span> <span class="fu">nrow</span>(filtered_data_112)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="time-in-range" class="level2">
<h2 class="anchored" data-anchor-id="time-in-range">Time in range</h2>
<section id="general-overview-on-hyper-and-hypo-glucose-per-id" class="level3">
<h3 class="anchored" data-anchor-id="general-overview-on-hyper-and-hypo-glucose-per-id">General overview on hyper and hypo glucose per ID</h3>
<p><strong>Description:</strong> hypo &lt; 70 and hyper &gt; 180</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"Hypo"</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">~</span> <span class="st">"Hyper"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Normal"</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Glucose_Category) <span class="sc">%&gt;%</span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>(Count <span class="sc">/</span> <span class="fu">sum</span>(Count) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 4
# Groups:   ID [6]
   ID    Glucose_Category Count Percentage
   &lt;chr&gt; &lt;chr&gt;            &lt;int&gt;      &lt;dbl&gt;
 1 102   Hyper               12       0.02
 2 102   Hypo              1544       2   
 3 102   Normal           75675      98.0 
 4 104   Hyper               25       0.03
 5 104   Hypo              2273       2.48
 6 104   Normal           89295      97.5 
 7 107   Hyper               11       0.02
 8 107   Hypo              1202       2.14
 9 107   Normal           54897      97.8 
10 108   Hyper                4       0.03
11 108   Hypo               327       2.72
12 108   Normal           11704      97.2 
13 109   Hypo               279       0.62
14 109   Normal           44891      99.4 
15 112   Hyper               58       0.08
16 112   Hypo              2395       3.45
17 112   Normal           67029      96.5 </code></pre>
</div>
</div>
</section>
<section id="hyper-and-hypo-in-day-and-night" class="level3">
<h3 class="anchored" data-anchor-id="hyper-and-hypo-in-day-and-night">Hyper and Hypo in Day and Night</h3>
<p><strong>Description:</strong> Adding Day and Night to Dataset: Night from 22h to 6h</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour =</span> <span class="fu">hour</span>(Timestamp),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time_of_Day =</span> <span class="fu">case_when</span>(</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>      Hour <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;</span> Hour <span class="sc">&lt;</span> <span class="dv">22</span> <span class="sc">~</span> <span class="st">"Day"</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Night"</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Hyper and Hypo in Day and Night</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"Hypo"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">~</span> <span class="st">"Hyper"</span>,</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Normal"</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day, Glucose_Category) <span class="sc">%&gt;%</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day) <span class="sc">%&gt;%</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>(Count <span class="sc">/</span> <span class="fu">sum</span>(Count) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in attr(x, "align"): 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in attr(x, "format"): 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">ID</th>
<th style="text-align: left;">Time_of_Day</th>
<th style="text-align: left;">Glucose_Category</th>
<th style="text-align: right;">Count</th>
<th style="text-align: right;">Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hyper</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">683</td>
<td style="text-align: right;">1.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">50695</td>
<td style="text-align: right;">98.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">861</td>
<td style="text-align: right;">3.33</td>
</tr>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">24980</td>
<td style="text-align: right;">96.67</td>
</tr>
<tr class="even">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hyper</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">1301</td>
<td style="text-align: right;">2.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">59740</td>
<td style="text-align: right;">97.84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hyper</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">972</td>
<td style="text-align: right;">3.18</td>
</tr>
<tr class="odd">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">29555</td>
<td style="text-align: right;">96.79</td>
</tr>
<tr class="even">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hyper</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">812</td>
<td style="text-align: right;">2.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">36793</td>
<td style="text-align: right;">97.81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">390</td>
<td style="text-align: right;">2.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">18104</td>
<td style="text-align: right;">97.89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hyper</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">130</td>
<td style="text-align: right;">1.62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">7870</td>
<td style="text-align: right;">98.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">197</td>
<td style="text-align: right;">4.89</td>
</tr>
<tr class="odd">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">3834</td>
<td style="text-align: right;">95.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">156</td>
<td style="text-align: right;">0.52</td>
</tr>
<tr class="odd">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">29883</td>
<td style="text-align: right;">99.48</td>
</tr>
<tr class="even">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">0.81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">15008</td>
<td style="text-align: right;">99.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hyper</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">1440</td>
<td style="text-align: right;">3.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">44941</td>
<td style="text-align: right;">96.82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hyper</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="even">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Hypo</td>
<td style="text-align: right;">955</td>
<td style="text-align: right;">4.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">22088</td>
<td style="text-align: right;">95.77</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Description:</strong> Hyper and Hypo Clinically Split</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">"Very Low"</span>,                        <span class="co"># Severe Hypo</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">54</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"Low"</span>,  <span class="co"># Mild Hypo</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">180</span> <span class="sc">~</span> <span class="st">"Normal"</span>, <span class="co"># In Range</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"High"</span>,  <span class="co"># High</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"Very High"</span>                          <span class="co"># Very High</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day, Glucose_Category) <span class="sc">%&gt;%</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day) <span class="sc">%&gt;%</span></span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>(Count <span class="sc">/</span> <span class="fu">sum</span>(Count) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in attr(x, "align"): 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in attr(x, "format"): 'xfun::attr()' is deprecated.
Use 'xfun::attr2()' instead.
See help("Deprecated")</code></pre>
</div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">ID</th>
<th style="text-align: left;">Time_of_Day</th>
<th style="text-align: left;">Glucose_Category</th>
<th style="text-align: right;">Count</th>
<th style="text-align: right;">Percentage</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">High</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">643</td>
<td style="text-align: right;">1.25</td>
</tr>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">50695</td>
<td style="text-align: right;">98.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">40</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">762</td>
<td style="text-align: right;">2.95</td>
</tr>
<tr class="even">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">24980</td>
<td style="text-align: right;">96.67</td>
</tr>
<tr class="odd">
<td style="text-align: left;">102</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">0.38</td>
</tr>
<tr class="even">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">High</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">1148</td>
<td style="text-align: right;">1.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">59740</td>
<td style="text-align: right;">97.84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">153</td>
<td style="text-align: right;">0.25</td>
</tr>
<tr class="even">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">High</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">832</td>
<td style="text-align: right;">2.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">29555</td>
<td style="text-align: right;">96.79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">104</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">0.46</td>
</tr>
<tr class="even">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">High</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.03</td>
</tr>
<tr class="odd">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">793</td>
<td style="text-align: right;">2.11</td>
</tr>
<tr class="even">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">36793</td>
<td style="text-align: right;">97.81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">334</td>
<td style="text-align: right;">1.81</td>
</tr>
<tr class="odd">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">18104</td>
<td style="text-align: right;">97.89</td>
</tr>
<tr class="even">
<td style="text-align: left;">107</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">56</td>
<td style="text-align: right;">0.30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">High</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">119</td>
<td style="text-align: right;">1.49</td>
</tr>
<tr class="odd">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">7870</td>
<td style="text-align: right;">98.33</td>
</tr>
<tr class="even">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">178</td>
<td style="text-align: right;">4.42</td>
</tr>
<tr class="even">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">3834</td>
<td style="text-align: right;">95.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">108</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">19</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">0.41</td>
</tr>
<tr class="odd">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">29883</td>
<td style="text-align: right;">99.48</td>
</tr>
<tr class="even">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">0.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">99</td>
<td style="text-align: right;">0.65</td>
</tr>
<tr class="even">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">15008</td>
<td style="text-align: right;">99.19</td>
</tr>
<tr class="odd">
<td style="text-align: left;">109</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="even">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">High</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">0.08</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">1295</td>
<td style="text-align: right;">2.79</td>
</tr>
<tr class="even">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">44941</td>
<td style="text-align: right;">96.82</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Day</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">145</td>
<td style="text-align: right;">0.31</td>
</tr>
<tr class="even">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">High</td>
<td style="text-align: right;">21</td>
<td style="text-align: right;">0.09</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Low</td>
<td style="text-align: right;">822</td>
<td style="text-align: right;">3.56</td>
</tr>
<tr class="even">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Normal</td>
<td style="text-align: right;">22088</td>
<td style="text-align: right;">95.77</td>
</tr>
<tr class="odd">
<td style="text-align: left;">112</td>
<td style="text-align: left;">Night</td>
<td style="text-align: left;">Very Low</td>
<td style="text-align: right;">133</td>
<td style="text-align: right;">0.58</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="create-a-graph" class="level3">
<h3 class="anchored" data-anchor-id="create-a-graph">Create a Graph</h3>
<p><strong>Description:</strong>: Create Color Code</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>glucose_category_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Very Low"</span> <span class="ot">=</span> <span class="st">"#990000"</span>,   <span class="co"># dark red</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#e60000"</span>,        <span class="co"># lighter red</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Normal"</span> <span class="ot">=</span> <span class="st">"#228B22"</span>,     <span class="co"># green</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#FFA500"</span>,       <span class="co"># orange</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Very High"</span> <span class="ot">=</span> <span class="st">"#CC5500"</span>   <span class="co"># dark orange</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Add glucose Category to Dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">"Very Low"</span>,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">54</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">180</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"Very High"</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Create Summary of Time in Range</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>time_in_range_summary <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">"Very Low"</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">54</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">180</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"Very High"</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day, Glucose_Category) <span class="sc">%&gt;%</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-13"><a href="#cb75-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day) <span class="sc">%&gt;%</span></span>
<span id="cb75-14"><a href="#cb75-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Percentage =</span> <span class="fu">round</span>(Count <span class="sc">/</span> <span class="fu">sum</span>(Count) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Create Bar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>category_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Very Low"</span> <span class="ot">=</span> <span class="st">"#990000"</span>,</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Low"</span> <span class="ot">=</span> <span class="st">"#e60000"</span>,</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Normal"</span> <span class="ot">=</span> <span class="st">"#228B22"</span>,</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"High"</span> <span class="ot">=</span> <span class="st">"#FFA500"</span>,</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Very High"</span> <span class="ot">=</span> <span class="st">"#CC5500"</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_in_range_summary, <span class="fu">aes</span>(<span class="at">x =</span> Time_of_Day, <span class="at">y =</span> Percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> category_colors) <span class="sc">+</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Glucose Ranges by Time of Day"</span>,</span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percentage"</span>,</span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Glucose Category"</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Create a Different Graph</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>time_in_range_summary <span class="ot">&lt;-</span> time_in_range_summary <span class="sc">%&gt;%</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Glucose_Category =</span> <span class="fu">factor</span>(</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    Glucose_Category,</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Very Low"</span>, <span class="st">"Low"</span>, <span class="st">"Normal"</span>, <span class="st">"High"</span>, <span class="st">"Very High"</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(time_in_range_summary, <span class="fu">aes</span>(<span class="at">x =</span> Glucose_Category, <span class="at">y =</span> Percentage, <span class="at">color =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> Glucose_Category, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> Percentage), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.4</span>,</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> category_colors) <span class="sc">+</span></span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(ID <span class="sc">~</span> Time_of_Day) <span class="sc">+</span></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">130</span>)) <span class="sc">+</span>  <span class="co"># &lt;- Add more space beyond 100%</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Glucose Category by ID and Time of Day"</span>,</span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Category"</span>,</span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percentage (%)"</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot a donut chart</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>donut_data <span class="ot">&lt;-</span> time_in_range_summary <span class="sc">%&gt;%</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"102"</span>, Time_of_Day <span class="sc">==</span> <span class="st">"Night"</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(donut_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> Percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">width =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fl">0.5</span>, <span class="fl">2.5</span>) <span class="sc">+</span>  <span class="co"># creates the hole (donut)</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> category_colors) <span class="sc">+</span></span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(Percentage, <span class="st">"%"</span>)),</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Glucose Distribution (Night) – 102"</span>,</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Glucose Category"</span>) <span class="sc">+</span></span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="stacked-chart" class="level3">
<h3 class="anchored" data-anchor-id="stacked-chart">Stacked Chart</h3>
<p><strong>Description:</strong> Prepare Dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>  stacked_chart <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Glucose_Category)) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">Time =</span> <span class="fu">floor_date</span>(Timestamp, <span class="st">"5 minutes"</span>),</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">TimeOnly =</span> <span class="fu">format</span>(Time, <span class="st">"%H:%M:%S"</span>),</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># POSIXct with reference date</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">TimeOnly_POSIX =</span> <span class="fu">as.POSIXct</span>(TimeOnly, <span class="at">format =</span> <span class="st">"%H:%M:%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(ID, TimeOnly_POSIX, Glucose_Category) <span class="sc">%&gt;%</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(ID, TimeOnly_POSIX) <span class="sc">%&gt;%</span></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">percentage =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">complete</span>(ID, TimeOnly_POSIX, Glucose_Category, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>, <span class="at">percentage =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">Glucose_Category =</span> <span class="fu">factor</span>(Glucose_Category, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"High"</span>, <span class="st">"Normal"</span>, <span class="st">"Low"</span>, <span class="st">"Very Low"</span>))</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Plot for One ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(stacked_chart <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"102"</span>), </span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> TimeOnly_POSIX, <span class="at">y =</span> percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_area</span>() <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot for all IDs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(stacked_chart, </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> TimeOnly_POSIX, <span class="at">y =</span> percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_area</span>() <span class="sc">+</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Stacked Chart with Scientific Colour Palette</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"scico"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"scico"</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scico)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># category levels</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>cats <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"High"</span>,<span class="st">"Normal"</span>,<span class="st">"Low"</span>, <span class="st">"Very Low"</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># discrete colours from Scientific colour map </span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="fu">scico</span>(<span class="fu">length</span>(cats), <span class="at">palette =</span> <span class="st">"vik"</span>), cats)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a><span class="co"># build data </span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>stacked_chart <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Glucose_Category)) <span class="sc">%&gt;%</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time =</span> <span class="fu">floor_date</span>(Timestamp, <span class="st">"5 minutes"</span>),</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">TimeOnly =</span> <span class="fu">format</span>(Time, <span class="st">"%H:%M:%S"</span>),</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">TimeOnly_POSIX =</span> <span class="fu">as.POSIXct</span>(TimeOnly, <span class="at">format =</span> <span class="st">"%H:%M:%S"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(ID, TimeOnly_POSIX, Glucose_Category) <span class="sc">%&gt;%</span></span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, TimeOnly_POSIX) <span class="sc">%&gt;%</span></span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(ID, TimeOnly_POSIX, Glucose_Category,</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="dv">0</span>, <span class="at">percentage =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">factor</span>(Glucose_Category, <span class="at">levels =</span> cats)</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, TimeOnly_POSIX, Glucose_Category)  <span class="co"># ensure proper draw order</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a><span class="co"># plot with discrete Scientific colours</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stacked_chart,</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> TimeOnly_POSIX, <span class="at">y =</span> percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>() <span class="sc">+</span>                                   <span class="co"># default is stacked</span></span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal, <span class="at">drop =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="co"># DISCRETE palette</span></span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Time"</span>, <span class="at">y =</span> <span class="st">"Percentage"</span>, <span class="at">fill =</span> <span class="st">"Glucose Category"</span>) <span class="sc">+</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="improved-visualization-of-high-low-and-very-low" class="level3">
<h3 class="anchored" data-anchor-id="improved-visualization-of-high-low-and-very-low">Improved visualization of High, Low and Very Low</h3>
<p><strong>Description:</strong> Facet per Category and ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(stacked_chart, </span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> TimeOnly_POSIX, <span class="at">y =</span> percentage)) <span class="sc">+</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(Glucose_Category <span class="sc">~</span> ID) <span class="sc">+</span>  <span class="co"># Facet per Category &amp; ID</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion"</span>, <span class="at">x =</span> <span class="st">"Time of Day"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> log10</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stacked_chart, </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> TimeOnly_POSIX, <span class="at">y =</span> percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_area</span>() <span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_log10</span>()<span class="sc">+</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in scale_y_log10(): log-10 transformation introduced infinite values.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 3019 rows containing non-finite outside the scale range
(`stat_align()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Show lower 25% only</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder "High" to make visualization possible</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>stacked_chart_25 <span class="ot">&lt;-</span> stacked_chart <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">Glucose_Category =</span> <span class="fu">factor</span>(Glucose_Category, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"High"</span>, <span class="st">"Low"</span>, <span class="st">"Very Low"</span>)))</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(stacked_chart_25, </span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">aes</span>(<span class="at">x =</span> TimeOnly_POSIX, <span class="at">y =</span> percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_area</span>() <span class="sc">+</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>)) <span class="sc">+</span>  <span class="co"># only show until 25%</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion"</span>, <span class="at">x =</span> <span class="st">"Time of Day"</span>) <span class="sc">+</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb89-15"><a href="#cb89-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Show 25% with Scientific Colour Map</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>stacked_chart_25 <span class="ot">&lt;-</span> stacked_chart <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">factor</span>(Glucose_Category, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"High"</span>, <span class="st">"Low"</span>, <span class="st">"Very Low"</span>)))</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stacked_chart_25, </span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> TimeOnly_POSIX, <span class="at">y =</span> percentage, <span class="at">fill =</span> Glucose_Category)) <span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>() <span class="sc">+</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> pal, <span class="at">drop =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>) <span class="sc">+</span></span>
<span id="cb90-10"><a href="#cb90-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>)) <span class="sc">+</span>  <span class="co"># only show until 25%</span></span>
<span id="cb90-11"><a href="#cb90-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span>  </span>
<span id="cb90-12"><a href="#cb90-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Proportion"</span>, <span class="at">x =</span> <span class="st">"Time of Day"</span>) <span class="sc">+</span></span>
<span id="cb90-13"><a href="#cb90-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb90-14"><a href="#cb90-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb90-15"><a href="#cb90-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="spike-analysis" class="level2">
<h2 class="anchored" data-anchor-id="spike-analysis">Spike Analysis</h2>
<section id="category-change" class="level3">
<h3 class="anchored" data-anchor-id="category-change">Category Change</h3>
<p><strong>Description:</strong> How often does the Glucose Value Change from one Category to Another</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>spike_analysis <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, Timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">"Very Low"</span>,</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">54</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">180</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"Very High"</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Prev_Category =</span> <span class="fu">lag</span>(Glucose_Category),</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Prev_ID =</span> <span class="fu">lag</span>(ID),</span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Prev_Time_of_Day =</span> <span class="fu">lag</span>(Time_of_Day),</span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Spike =</span> Glucose_Category <span class="sc">!=</span> Prev_Category <span class="sc">&amp;</span> ID <span class="sc">==</span> Prev_ID <span class="sc">&amp;</span> Time_of_Day <span class="sc">==</span> Prev_Time_of_Day</span>
<span id="cb91-16"><a href="#cb91-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb91-17"><a href="#cb91-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Spike) <span class="sc">%&gt;%</span></span>
<span id="cb91-18"><a href="#cb91-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-19"><a href="#cb91-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">From =</span> Prev_Category,</span>
<span id="cb91-20"><a href="#cb91-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">To =</span> Glucose_Category</span>
<span id="cb91-21"><a href="#cb91-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb91-22"><a href="#cb91-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-23"><a href="#cb91-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Spike_Direction =</span> <span class="fu">paste0</span>(Prev_Category, <span class="st">" → "</span>, Glucose_Category)</span>
<span id="cb91-24"><a href="#cb91-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb91-25"><a href="#cb91-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day, Spike_Direction, From, To) <span class="sc">%&gt;%</span></span>
<span id="cb91-26"><a href="#cb91-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Spike_Count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb91-27"><a href="#cb91-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-28"><a href="#cb91-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-29"><a href="#cb91-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-30"><a href="#cb91-30" aria-hidden="true" tabindex="-1"></a>spike_percent <span class="ot">&lt;-</span> spike_analysis <span class="sc">%&gt;%</span></span>
<span id="cb91-31"><a href="#cb91-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day) <span class="sc">%&gt;%</span></span>
<span id="cb91-32"><a href="#cb91-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb91-33"><a href="#cb91-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Spikes =</span> <span class="fu">sum</span>(Spike_Count),</span>
<span id="cb91-34"><a href="#cb91-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">Percentage =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> Spike_Count <span class="sc">/</span> Total_Spikes, <span class="dv">1</span>)</span>
<span id="cb91-35"><a href="#cb91-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb91-36"><a href="#cb91-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Plot the Category Change in Percent</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spike_percent, <span class="fu">aes</span>(<span class="at">x =</span> Spike_Direction, <span class="at">y =</span> Percentage, <span class="at">fill =</span> Spike_Direction)) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(ID <span class="sc">~</span> Time_of_Day) <span class="sc">+</span>  <span class="co"># Rows = IDs, Columns = Day/Night</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Changes Between Glucose Categories (Spikes)"</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Category Changes"</span>,</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Percentage (%)"</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot the Category Change in Count</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spike_analysis, <span class="fu">aes</span>(<span class="at">x =</span> Spike_Direction, <span class="at">y =</span> Spike_Count, <span class="at">fill =</span> Spike_Direction)) <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Changes Between Glucose Categories (Spikes)"</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Category Change"</span>,</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb93-11"><a href="#cb93-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Create a heat map</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>category_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Very Low"</span>, <span class="st">"Low"</span>, <span class="st">"Normal"</span>, <span class="st">"High"</span>, <span class="st">"Very High"</span>)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>spike_percent <span class="ot">&lt;-</span> spike_percent <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">From =</span> <span class="fu">factor</span>(From, <span class="at">levels =</span> category_levels),</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">To =</span> <span class="fu">factor</span>(To, <span class="at">levels =</span> category_levels)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spike_percent, <span class="fu">aes</span>(<span class="at">x =</span> To, <span class="at">y =</span> From, <span class="at">fill =</span> Percentage)) <span class="sc">+</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> Percentage), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(ID <span class="sc">~</span> Time_of_Day) <span class="sc">+</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Transition Heatmap Between Glucose Categories"</span>,</span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Current Category"</span>,</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Previous Category"</span>,</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Percent (%)"</span></span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Create a Heatmap with heatmap() Function and for all IDs</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize raw counts, not percentages</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>overall_data <span class="ot">&lt;-</span> spike_analysis <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Spike_Direction, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"From"</span>, <span class="st">"To"</span>), <span class="at">sep =</span> <span class="st">" → "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(From, To) <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Total_Spike_Count =</span> <span class="fu">sum</span>(Spike_Count), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Total transitions for percentage calculation</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>total_spikes_all <span class="ot">&lt;-</span> <span class="fu">sum</span>(overall_data<span class="sc">$</span>Total_Spike_Count)</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute true overall percentage</span></span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>overall_data <span class="ot">&lt;-</span> overall_data <span class="sc">%&gt;%</span></span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Percentage =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> Total_Spike_Count <span class="sc">/</span> total_spikes_all, <span class="dv">1</span>),</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">From =</span> <span class="fu">factor</span>(From, <span class="at">levels =</span> category_levels),</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">To =</span> <span class="fu">factor</span>(To, <span class="at">levels =</span> category_levels)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Create matrix for pheatmap with reversed row order</span></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>heatmap_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, </span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="fu">length</span>(category_levels), </span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="fu">length</span>(category_levels),</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">From =</span> <span class="fu">rev</span>(category_levels), <span class="at">To =</span> category_levels)</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Populate matrix</span></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(overall_data))) {</span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>  row <span class="ot">&lt;-</span> overall_data<span class="sc">$</span>From[i]</span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">&lt;-</span> overall_data<span class="sc">$</span>To[i]</span>
<span id="cb95-33"><a href="#cb95-33" aria-hidden="true" tabindex="-1"></a>  val <span class="ot">&lt;-</span> overall_data<span class="sc">$</span>Percentage[i]</span>
<span id="cb95-34"><a href="#cb95-34" aria-hidden="true" tabindex="-1"></a>  heatmap_matrix[<span class="fu">as.character</span>(row), <span class="fu">as.character</span>(col)] <span class="ot">&lt;-</span> val</span>
<span id="cb95-35"><a href="#cb95-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb95-36"><a href="#cb95-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-37"><a href="#cb95-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with correct percentages: using pheatmap() function to be able to integrate percentages</span></span>
<span id="cb95-38"><a href="#cb95-38" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(</span>
<span id="cb95-39"><a href="#cb95-39" aria-hidden="true" tabindex="-1"></a>  heatmap_matrix,</span>
<span id="cb95-40"><a href="#cb95-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">display_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb95-41"><a href="#cb95-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">number_format =</span> <span class="st">"%.1f"</span>,  </span>
<span id="cb95-42"><a href="#cb95-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> <span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"steelblue"</span>))(<span class="dv">100</span>),</span>
<span id="cb95-43"><a href="#cb95-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_rows =</span> <span class="cn">FALSE</span>,</span>
<span id="cb95-44"><a href="#cb95-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster_cols =</span> <span class="cn">FALSE</span>,</span>
<span id="cb95-45"><a href="#cb95-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"Category Change (Overall Study Percentage)"</span>,</span>
<span id="cb95-46"><a href="#cb95-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">angle_col =</span> <span class="dv">45</span></span>
<span id="cb95-47"><a href="#cb95-47" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spike-duration" class="level3">
<h3 class="anchored" data-anchor-id="spike-duration">Spike Duration</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>spike_durations <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ID, Timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Glucose_Category =</span> <span class="fu">case_when</span>(</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">54</span> <span class="sc">~</span> <span class="st">"Very Low"</span>,</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">54</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;</span> <span class="dv">70</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;=</span> <span class="dv">70</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">180</span> <span class="sc">~</span> <span class="st">"Normal"</span>,</span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">180</span> <span class="sc">&amp;</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"High"</span>,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">&gt;</span> <span class="dv">250</span> <span class="sc">~</span> <span class="st">"Very High"</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Category_Change =</span> Glucose_Category <span class="sc">!=</span> <span class="fu">lag</span>(Glucose_Category) <span class="sc">|</span> ID <span class="sc">!=</span> <span class="fu">lag</span>(ID)</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Group consecutive identical categories per ID</span></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Spike_Group =</span> <span class="fu">cumsum</span>(<span class="fu">replace_na</span>(Category_Change, <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Spike_Group) <span class="sc">%&gt;%</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Start =</span> <span class="fu">min</span>(Timestamp),</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">End =</span> <span class="fu">max</span>(Timestamp),</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Duration_min =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="fu">max</span>(Timestamp), <span class="fu">min</span>(Timestamp), <span class="at">units =</span> <span class="st">"mins"</span>)),</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Category =</span> <span class="fu">first</span>(Glucose_Category),</span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter for spikes only (exclude normal periods)</span></span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Category <span class="sc">!=</span> <span class="st">"Normal"</span>)</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a><span class="co"># View spike durations</span></span>
<span id="cb96-27"><a href="#cb96-27" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(spike_durations)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
  ID    Spike_Group Start               End                 Duration_min
  &lt;chr&gt;       &lt;int&gt; &lt;dttm&gt;              &lt;dttm&gt;                     &lt;dbl&gt;
1 102             2 2024-03-12 02:22:00 2024-03-12 02:52:00           30
2 102             4 2024-03-25 20:21:00 2024-03-25 20:21:00            0
3 102             6 2024-03-27 01:11:00 2024-03-27 01:26:00           15
4 102             8 2024-03-28 16:41:00 2024-03-28 16:46:00            5
5 102            10 2024-04-06 08:01:00 2024-04-06 08:01:00            0
6 102            12 2024-04-09 17:20:00 2024-04-09 17:55:00           35
# ℹ 1 more variable: Category &lt;chr&gt;</code></pre>
</div>
</div>
<p><strong>Description:</strong> Plot the Statistics of Spike Duration</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall statistics</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>spike_stats <span class="ot">&lt;-</span> spike_durations <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Category) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Count =</span> <span class="fu">n</span>(),</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median_Duration =</span> <span class="fu">median</span>(Duration_min),</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean_Duration =</span> <span class="fu">round</span>(<span class="fu">mean</span>(Duration_min), <span class="dv">1</span>),</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max_Duration =</span> <span class="fu">max</span>(Duration_min),</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min_Duration =</span> <span class="fu">min</span>(Duration_min),</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics per ID</span></span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a>spike_subject_stats <span class="ot">&lt;-</span> spike_durations <span class="sc">%&gt;%</span></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Category) <span class="sc">%&gt;%</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Episodes =</span> <span class="fu">n</span>(),</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Total_Duration =</span> <span class="fu">sum</span>(Duration_min),</span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median_Duration =</span> <span class="fu">median</span>(Duration_min),</span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Plot the Frequency of Glucose Spike Duration</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spike_durations, <span class="fu">aes</span>(<span class="at">x =</span> Duration_min, <span class="at">fill =</span> Category)) <span class="sc">+</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"stack"</span>) <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Frequency of Glucose Spike Durations by Category"</span>,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Spike Duration (minutes)"</span>,</span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Glucose Category"</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">200</span>)) <span class="sc">+</span> <span class="co"># scale only until 200, for the most frequent durations</span></span>
<span id="cb99-11"><a href="#cb99-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb99-12"><a href="#cb99-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb99-13"><a href="#cb99-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb99-14"><a href="#cb99-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot the Spikes over time</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(spike_durations, <span class="fu">aes</span>(<span class="at">x =</span> Start, <span class="at">xend =</span> End, <span class="at">y =</span> ID, <span class="at">yend =</span> ID, <span class="at">color =</span> Category)) <span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">size =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> category_colors) <span class="sc">+</span>  </span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Glucose Spikes Over Time"</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Participant ID"</span>,</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Glucose Category"</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="day-and-night-analysis" class="level2">
<h2 class="anchored" data-anchor-id="day-and-night-analysis">Day and Night Analysis</h2>
<section id="defining-day-and-night" class="level3">
<h3 class="anchored" data-anchor-id="defining-day-and-night">Defining Day and Night</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>cleaned_data_deduplicated <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour =</span> <span class="fu">hour</span>(Timestamp),</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time_of_Day =</span> <span class="fu">case_when</span>(</span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>      Hour <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;</span> Hour <span class="sc">&lt;</span> <span class="dv">22</span> <span class="sc">~</span> <span class="st">"Day"</span>,</span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Night"</span></span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-day-vs-night" class="level3">
<h3 class="anchored" data-anchor-id="plotting-day-vs-night">Plotting Day vs Night</h3>
<p><strong>Description:</strong> Plot 1</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cleaned_data_deduplicated, <span class="fu">aes</span>(<span class="at">x =</span> Timestamp, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">color =</span> Time_of_Day)) <span class="sc">+</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Time of Day"</span>, <span class="at">title =</span> <span class="st">"Glucose Values over Time: Day vs. Night"</span>)<span class="sc">+</span></span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>   )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cleaned_data_deduplicated, <span class="fu">aes</span>(<span class="at">x =</span> Time_of_Day, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">fill =</span> Time_of_Day)) <span class="sc">+</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Glucose Values: Day vs. Night"</span>,<span class="at">fill =</span> <span class="st">"Time of Day"</span> , <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-59-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Table for Numbers of Boxplot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>glucose_summary_table <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Time_of_Day) <span class="sc">%&gt;%</span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median =</span> <span class="fu">median</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>),</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min =</span> <span class="fu">min</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q1 =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="fl">0.25</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Q3 =</span> <span class="fu">quantile</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="fl">0.75</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max =</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(glucose_summary_table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 9
   ID    Time_of_Day     n Median  Mean   Min    Q1    Q3   Max
   &lt;chr&gt; &lt;chr&gt;       &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
 1 102   Day         51390    101 102.     40    92   111   196
 2 102   Night       25841     96  96.1    40    89   103   160
 3 104   Day         61059    100 100.     40    92   108   223
 4 104   Night       30534     99  99.5    40    91   107   191
 5 107   Day         37616     98  99.8    40    88   109   197
 6 107   Night       18494     98 100      40    89   109   175
 7 108   Day          8004    108 110.     53    98   120   193
 8 108   Night        4031     98  98      52    91   106   163
 9 109   Day         30039    101 103.     43    94   111   179
10 109   Night       15131     98  99.7    40    90   107   168
11 112   Day         46418     93  95.7    40    84   105   233
12 112   Night       23064     92  94.4    40    83   104   213</code></pre>
</div>
</div>
<p><strong>Description:</strong> Plot 2</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cleaned_data_deduplicated, <span class="fu">aes</span>(<span class="at">x =</span> Timestamp, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">color =</span> Time_of_Day)) <span class="sc">+</span><span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Day"</span> <span class="ot">=</span> <span class="st">"orange3"</span>, <span class="st">"Night"</span> <span class="ot">=</span> <span class="st">"midnightblue"</span>)) <span class="sc">+</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Glucose trend over time: Day vs. Night"</span>,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time"</span>,</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time of Day"</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot 3: Daily mean over time + standard deviation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataset with mean and standard deviation</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  cleaned_summary <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">Date =</span> <span class="fu">as.Date</span>(Timestamp)  <span class="co"># date of day</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(ID, Time_of_Day, Date) <span class="sc">%&gt;%</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_glucose =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_glucose   =</span> <span class="fu">sd</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Plot</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(cleaned_summary, <span class="fu">aes</span>(<span class="at">x =</span> Date, <span class="at">y =</span> mean_glucose, <span class="at">color =</span> Time_of_Day, <span class="at">fill =</span> Time_of_Day)) <span class="sc">+</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean_glucose <span class="sc">-</span> sd_glucose, <span class="at">ymax =</span> mean_glucose <span class="sc">+</span> sd_glucose), <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Day"</span> <span class="ot">=</span> <span class="st">"orange3"</span>, <span class="st">"Night"</span> <span class="ot">=</span> <span class="st">"midnightblue"</span>)) <span class="sc">+</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Day"</span> <span class="ot">=</span> <span class="st">"orange3"</span>, <span class="st">"Night"</span> <span class="ot">=</span> <span class="st">"midnightblue"</span>)) <span class="sc">+</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Daily Mean Glucose with Standard Deviation (Day vs. Night)"</span>,</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Mean Glucose (mg/dl)"</span>,</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> <span class="st">"Time of Day"</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nighttime-glucose-hourly-bins" class="level3">
<h3 class="anchored" data-anchor-id="nighttime-glucose-hourly-bins">Nighttime Glucose: Hourly Bins</h3>
<p><strong>Description:</strong> Prepare Data for Graph</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for night data</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>night_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hour =</span> <span class="fu">hour</span>(Timestamp)) <span class="sc">%&gt;%</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Hour <span class="sc">&gt;=</span> <span class="dv">22</span> <span class="sc">|</span> Hour <span class="sc">&lt;</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span>  <span class="co"># Nighttime: 22 to 6:59</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create reordered factor for plotting (22 to 6)</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hour_Factor =</span> <span class="fu">factor</span>(Hour, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)))</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average glucose per hour per ID</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>night_avg <span class="ot">&lt;-</span> night_data <span class="sc">%&gt;%</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Hour_Factor) <span class="sc">%&gt;%</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Avg_Glucose =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Plot the night</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(night_avg, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Factor, <span class="at">y =</span> Avg_Glucose, <span class="at">group =</span> ID, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Nighttime Glucose Trends per ID"</span>,</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Hours from 22:00 to 06:59: hourly bins"</span>,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Night"</span>,</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span>,</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"ID"</span></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Boxplot of Average Glucose per Hour</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Boxplot</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(night_data, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Factor, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">fill =</span> Hour_Factor)) <span class="sc">+</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">outlier.size =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Blues"</span>) <span class="sc">+</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Nighttime Glucose Distribution per Hour and ID"</span>,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Hours from 22:00 to 06:59"</span>,</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Night"</span>,</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>,</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Hour"</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nighttime-glucose-5min-bins" class="level3">
<h3 class="anchored" data-anchor-id="nighttime-glucose-5min-bins">Nighttime Glucose: 5min bins</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 5min bins</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>night_data <span class="ot">&lt;-</span> night_data <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Minute5 =</span> <span class="fu">floor_date</span>(Timestamp, <span class="at">unit =</span> <span class="st">"5 minutes"</span>),</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Minute5 =</span> <span class="fu">format</span>(Minute5, <span class="st">"%H:%M"</span>))</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate mean and standard deviation</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>night_avg_5 <span class="ot">&lt;-</span> night_data <span class="sc">%&gt;%</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Minute5) <span class="sc">%&gt;%</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Avg_Glucose_5 =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sd_Glucose_5 =</span> <span class="fu">sd</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create levels for right order</span></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>levels_ordered <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq.POSIXt</span>(</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-01-01 22:00"</span>),</span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">to   =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-01-02 06:00"</span>),</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">by   =</span> <span class="st">"5 min"</span></span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>), <span class="st">"%H:%M"</span>)</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create reordered factor for plotting</span></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>night_avg_5 <span class="ot">&lt;-</span> night_avg_5 <span class="sc">%&gt;%</span></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Minute5_Factor =</span> <span class="fu">factor</span>(Minute5, <span class="at">levels =</span> levels_ordered))</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a><span class="co"># cretae labels for x axis</span></span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>hour_labels <span class="ot">&lt;-</span> <span class="fu">format</span>(<span class="fu">seq.POSIXt</span>(</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-01-01 22:00"</span>),</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2024-01-02 06:00"</span>),</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"1 hour"</span></span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>), <span class="st">"%H:%M"</span>)</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Create one plot for all</span></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(night_avg_5, <span class="fu">aes</span>(<span class="at">x =</span> Minute5_Factor, <span class="at">y =</span> Avg_Glucose_5, <span class="at">group =</span> ID, <span class="at">color =</span> ID, <span class="at">fill =</span> ID)) <span class="sc">+</span></span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Avg_Glucose_5 <span class="sc">-</span> Sd_Glucose_5, <span class="at">ymax =</span> Avg_Glucose_5 <span class="sc">+</span> Sd_Glucose_5), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> hour_labels) <span class="sc">+</span></span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Nighttime Glucose Trends per ID"</span>,</span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Hours from 22:00 to 06:00: 5min bins"</span>,</span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Night"</span>,</span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span>,</span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"ID"</span></span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>  )   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create one plot per ID</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(night_avg_5, <span class="fu">aes</span>(<span class="at">x =</span> Minute5_Factor, <span class="at">y =</span> Avg_Glucose_5, <span class="at">group =</span> ID, <span class="at">color =</span> ID, <span class="at">fill =</span> ID)) <span class="sc">+</span></span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Avg_Glucose_5 <span class="sc">-</span> Sd_Glucose_5, <span class="at">ymax =</span> Avg_Glucose_5 <span class="sc">+</span> Sd_Glucose_5), <span class="at">alpha =</span> <span class="fl">0.1</span>, <span class="at">color =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> hour_labels) <span class="sc">+</span></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID) <span class="sc">+</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Nighttime Glucose Trends per ID"</span>,</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Hours from 22:00 to 06:00: 5min bins"</span>,</span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Night"</span>,</span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span>,</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"ID"</span></span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-66-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="create-a-double-plot" class="level3">
<h3 class="anchored" data-anchor-id="create-a-double-plot">Create a double plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract time-of-day in hours and add ID names without "Ecosleep"</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>double_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Date =</span> <span class="fu">as.Date</span>(Timestamp),</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour =</span> <span class="fu">hour</span>(Timestamp),</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Minute =</span> <span class="fu">minute</span>(Timestamp),</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Time_of_Day =</span> Hour <span class="sc">+</span> Minute <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Duplicate data: original time + shifted by 24h</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>double_data_long <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>  double_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Double_Hour =</span> Time_of_Day),</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>  double_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Double_Hour =</span> Time_of_Day <span class="sc">+</span> <span class="dv">24</span>)</span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Round down to full hour and keep the original 0–47 factor for correct time ordering</span></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>double_avg <span class="ot">&lt;-</span> double_data_long <span class="sc">%&gt;%</span></span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Hour_Rounded =</span> <span class="fu">floor</span>(Double_Hour)) <span class="sc">%&gt;%</span></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Hour_Rounded) <span class="sc">%&gt;%</span></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg_Glucose =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Display_Hour =</span> Hour_Rounded <span class="sc">%%</span> <span class="dv">24</span>,</span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">Day =</span> <span class="fu">ifelse</span>(Hour_Rounded <span class="sc">&lt;</span> <span class="dv">24</span>, <span class="st">"Day 1"</span>, <span class="st">"Day 2"</span>),</span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour_Label =</span> <span class="fu">paste0</span>(Day, <span class="st">" – "</span>, <span class="fu">sprintf</span>(<span class="st">"%02d:00"</span>, Display_Hour)),</span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour_Factor =</span> <span class="fu">factor</span>(Hour_Label, <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Day 1 – "</span>, <span class="fu">sprintf</span>(<span class="st">"%02d:00"</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">23</span>)),</span>
<span id="cb117-27"><a href="#cb117-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"Day 2 – "</span>, <span class="fu">sprintf</span>(<span class="st">"%02d:00"</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">23</span>))</span>
<span id="cb117-28"><a href="#cb117-28" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb117-29"><a href="#cb117-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb117-30"><a href="#cb117-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-31"><a href="#cb117-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-32"><a href="#cb117-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb117-33"><a href="#cb117-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(double_avg, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Factor, <span class="at">y =</span> Avg_Glucose, <span class="at">group =</span> ID, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb117-34"><a href="#cb117-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb117-35"><a href="#cb117-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb117-36"><a href="#cb117-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb117-37"><a href="#cb117-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Double Plot: 48-Hour Glucose Trends per ID"</span>,</span>
<span id="cb117-38"><a href="#cb117-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Same 24h cycle shown twice to visualize rhythm"</span>,</span>
<span id="cb117-39"><a href="#cb117-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day (Repeated)"</span>,</span>
<span id="cb117-40"><a href="#cb117-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span>,</span>
<span id="cb117-41"><a href="#cb117-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"ID"</span></span>
<span id="cb117-42"><a href="#cb117-42" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb117-43"><a href="#cb117-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb117-44"><a href="#cb117-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(</span>
<span id="cb117-45"><a href="#cb117-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">levels</span>(double_avg<span class="sc">$</span>Hour_Factor)[<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">48</span>, <span class="at">by =</span> <span class="dv">4</span>)]</span>
<span id="cb117-46"><a href="#cb117-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb117-47"><a href="#cb117-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb117-48"><a href="#cb117-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb117-49"><a href="#cb117-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb117-50"><a href="#cb117-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb117-51"><a href="#cb117-51" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cosine-fit" class="level2">
<h2 class="anchored" data-anchor-id="cosine-fit">Cosine fit</h2>
<section id="first-fit-for-every-id" class="level3">
<h3 class="anchored" data-anchor-id="first-fit-for-every-id">First fit for every ID</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for ID 102</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>fit_data_102 <span class="ot">&lt;-</span> double_avg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"102"</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit cosine model (period 24h)</span></span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>cos_fit_102 <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  Avg_Glucose <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> Hour_Rounded <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fit_data_102,</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)  <span class="co"># rough starting guesses</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-11"><a href="#cb118-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_102)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: Avg_Glucose ~ A * cos(2 * pi/24 * Hour_Rounded + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A   -6.37619    0.30189  -21.12   &lt;2e-16 ***
phi -1.17838    0.04735  -24.89   &lt;2e-16 ***
C   99.79182    0.21347  467.47   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.479 on 45 degrees of freedom

Number of iterations to convergence: 8 
Achieved convergence tolerance: 7.629e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add predicted values</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>fit_data_102 <span class="ot">&lt;-</span> fit_data_102 <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_102))</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot actual vs fitted</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit_data_102, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Rounded)) <span class="sc">+</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Avg_Glucose), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb120-10"><a href="#cb120-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cosine Fit for 102"</span>,</span>
<span id="cb120-11"><a href="#cb120-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day (0–47)"</span>,</span>
<span id="cb120-12"><a href="#cb120-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span></span>
<span id="cb120-13"><a href="#cb120-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb120-14"><a href="#cb120-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>fit_data_104 <span class="ot">&lt;-</span> double_avg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"104"</span>)</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>cos_fit_104 <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  Avg_Glucose <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> Hour_Rounded <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fit_data_104,</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>fit_data_104 <span class="ot">&lt;-</span> fit_data_104 <span class="sc">%&gt;%</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_104))</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit_data_104, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Rounded)) <span class="sc">+</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Avg_Glucose), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cosine Fit for 104"</span>,</span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day (0–47)"</span>,</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span></span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-68-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>fit_data_107 <span class="ot">&lt;-</span> double_avg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"107"</span>)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>cos_fit_107 <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>  Avg_Glucose <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> Hour_Rounded <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fit_data_107,</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>fit_data_107 <span class="ot">&lt;-</span> fit_data_107 <span class="sc">%&gt;%</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_107))</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit_data_107, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Rounded)) <span class="sc">+</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Avg_Glucose), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb122-16"><a href="#cb122-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cosine Fit for 107"</span>,</span>
<span id="cb122-17"><a href="#cb122-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day (0–47)"</span>,</span>
<span id="cb122-18"><a href="#cb122-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span></span>
<span id="cb122-19"><a href="#cb122-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb122-20"><a href="#cb122-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-68-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>fit_data_108 <span class="ot">&lt;-</span> double_avg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"108"</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>cos_fit_108 <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>  Avg_Glucose <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> Hour_Rounded <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fit_data_108,</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>fit_data_108 <span class="ot">&lt;-</span> fit_data_108 <span class="sc">%&gt;%</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_108))</span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit_data_108, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Rounded)) <span class="sc">+</span></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Avg_Glucose), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb123-16"><a href="#cb123-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cosine Fit for 108"</span>,</span>
<span id="cb123-17"><a href="#cb123-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day (0–47)"</span>,</span>
<span id="cb123-18"><a href="#cb123-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span></span>
<span id="cb123-19"><a href="#cb123-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb123-20"><a href="#cb123-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-68-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>fit_data_109 <span class="ot">&lt;-</span> double_avg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"109"</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>cos_fit_109 <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  Avg_Glucose <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> Hour_Rounded <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fit_data_109,</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>fit_data_109 <span class="ot">&lt;-</span> fit_data_109 <span class="sc">%&gt;%</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_109))</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit_data_109, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Rounded)) <span class="sc">+</span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Avg_Glucose), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cosine Fit for 109"</span>,</span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day (0–47)"</span>,</span>
<span id="cb124-18"><a href="#cb124-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span></span>
<span id="cb124-19"><a href="#cb124-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb124-20"><a href="#cb124-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-68-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>fit_data_112 <span class="ot">&lt;-</span> double_avg <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"112"</span>)</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>cos_fit_112 <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  Avg_Glucose <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> Hour_Rounded <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> fit_data_112,</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>fit_data_112 <span class="ot">&lt;-</span> fit_data_112 <span class="sc">%&gt;%</span></span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_112))</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fit_data_112, <span class="fu">aes</span>(<span class="at">x =</span> Hour_Rounded)) <span class="sc">+</span></span>
<span id="cb125-13"><a href="#cb125-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Avg_Glucose), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb125-14"><a href="#cb125-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb125-15"><a href="#cb125-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb125-16"><a href="#cb125-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cosine Fit for 112"</span>,</span>
<span id="cb125-17"><a href="#cb125-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day (0–47)"</span>,</span>
<span id="cb125-18"><a href="#cb125-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Glucose (mg/dl)"</span></span>
<span id="cb125-19"><a href="#cb125-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb125-20"><a href="#cb125-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-68-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maximum bestimmen</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>max_row <span class="ot">&lt;-</span> fit_data_102 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Fitted <span class="sc">==</span> <span class="fu">max</span>(Fitted))</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Maximum:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(max_row <span class="sc">%&gt;%</span> <span class="fu">select</span>(Hour_Rounded, Fitted))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  Hour_Rounded Fitted
         &lt;dbl&gt;  &lt;dbl&gt;
1           17   106.
2           41   106.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimum bestimmen</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>min_row <span class="ot">&lt;-</span> fit_data_102 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Fitted <span class="sc">==</span> <span class="fu">min</span>(Fitted))</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Minimum:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Minimum:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(min_row <span class="sc">%&gt;%</span> <span class="fu">select</span>(Hour_Rounded, Fitted))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  Hour_Rounded Fitted
         &lt;dbl&gt;  &lt;dbl&gt;
1            5   93.5
2           29   93.5</code></pre>
</div>
</div>
</section>
<section id="cosinus-fit-with-cosinor" class="level3">
<h3 class="anchored" data-anchor-id="cosinus-fit-with-cosinor">Cosinus Fit with Cosinor()</h3>
<p><strong>Description:</strong> Load Cosinor Package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"cosinor"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"cosinor"</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cosinor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Test Functioning of the Package with vitamind Data Set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"vitamind"</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">head</span>(vitamind)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  X        Y      time
1 0 16.12091 11.439525
2 0 29.90624  5.807104
3 1 39.17572  1.045492
4 1 35.15403  4.082983
5 1 43.67065 10.606247
6 0 31.20360  5.126054</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(Y <span class="sc">~</span> <span class="fu">time</span>(time) <span class="sc">+</span> X <span class="sc">+</span> <span class="fu">amp.acro</span>(X), <span class="at">data =</span> vitamind, <span class="at">period =</span> <span class="dv">12</span>) </span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  29.6898         0.4654  28.7776  30.6020  0.0000
X             1.9019         0.8041   0.3258   3.4779  0.0180
rrr           0.9308         0.6357  -0.3151   2.1767  0.1431
sss           6.2010         0.6805   4.8673   7.5347  0.0000
X:rrr         5.5795         1.1386   3.3479   7.8111  0.0000
X:sss        -1.3825         1.1364  -3.6097   0.8447  0.2237

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  29.6898         0.4654  28.7776  30.6020   0.000
[X = 1]       1.9019         0.8041   0.3258   3.4779   0.018
amp           6.2705         0.6799   4.9378   7.6031   0.000
[X = 1]:amp   8.0995         0.9095   6.3170   9.8820   0.000
acr           1.4218         0.1015   1.2229   1.6207   0.000
[X = 1]:acr   0.6372         0.1167   0.4084   0.8659   0.000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">test_cosinor</span>(fit, <span class="st">"X"</span>, <span class="at">param =</span> <span class="st">"amp"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Global test: 
Statistic: 
[1] 2.59


 P-value: 
[1] 0.1072

 Individual tests: 
Statistic: 
[1] 1.61


 P-value: 
[1] 0.1072

 Estimate and confidence interval[1] "1.83 (-0.4 to 4.05)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(vitamind<span class="sc">$</span>Y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  13.27   25.59   29.79   30.09   34.85   51.30 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">predict</span>(fit))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  16.10   25.98   29.26   29.69   33.59   46.48 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_cosinor.lm</span>(fit, <span class="at">x_str =</span> <span class="st">"X"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit Cosinor for ID 102</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset for cosinor model for 102</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_102_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"102"</span>) <span class="sc">%&gt;%</span>    <span class="co"># filter for 102</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp),  <span class="co">#  if format TT-MM-JJJJ HH:MM</span></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>  <span class="co"># time as decimal hour during the day</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-9"><a href="#cb146-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cosinor model</span></span>
<span id="cb146-10"><a href="#cb146-10" aria-hidden="true" tabindex="-1"></a>glucose_fit_102 <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> glucose_fit_102_data, <span class="at">period =</span> <span class="dv">24</span>) </span>
<span id="cb146-11"><a href="#cb146-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_102) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.7942         0.0503  99.6956  99.8928       0
rrr          -1.6710         0.0711  -1.8103  -1.5318       0
sss          -6.1713         0.0712  -6.3108  -6.0317       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.7942         0.0503  99.6956  99.8928       0
amp           6.3935         0.0712   6.2540   6.5330       0
acr           1.3064         0.0111   1.2846   1.3282       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># raw values</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_102_data<span class="sc">$</span><span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  40.00   91.00   99.00   99.79  108.00  196.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted values</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">predict</span>(glucose_fit_102))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  37.44   91.57   99.66   99.79  107.85  189.93 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the fit</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_cosinor.lm</span>(glucose_fit_102)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit Cosinor for Ecosleep 104</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset for cosinor model for 102Ecosleep</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_104_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"104"</span>) <span class="sc">%&gt;%</span>    <span class="co"># filter for 104</span></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp),  <span class="co">#  if format TT-MM-JJJJ HH:MM</span></span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>  <span class="co"># time as decimal hour during the day</span></span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cosinor model</span></span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>glucose_fit_104 <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> glucose_fit_104_data, <span class="at">period =</span> <span class="dv">24</span>) </span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_102) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.7942         0.0503  99.6956  99.8928       0
rrr          -1.6710         0.0711  -1.8103  -1.5318       0
sss          -6.1713         0.0712  -6.3108  -6.0317       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.7942         0.0503  99.6956  99.8928       0
amp           6.3935         0.0712   6.2540   6.5330       0
acr           1.3064         0.0111   1.2846   1.3282       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># raw values</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_104_data<span class="sc">$</span><span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
     40      92      99     100     108     223 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted values</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">predict</span>(glucose_fit_104))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  36.50   91.53   99.61  100.01  107.78  219.58 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the fit</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_cosinor.lm</span>(glucose_fit_104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit Cosinor for Ecosleep 107</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset for cosinor model for 107Ecosleep</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_107_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"107"</span>) <span class="sc">%&gt;%</span>    <span class="co"># filter for 107</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp),  <span class="co">#  if format TT-MM-JJJJ HH:MM</span></span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>  <span class="co"># time as decimal hour during the day</span></span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cosinor model</span></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a>glucose_fit_107 <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> glucose_fit_107_data, <span class="at">period =</span> <span class="dv">24</span>) </span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_107) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.8672         0.0702  99.7297 100.0047       0
rrr           3.1165         0.0992   2.9221   3.3108       0
sss          -5.2599         0.0993  -5.4545  -5.0653       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.8672         0.0702  99.7297 100.0047       0
amp           6.1138         0.0993   5.9192   6.3085       0
acr          -1.0359         0.0162  -1.0677  -1.0041       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># raw values</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_107_data<span class="sc">$</span><span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  40.00   89.00   98.00   99.87  109.00  197.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted values</span></span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">predict</span>(glucose_fit_107))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  34.14   89.62   98.86   99.87  108.84  190.93 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the fit</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_cosinor.lm</span>(glucose_fit_107)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit Cosinor for Ecosleep 108</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset for cosinor model for 107Ecosleep</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_108_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"108"</span>) <span class="sc">%&gt;%</span>    <span class="co"># filter for 107</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp),  <span class="co">#  if format TT-MM-JJJJ HH:MM</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>  <span class="co"># time as decimal hour during the day</span></span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cosinor model</span></span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a>glucose_fit_108 <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> glucose_fit_108_data, <span class="at">period =</span> <span class="dv">24</span>) </span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_108) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 105.5868         0.1440 105.3046 105.8690       0
rrr          -2.9873         0.2036  -3.3864  -2.5881       0
sss         -12.0471         0.2036 -12.4461 -11.6481       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 105.5868         0.1440 105.3046 105.8690       0
amp          12.4119         0.2034  12.0133  12.8105       0
acr           1.3277         0.0164   1.2955   1.3599       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># raw values</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_108_data<span class="sc">$</span><span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   52.0    95.0   104.0   105.6   116.0   193.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted values</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">predict</span>(glucose_fit_108))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  44.42   96.94  105.39  105.59  113.24  185.47 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the fit</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_cosinor.lm</span>(glucose_fit_108)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit Cosinor for Ecosleep 109</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset for cosinor model for 107Ecosleep</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_109_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb174-3"><a href="#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"109"</span>) <span class="sc">%&gt;%</span>    <span class="co"># filter for 109</span></span>
<span id="cb174-4"><a href="#cb174-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb174-5"><a href="#cb174-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp),  <span class="co">#  if format TT-MM-JJJJ HH:MM</span></span>
<span id="cb174-6"><a href="#cb174-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>  <span class="co"># time as decimal hour during the day</span></span>
<span id="cb174-7"><a href="#cb174-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb174-8"><a href="#cb174-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-9"><a href="#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cosinor model</span></span>
<span id="cb174-10"><a href="#cb174-10" aria-hidden="true" tabindex="-1"></a>glucose_fit_109 <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> glucose_fit_109_data, <span class="at">period =</span> <span class="dv">24</span>) </span>
<span id="cb174-11"><a href="#cb174-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_109) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 102.1091         0.0606 101.9904 102.2278       0
rrr           1.0739         0.0857   0.9060   1.2418       0
sss          -7.8340         0.0856  -8.0019  -7.6661       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 102.1091         0.0606 101.9904 102.2278       0
amp           7.9073         0.0856   7.7394   8.0751       0
acr          -1.4346         0.0108  -1.4558  -1.4133       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># raw values</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_109_data<span class="sc">$</span><span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   40.0    93.0   100.0   102.1   110.0   179.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted values</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">predict</span>(glucose_fit_109))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  38.99   93.70  101.06  102.11  109.15  184.09 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the fit</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_cosinor.lm</span>(glucose_fit_109)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit Cosinor for Ecosleep 112</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create dataset for cosinor model for 112Ecosleep</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_112_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"112"</span>) <span class="sc">%&gt;%</span>    <span class="co"># filter for 112</span></span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb181-5"><a href="#cb181-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp),  <span class="co">#  if format TT-MM-JJJJ HH:MM</span></span>
<span id="cb181-6"><a href="#cb181-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>  <span class="co"># time as decimal hour during the day</span></span>
<span id="cb181-7"><a href="#cb181-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb181-8"><a href="#cb181-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-9"><a href="#cb181-9" aria-hidden="true" tabindex="-1"></a><span class="co"># cosinor model</span></span>
<span id="cb181-10"><a href="#cb181-10" aria-hidden="true" tabindex="-1"></a>glucose_fit_112 <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> glucose_fit_112_data, <span class="at">period =</span> <span class="dv">24</span>) </span>
<span id="cb181-11"><a href="#cb181-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_112) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  95.2850         0.0603  95.1669  95.4031       0
rrr           3.3158         0.0852   3.1488   3.4827       0
sss          -8.1667         0.0853  -8.3339  -7.9996       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  95.2850         0.0603  95.1669  95.4031       0
amp           8.8142         0.0854   8.6468   8.9815       0
acr          -1.1851         0.0097  -1.2040  -1.1662       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># raw values</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_112_data<span class="sc">$</span><span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  40.00   84.00   93.00   95.29  104.00  233.00 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># adjusted values</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">predict</span>(glucose_fit_112))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  42.95   85.76   93.62   95.29  103.03  224.75 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the fit</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot_cosinor.lm</span>(glucose_fit_112)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="manual-cosine-fit" class="level3">
<h3 class="anchored" data-anchor-id="manual-cosine-fit">Manual Cosine fit</h3>
<p>with datasets prepared for fit with cosinor() function (-&gt; no hourly bins but all datapoints) <strong>Description</strong>: Fit for 102</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>cos_fit_102_orig <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> dec.time <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> glucose_fit_102_data,</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)  <span class="co"># start values</span></span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb188-6"><a href="#cb188-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-7"><a href="#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb188-8"><a href="#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_102_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A    6.39349    0.07116   89.84   &lt;2e-16 ***
phi -4.44795    0.01112 -399.88   &lt;2e-16 ***
C   99.79418    0.05030 1983.89   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.98 on 77228 degrees of freedom

Number of iterations to convergence: 10 
Achieved convergence tolerance: 1.922e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare dataset for plotting</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_102_data <span class="ot">&lt;-</span> glucose_fit_102_data <span class="sc">%&gt;%</span></span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_102_orig))</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(glucose_fit_102_data, <span class="fu">aes</span>(<span class="at">x =</span> dec.time, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span>  <span class="co"># Original glucose values</span></span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Cosinus fit</span></span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Manual Cosinus-Fit for 102 with original data"</span>,</span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"time (decimal hours)"</span>,</span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>) <span class="sc">+</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Desciption:</strong> Fit for 104</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>cos_fit_104_orig <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> dec.time <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> glucose_fit_104_data,</span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)  <span class="co"># start values</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_104_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A     3.50090    0.06912   50.65   &lt;2e-16 ***
phi   1.29380    0.01973   65.56   &lt;2e-16 ***
C   100.01206    0.04886 2046.78   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14.79 on 91590 degrees of freedom

Number of iterations to convergence: 7 
Achieved convergence tolerance: 1.57e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare dataset for plotting</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_104_data <span class="ot">&lt;-</span> glucose_fit_104_data <span class="sc">%&gt;%</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_104_orig))</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(glucose_fit_104_data, <span class="fu">aes</span>(<span class="at">x =</span> dec.time, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span>  <span class="co"># Original glucose values</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Cosinus fit</span></span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Manual Cosinus-Fit for 104 with original data"</span>,</span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"time (decimal hours)"</span>,</span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>) <span class="sc">+</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Desciption:</strong> Fit for 107</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a>cos_fit_107_orig <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb194-2"><a href="#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> dec.time <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb194-3"><a href="#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> glucose_fit_107_data,</span>
<span id="cb194-4"><a href="#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)  <span class="co"># start values</span></span>
<span id="cb194-5"><a href="#cb194-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb194-6"><a href="#cb194-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-7"><a href="#cb194-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb194-8"><a href="#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_107_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A    6.11375    0.09932   61.56   &lt;2e-16 ***
phi  1.03591    0.01622   63.88   &lt;2e-16 ***
C   99.86721    0.07017 1423.26   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.62 on 56107 degrees of freedom

Number of iterations to convergence: 5 
Achieved convergence tolerance: 3.927e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare dataset for plotting</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_107_data <span class="ot">&lt;-</span> glucose_fit_107_data <span class="sc">%&gt;%</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_107_orig))</span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(glucose_fit_107_data, <span class="fu">aes</span>(<span class="at">x =</span> dec.time, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span>  <span class="co"># Original glucose values</span></span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Cosinus fit</span></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Manual Cosinus-Fit for 107 with original data"</span>,</span>
<span id="cb196-10"><a href="#cb196-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"time (decimal hours)"</span>,</span>
<span id="cb196-11"><a href="#cb196-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>) <span class="sc">+</span></span>
<span id="cb196-12"><a href="#cb196-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit for 108</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>cos_fit_108_orig <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> dec.time <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> glucose_fit_108_data,</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)  <span class="co"># start values</span></span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_108_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A    12.41194    0.20337   61.03   &lt;2e-16 ***
phi  20.66341    0.01642 1258.09   &lt;2e-16 ***
C   105.58679    0.14398  733.36   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.79 on 12032 degrees of freedom

Number of iterations to convergence: 11 
Achieved convergence tolerance: 2.572e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare dataset for plotting</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_108_data <span class="ot">&lt;-</span> glucose_fit_108_data <span class="sc">%&gt;%</span></span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_108_orig))</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(glucose_fit_108_data, <span class="fu">aes</span>(<span class="at">x =</span> dec.time, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span>  <span class="co"># Original glucose values</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Cosinus fit</span></span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Manual Cosinus-Fit for 108 with original data"</span>,</span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"time (decimal hours)"</span>,</span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>) <span class="sc">+</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit for 109</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a>cos_fit_109_orig <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> dec.time <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> glucose_fit_109_data,</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)  <span class="co"># start values</span></span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_109_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A     7.90726    0.08563   92.35   &lt;2e-16 ***
phi   1.43456    0.01083  132.41   &lt;2e-16 ***
C   102.10915    0.06056 1686.00   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 12.87 on 45167 degrees of freedom

Number of iterations to convergence: 7 
Achieved convergence tolerance: 2.21e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare dataset for plotting</span></span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_109_data <span class="ot">&lt;-</span> glucose_fit_109_data <span class="sc">%&gt;%</span></span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_109_orig))</span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-5"><a href="#cb202-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-6"><a href="#cb202-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(glucose_fit_109_data, <span class="fu">aes</span>(<span class="at">x =</span> dec.time, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb202-7"><a href="#cb202-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span>  <span class="co"># Original glucose values</span></span>
<span id="cb202-8"><a href="#cb202-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Cosinus fit</span></span>
<span id="cb202-9"><a href="#cb202-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Manual Cosinus-Fit for 109 with original data"</span>,</span>
<span id="cb202-10"><a href="#cb202-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"time (decimal hours)"</span>,</span>
<span id="cb202-11"><a href="#cb202-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>) <span class="sc">+</span></span>
<span id="cb202-12"><a href="#cb202-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit for 112</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>cos_fit_112_orig <span class="ot">&lt;-</span> <span class="fu">nls</span>(</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> A <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">/</span> <span class="dv">24</span> <span class="sc">*</span> dec.time <span class="sc">+</span> phi) <span class="sc">+</span> C,</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> glucose_fit_112_data,</span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">A =</span> <span class="dv">10</span>, <span class="at">phi =</span> <span class="dv">0</span>, <span class="at">C =</span> <span class="dv">100</span>)  <span class="co"># start values</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Ergebnis anzeigen</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_112_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A    8.814174   0.085380   103.2   &lt;2e-16 ***
phi  1.185119   0.009654   122.8   &lt;2e-16 ***
C   95.285018   0.060273  1580.9   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.89 on 69479 degrees of freedom

Number of iterations to convergence: 5 
Achieved convergence tolerance: 3.39e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare dataset for plotting</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_112_data <span class="ot">&lt;-</span> glucose_fit_112_data <span class="sc">%&gt;%</span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Fitted =</span> <span class="fu">predict</span>(cos_fit_112_orig))</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(glucose_fit_112_data, <span class="fu">aes</span>(<span class="at">x =</span> dec.time, <span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"grey"</span>) <span class="sc">+</span>  <span class="co"># Original glucose values</span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Fitted), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Cosinus fit</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Manual Cosinus-Fit for 112 with original data"</span>,</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"time (decimal hours)"</span>,</span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>) <span class="sc">+</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="comparison-of-outputs-of-the-different-fits" class="level3">
<h3 class="anchored" data-anchor-id="comparison-of-outputs-of-the-different-fits">Comparison of outputs of the different fits</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_102)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: Avg_Glucose ~ A * cos(2 * pi/24 * Hour_Rounded + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A   -6.37619    0.30189  -21.12   &lt;2e-16 ***
phi -1.17838    0.04735  -24.89   &lt;2e-16 ***
C   99.79182    0.21347  467.47   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.479 on 45 degrees of freedom

Number of iterations to convergence: 8 
Achieved convergence tolerance: 7.629e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_102)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.7942         0.0503  99.6956  99.8928       0
rrr          -1.6710         0.0711  -1.8103  -1.5318       0
sss          -6.1713         0.0712  -6.3108  -6.0317       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.7942         0.0503  99.6956  99.8928       0
amp           6.3935         0.0712   6.2540   6.5330       0
acr           1.3064         0.0111   1.2846   1.3282       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_102_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A    6.39349    0.07116   89.84   &lt;2e-16 ***
phi -4.44795    0.01112 -399.88   &lt;2e-16 ***
C   99.79418    0.05030 1983.89   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.98 on 77228 degrees of freedom

Number of iterations to convergence: 10 
Achieved convergence tolerance: 1.922e-07</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: Avg_Glucose ~ A * cos(2 * pi/24 * Hour_Rounded + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A     3.48348    0.34795   10.01 5.02e-13 ***
phi   1.41791    0.09989   14.20  &lt; 2e-16 ***
C   100.01349    0.24604  406.49  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.705 on 45 degrees of freedom

Number of iterations to convergence: 7 
Achieved convergence tolerance: 4.319e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_104)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 100.0121         0.0489  99.9163 100.1078       0
rrr           0.9574         0.0691   0.8220   1.0928       0
sss          -3.3675         0.0691  -3.5029  -3.2320       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 100.0121         0.0489  99.9163 100.1078       0
amp           3.5009         0.0691   3.3654   3.6364       0
acr          -1.2938         0.0197  -1.3325  -1.2551       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_104_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A     3.50090    0.06912   50.65   &lt;2e-16 ***
phi   1.29380    0.01973   65.56   &lt;2e-16 ***
C   100.01206    0.04886 2046.78   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 14.79 on 91590 degrees of freedom

Number of iterations to convergence: 7 
Achieved convergence tolerance: 1.57e-09</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_107)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: Avg_Glucose ~ A * cos(2 * pi/24 * Hour_Rounded + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A     6.1279     0.9707   6.313 1.07e-07 ***
phi   1.1679     0.1584   7.373 2.86e-09 ***
C    99.8717     0.6864 145.504  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.755 on 45 degrees of freedom

Number of iterations to convergence: 5 
Achieved convergence tolerance: 1.371e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_107)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.8672         0.0702  99.7297 100.0047       0
rrr           3.1165         0.0992   2.9221   3.3108       0
sss          -5.2599         0.0993  -5.4545  -5.0653       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  99.8672         0.0702  99.7297 100.0047       0
amp           6.1138         0.0993   5.9192   6.3085       0
acr          -1.0359         0.0162  -1.0677  -1.0041       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_107_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A    6.11375    0.09932   61.56   &lt;2e-16 ***
phi  1.03591    0.01622   63.88   &lt;2e-16 ***
C   99.86721    0.07017 1423.26   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 16.62 on 56107 degrees of freedom

Number of iterations to convergence: 5 
Achieved convergence tolerance: 3.927e-06</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_108)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: Avg_Glucose ~ A * cos(2 * pi/24 * Hour_Rounded + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A   -12.35366    0.72300  -17.09   &lt;2e-16 ***
phi   5.08807    0.05853   86.94   &lt;2e-16 ***
C   105.60168    0.51124  206.56   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.542 on 45 degrees of freedom

Number of iterations to convergence: 8 
Achieved convergence tolerance: 4.402e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_108)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 105.5868         0.1440 105.3046 105.8690       0
rrr          -2.9873         0.2036  -3.3864  -2.5881       0
sss         -12.0471         0.2036 -12.4461 -11.6481       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 105.5868         0.1440 105.3046 105.8690       0
amp          12.4119         0.2034  12.0133  12.8105       0
acr           1.3277         0.0164   1.2955   1.3599       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_108_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A    12.41194    0.20337   61.03   &lt;2e-16 ***
phi  20.66341    0.01642 1258.09   &lt;2e-16 ***
C   105.58679    0.14398  733.36   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.79 on 12032 degrees of freedom

Number of iterations to convergence: 11 
Achieved convergence tolerance: 2.572e-07</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_109)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: Avg_Glucose ~ A * cos(2 * pi/24 * Hour_Rounded + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A     7.87606    0.40760   19.32   &lt;2e-16 ***
phi  76.95992    0.05175 1487.11   &lt;2e-16 ***
C   102.10521    0.28821  354.27   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.997 on 45 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 1.956e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_109)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 102.1091         0.0606 101.9904 102.2278       0
rrr           1.0739         0.0857   0.9060   1.2418       0
sss          -7.8340         0.0856  -8.0019  -7.6661       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept) 102.1091         0.0606 101.9904 102.2278       0
amp           7.9073         0.0856   7.7394   8.0751       0
acr          -1.4346         0.0108  -1.4558  -1.4133       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_109_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A     7.90726    0.08563   92.35   &lt;2e-16 ***
phi   1.43456    0.01083  132.41   &lt;2e-16 ***
C   102.10915    0.06056 1686.00   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 12.87 on 45167 degrees of freedom

Number of iterations to convergence: 7 
Achieved convergence tolerance: 2.21e-09</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_112)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: Avg_Glucose ~ A * cos(2 * pi/24 * Hour_Rounded + phi) + C

Parameters:
    Estimate Std. Error t value Pr(&gt;|t|)    
A     8.7703     0.2000   43.85   &lt;2e-16 ***
phi   1.3145     0.0228   57.65   &lt;2e-16 ***
C    95.2858     0.1414  673.83   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9797 on 45 degrees of freedom

Number of iterations to convergence: 6 
Achieved convergence tolerance: 3.859e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(glucose_fit_112)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Raw model coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  95.2850         0.0603  95.1669  95.4031       0
rrr           3.3158         0.0852   3.1488   3.4827       0
sss          -8.1667         0.0853  -8.3339  -7.9996       0

***********************

Transformed coefficients:
            estimate standard.error lower.CI upper.CI p.value
(Intercept)  95.2850         0.0603  95.1669  95.4031       0
amp           8.8142         0.0854   8.6468   8.9815       0
acr          -1.1851         0.0097  -1.2040  -1.1662       0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cos_fit_112_orig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Formula: `Glucose (mg/dl)` ~ A * cos(2 * pi/24 * dec.time + phi) + C

Parameters:
     Estimate Std. Error t value Pr(&gt;|t|)    
A    8.814174   0.085380   103.2   &lt;2e-16 ***
phi  1.185119   0.009654   122.8   &lt;2e-16 ***
C   95.285018   0.060273  1580.9   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.89 on 69479 degrees of freedom

Number of iterations to convergence: 5 
Achieved convergence tolerance: 3.39e-07</code></pre>
</div>
</div>
</section>
<section id="trouble-shooting-cosine-fit" class="level3">
<h3 class="anchored" data-anchor-id="trouble-shooting-cosine-fit">Trouble Shooting: Cosine Fit</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Zeitreihe erzeugen</span></span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>datetime <span class="ot">&lt;-</span> <span class="fu">seq</span>(</span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2025-01-01 00:00:00"</span>),</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2025-01-07 23:30:00"</span>),</span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">"30 min"</span></span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Dezimalzeit für 24h-Periode</span></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>dec.time <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(datetime, <span class="st">"%H"</span>)) <span class="sc">+</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(datetime, <span class="st">"%M"</span>)) <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Cosinus mit 24h-Periode, Maximum um 18 Uhr</span></span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a>mesor <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>amplitude <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>phase_shift <span class="ot">&lt;-</span> pi<span class="sc">/</span><span class="dv">2</span>  <span class="co"># Maximum bei 18 Uhr</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a>glucose <span class="ot">&lt;-</span> mesor <span class="sc">+</span> amplitude <span class="sc">*</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span> <span class="sc">+</span> phase_shift)</span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. In DataFrame</span></span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>synthetic_24h <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(datetime, dec.time, glucose)</span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Plot</span></span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(synthetic_24h, <span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> glucose)) <span class="sc">+</span></span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"darkorange3"</span>) <span class="sc">+</span></span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb242-25"><a href="#cb242-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Synthetic Glucose Curve (Min at 6:00 , Max bei 18:00)"</span>,</span>
<span id="cb242-26"><a href="#cb242-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span>, <span class="at">x =</span> <span class="st">"Time (days)"</span></span>
<span id="cb242-27"><a href="#cb242-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb242-28"><a href="#cb242-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Cosinor-Komponenten</span></span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>synthetic_24h <span class="ot">&lt;-</span> synthetic_24h <span class="sc">%&gt;%</span></span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb243-4"><a href="#cb243-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cos_part =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>),</span>
<span id="cb243-5"><a href="#cb243-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sin_part =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb243-6"><a href="#cb243-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb243-7"><a href="#cb243-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-8"><a href="#cb243-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-9"><a href="#cb243-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-10"><a href="#cb243-10" aria-hidden="true" tabindex="-1"></a><span class="do">### ----- Manueller lm-Fit -----</span></span>
<span id="cb243-11"><a href="#cb243-11" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(glucose <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> synthetic_24h)</span>
<span id="cb243-12"><a href="#cb243-12" aria-hidden="true" tabindex="-1"></a>coefs_lm <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_lm)</span>
<span id="cb243-13"><a href="#cb243-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-14"><a href="#cb243-14" aria-hidden="true" tabindex="-1"></a>intercept_l <span class="ot">&lt;-</span> coefs_lm[<span class="st">"(Intercept)"</span>]</span>
<span id="cb243-15"><a href="#cb243-15" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> coefs_lm[<span class="st">"cos_part"</span>]</span>
<span id="cb243-16"><a href="#cb243-16" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> coefs_lm[<span class="st">"sin_part"</span>]</span>
<span id="cb243-17"><a href="#cb243-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-18"><a href="#cb243-18" aria-hidden="true" tabindex="-1"></a>amp_l <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb243-19"><a href="#cb243-19" aria-hidden="true" tabindex="-1"></a>acr_rad_l <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma, beta) <span class="co"># HIER: normalerweise atan2(-gamma, beta), wenn man das minus rausnimmt, macht der Output Sinn</span></span>
<span id="cb243-20"><a href="#cb243-20" aria-hidden="true" tabindex="-1"></a>acr_hr_l <span class="ot">&lt;-</span> (acr_rad_l <span class="sc">*</span> <span class="dv">24</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb243-21"><a href="#cb243-21" aria-hidden="true" tabindex="-1"></a>max_time_l <span class="ot">&lt;-</span> acr_hr_l</span>
<span id="cb243-22"><a href="#cb243-22" aria-hidden="true" tabindex="-1"></a>min_time_l <span class="ot">&lt;-</span> (acr_hr_l <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb243-23"><a href="#cb243-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-24"><a href="#cb243-24" aria-hidden="true" tabindex="-1"></a><span class="do">### ----- cosinor.lm-Fit -----</span></span>
<span id="cb243-25"><a href="#cb243-25" aria-hidden="true" tabindex="-1"></a>fit_cos <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(glucose <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> synthetic_24h, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb243-26"><a href="#cb243-26" aria-hidden="true" tabindex="-1"></a>coefs_cos <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_cos, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb243-27"><a href="#cb243-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-28"><a href="#cb243-28" aria-hidden="true" tabindex="-1"></a>intercept_cos   <span class="ot">&lt;-</span> coefs_cos[<span class="st">"(Intercept)"</span>]</span>
<span id="cb243-29"><a href="#cb243-29" aria-hidden="true" tabindex="-1"></a>amp_cos         <span class="ot">&lt;-</span> coefs_cos[<span class="st">"amp"</span>]</span>
<span id="cb243-30"><a href="#cb243-30" aria-hidden="true" tabindex="-1"></a>acr_rad_cos <span class="ot">&lt;-</span> coefs_cos[<span class="st">"acr"</span>]</span>
<span id="cb243-31"><a href="#cb243-31" aria-hidden="true" tabindex="-1"></a>acr_hr_cos <span class="ot">&lt;-</span> (acr_rad_cos <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb243-32"><a href="#cb243-32" aria-hidden="true" tabindex="-1"></a>max_time_cos    <span class="ot">&lt;-</span> acr_hr_cos <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb243-33"><a href="#cb243-33" aria-hidden="true" tabindex="-1"></a>min_time_cos    <span class="ot">&lt;-</span> (acr_hr_cos <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb243-34"><a href="#cb243-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-35"><a href="#cb243-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-36"><a href="#cb243-36" aria-hidden="true" tabindex="-1"></a><span class="do">### ----- Zusammenfassung in DataFrame -----</span></span>
<span id="cb243-37"><a href="#cb243-37" aria-hidden="true" tabindex="-1"></a>summary_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb243-38"><a href="#cb243-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start      =</span> <span class="fu">as.POSIXct</span>(<span class="st">"2025-01-01 00:00:00"</span>),</span>
<span id="cb243-39"><a href="#cb243-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-40"><a href="#cb243-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># manuelles Modell</span></span>
<span id="cb243-41"><a href="#cb243-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept_lm      =</span> intercept_l,</span>
<span id="cb243-42"><a href="#cb243-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp_lm            =</span> amp_l,</span>
<span id="cb243-43"><a href="#cb243-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad_lm  =</span> acr_rad_l,</span>
<span id="cb243-44"><a href="#cb243-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Hours_lm=</span> acr_hr_l,</span>
<span id="cb243-45"><a href="#cb243-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">MaxTime_Hours_lm  =</span> max_time_l,</span>
<span id="cb243-46"><a href="#cb243-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">MinTime_Hours_lm  =</span> min_time_l,</span>
<span id="cb243-47"><a href="#cb243-47" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-48"><a href="#cb243-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cosinor.lm Modell</span></span>
<span id="cb243-49"><a href="#cb243-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept_cos     =</span> intercept_cos,</span>
<span id="cb243-50"><a href="#cb243-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp_cos           =</span> amp_cos,</span>
<span id="cb243-51"><a href="#cb243-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad_cos =</span> acr_rad_cos,</span>
<span id="cb243-52"><a href="#cb243-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Hours_cos =</span> acr_hr_cos,</span>
<span id="cb243-53"><a href="#cb243-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">MaxTime_Hours_cos =</span> max_time_cos,</span>
<span id="cb243-54"><a href="#cb243-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">MinTime_Hours_cos =</span> min_time_cos</span>
<span id="cb243-55"><a href="#cb243-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb243-56"><a href="#cb243-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-57"><a href="#cb243-57" aria-hidden="true" tabindex="-1"></a><span class="do">######################## das ganze für den Datensatz der ID 102 ausprobieren</span></span>
<span id="cb243-58"><a href="#cb243-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-59"><a href="#cb243-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Daten für Patient ID 102 vorbereiten</span></span>
<span id="cb243-60"><a href="#cb243-60" aria-hidden="true" tabindex="-1"></a>glucose_fit_102_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb243-61"><a href="#cb243-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"102"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb243-62"><a href="#cb243-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb243-63"><a href="#cb243-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp), </span>
<span id="cb243-64"><a href="#cb243-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span></span>
<span id="cb243-65"><a href="#cb243-65" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb243-66"><a href="#cb243-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-67"><a href="#cb243-67" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Cosinor-Komponenten</span></span>
<span id="cb243-68"><a href="#cb243-68" aria-hidden="true" tabindex="-1"></a>glucose_fit_102_data <span class="ot">&lt;-</span> glucose_fit_102_data <span class="sc">%&gt;%</span></span>
<span id="cb243-69"><a href="#cb243-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb243-70"><a href="#cb243-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">cos_part =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>),</span>
<span id="cb243-71"><a href="#cb243-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">sin_part =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb243-72"><a href="#cb243-72" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb243-73"><a href="#cb243-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-74"><a href="#cb243-74" aria-hidden="true" tabindex="-1"></a><span class="do">### ----- Manueller lm-Fit -----</span></span>
<span id="cb243-75"><a href="#cb243-75" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> glucose_fit_102_data)</span>
<span id="cb243-76"><a href="#cb243-76" aria-hidden="true" tabindex="-1"></a>coefs_lm <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_lm)</span>
<span id="cb243-77"><a href="#cb243-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-78"><a href="#cb243-78" aria-hidden="true" tabindex="-1"></a>intercept_l <span class="ot">&lt;-</span> coefs_lm[<span class="st">"(Intercept)"</span>]</span>
<span id="cb243-79"><a href="#cb243-79" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> coefs_lm[<span class="st">"cos_part"</span>]</span>
<span id="cb243-80"><a href="#cb243-80" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> coefs_lm[<span class="st">"sin_part"</span>]</span>
<span id="cb243-81"><a href="#cb243-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-82"><a href="#cb243-82" aria-hidden="true" tabindex="-1"></a>amp_l <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb243-83"><a href="#cb243-83" aria-hidden="true" tabindex="-1"></a>acr_rad_l <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma, beta) <span class="co"># HIER: normalerweise atan2(-gamma, beta)</span></span>
<span id="cb243-84"><a href="#cb243-84" aria-hidden="true" tabindex="-1"></a>acr_hr_l <span class="ot">&lt;-</span> (acr_rad_l <span class="sc">*</span> <span class="dv">24</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb243-85"><a href="#cb243-85" aria-hidden="true" tabindex="-1"></a>max_time_l <span class="ot">&lt;-</span> acr_hr_l</span>
<span id="cb243-86"><a href="#cb243-86" aria-hidden="true" tabindex="-1"></a>min_time_l <span class="ot">&lt;-</span> (acr_hr_l <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb243-87"><a href="#cb243-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-88"><a href="#cb243-88" aria-hidden="true" tabindex="-1"></a><span class="do">### ----- cosinor.lm-Fit -----</span></span>
<span id="cb243-89"><a href="#cb243-89" aria-hidden="true" tabindex="-1"></a>fit_cos <span class="ot">&lt;-</span> <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> glucose_fit_102_data, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb243-90"><a href="#cb243-90" aria-hidden="true" tabindex="-1"></a>coefs_cos <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_cos, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb243-91"><a href="#cb243-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-92"><a href="#cb243-92" aria-hidden="true" tabindex="-1"></a>intercept_cos <span class="ot">&lt;-</span> coefs_cos[<span class="st">"(Intercept)"</span>]</span>
<span id="cb243-93"><a href="#cb243-93" aria-hidden="true" tabindex="-1"></a>amp_cos <span class="ot">&lt;-</span> coefs_cos[<span class="st">"amp"</span>]</span>
<span id="cb243-94"><a href="#cb243-94" aria-hidden="true" tabindex="-1"></a>acr_rad_cos <span class="ot">&lt;-</span> coefs_cos[<span class="st">"acr"</span>]</span>
<span id="cb243-95"><a href="#cb243-95" aria-hidden="true" tabindex="-1"></a>acr_hr_cos <span class="ot">&lt;-</span> (acr_rad_cos <span class="sc">*</span> <span class="dv">24</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">%%</span> <span class="dv">24</span>  <span class="co"># Konsistent: %% 24 hier anwenden</span></span>
<span id="cb243-96"><a href="#cb243-96" aria-hidden="true" tabindex="-1"></a>max_time_cos <span class="ot">&lt;-</span> acr_hr_cos</span>
<span id="cb243-97"><a href="#cb243-97" aria-hidden="true" tabindex="-1"></a>min_time_cos <span class="ot">&lt;-</span> (acr_hr_cos <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb243-98"><a href="#cb243-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb243-99"><a href="#cb243-99" aria-hidden="true" tabindex="-1"></a><span class="do">### ----- Zusammenfassung in DataFrame -----</span></span>
<span id="cb243-100"><a href="#cb243-100" aria-hidden="true" tabindex="-1"></a>summary_df_102 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb243-101"><a href="#cb243-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">Patient_ID =</span> <span class="st">"102"</span>,</span>
<span id="cb243-102"><a href="#cb243-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">min</span>(glucose_fit_102_data<span class="sc">$</span>datetime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb243-103"><a href="#cb243-103" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_End =</span> <span class="fu">max</span>(glucose_fit_102_data<span class="sc">$</span>datetime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb243-104"><a href="#cb243-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">N_Observations =</span> <span class="fu">nrow</span>(glucose_fit_102_data),</span>
<span id="cb243-105"><a href="#cb243-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-106"><a href="#cb243-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># manuelles Modell</span></span>
<span id="cb243-107"><a href="#cb243-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept_lm =</span> intercept_l,</span>
<span id="cb243-108"><a href="#cb243-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp_lm =</span> amp_l,</span>
<span id="cb243-109"><a href="#cb243-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad_lm =</span> acr_rad_l,</span>
<span id="cb243-110"><a href="#cb243-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Hours_lm =</span> acr_hr_l,</span>
<span id="cb243-111"><a href="#cb243-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">MaxTime_Hours_lm =</span> max_time_l,</span>
<span id="cb243-112"><a href="#cb243-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">MinTime_Hours_lm =</span> min_time_l,</span>
<span id="cb243-113"><a href="#cb243-113" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb243-114"><a href="#cb243-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cosinor.lm Modell</span></span>
<span id="cb243-115"><a href="#cb243-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept_cos =</span> intercept_cos,</span>
<span id="cb243-116"><a href="#cb243-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp_cos =</span> amp_cos,</span>
<span id="cb243-117"><a href="#cb243-117" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad_cos =</span> acr_rad_cos,</span>
<span id="cb243-118"><a href="#cb243-118" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Hours_cos =</span> acr_hr_cos,</span>
<span id="cb243-119"><a href="#cb243-119" aria-hidden="true" tabindex="-1"></a>  <span class="at">MaxTime_Hours_cos =</span> max_time_cos,</span>
<span id="cb243-120"><a href="#cb243-120" aria-hidden="true" tabindex="-1"></a>  <span class="at">MinTime_Hours_cos =</span> min_time_cos</span>
<span id="cb243-121"><a href="#cb243-121" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cosine-fit-with-lm" class="level3">
<h3 class="anchored" data-anchor-id="cosine-fit-with-lm">Cosine fit with lm()</h3>
<p><strong>Description:</strong> Fit over whole dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Prepare datetime and Cosinor components</span></span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb244-4"><a href="#cb244-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp, <span class="at">tz =</span> <span class="st">"Europe/Berlin"</span>), </span>
<span id="cb244-5"><a href="#cb244-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb244-6"><a href="#cb244-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cos_part =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>),</span>
<span id="cb244-7"><a href="#cb244-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sin_part =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb244-8"><a href="#cb244-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb244-9"><a href="#cb244-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-10"><a href="#cb244-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Initialize list to collect data with predictions</span></span>
<span id="cb244-11"><a href="#cb244-11" aria-hidden="true" tabindex="-1"></a>all_predictions <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb244-12"><a href="#cb244-12" aria-hidden="true" tabindex="-1"></a>summary_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb244-13"><a href="#cb244-13" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(glucose_fit_data<span class="sc">$</span>ID)</span>
<span id="cb244-14"><a href="#cb244-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-15"><a href="#cb244-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Loop through each ID</span></span>
<span id="cb244-16"><a href="#cb244-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> ids) {</span>
<span id="cb244-17"><a href="#cb244-17" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> glucose_fit_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb244-18"><a href="#cb244-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-19"><a href="#cb244-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit Cosinor model</span></span>
<span id="cb244-20"><a href="#cb244-20" aria-hidden="true" tabindex="-1"></a>  fit_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> df)</span>
<span id="cb244-21"><a href="#cb244-21" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>predicted_glucose <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_lm)</span>
<span id="cb244-22"><a href="#cb244-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-23"><a href="#cb244-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save predicted data</span></span>
<span id="cb244-24"><a href="#cb244-24" aria-hidden="true" tabindex="-1"></a>  all_predictions[[<span class="fu">length</span>(all_predictions) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> df</span>
<span id="cb244-25"><a href="#cb244-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-26"><a href="#cb244-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save summary (optional)</span></span>
<span id="cb244-27"><a href="#cb244-27" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_lm)</span>
<span id="cb244-28"><a href="#cb244-28" aria-hidden="true" tabindex="-1"></a>  intercept <span class="ot">&lt;-</span> coefs[<span class="st">"(Intercept)"</span>]</span>
<span id="cb244-29"><a href="#cb244-29" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> coefs[<span class="st">"cos_part"</span>]</span>
<span id="cb244-30"><a href="#cb244-30" aria-hidden="true" tabindex="-1"></a>  gamma <span class="ot">&lt;-</span> coefs[<span class="st">"sin_part"</span>]</span>
<span id="cb244-31"><a href="#cb244-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-32"><a href="#cb244-32" aria-hidden="true" tabindex="-1"></a>  amp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb244-33"><a href="#cb244-33" aria-hidden="true" tabindex="-1"></a>  acr_rad <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma, beta)</span>
<span id="cb244-34"><a href="#cb244-34" aria-hidden="true" tabindex="-1"></a>  acr_hr <span class="ot">&lt;-</span> (acr_rad <span class="sc">*</span> <span class="dv">24</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb244-35"><a href="#cb244-35" aria-hidden="true" tabindex="-1"></a>  max_time <span class="ot">&lt;-</span> acr_hr</span>
<span id="cb244-36"><a href="#cb244-36" aria-hidden="true" tabindex="-1"></a>  min_time <span class="ot">&lt;-</span> (acr_hr <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb244-37"><a href="#cb244-37" aria-hidden="true" tabindex="-1"></a>  max_value <span class="ot">&lt;-</span> intercept <span class="sc">+</span> amp</span>
<span id="cb244-38"><a href="#cb244-38" aria-hidden="true" tabindex="-1"></a>  min_value <span class="ot">&lt;-</span> intercept <span class="sc">-</span> amp</span>
<span id="cb244-39"><a href="#cb244-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb244-40"><a href="#cb244-40" aria-hidden="true" tabindex="-1"></a>  summary_list[[<span class="fu">length</span>(summary_list) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb244-41"><a href="#cb244-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">Patient_ID =</span> id,</span>
<span id="cb244-42"><a href="#cb244-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">Window_Start =</span> <span class="fu">min</span>(df<span class="sc">$</span>datetime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb244-43"><a href="#cb244-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">Window_End =</span> <span class="fu">max</span>(df<span class="sc">$</span>datetime, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb244-44"><a href="#cb244-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_Observations =</span> <span class="fu">nrow</span>(df),</span>
<span id="cb244-45"><a href="#cb244-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">Intercept_lm =</span> intercept,</span>
<span id="cb244-46"><a href="#cb244-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amp_lm =</span> amp,</span>
<span id="cb244-47"><a href="#cb244-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">Acrophase_Rad_lm =</span> acr_rad,</span>
<span id="cb244-48"><a href="#cb244-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">Acrophase_Hours_lm =</span> acr_hr,</span>
<span id="cb244-49"><a href="#cb244-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">MaxTime_Hours_lm =</span> max_time,</span>
<span id="cb244-50"><a href="#cb244-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">MinTime_Hours_lm =</span> min_time,</span>
<span id="cb244-51"><a href="#cb244-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">MaxValue_lm =</span> max_value,</span>
<span id="cb244-52"><a href="#cb244-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">MinValue_lm =</span> min_value</span>
<span id="cb244-53"><a href="#cb244-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb244-54"><a href="#cb244-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb244-55"><a href="#cb244-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-56"><a href="#cb244-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Combine data</span></span>
<span id="cb244-57"><a href="#cb244-57" aria-hidden="true" tabindex="-1"></a>cosinor_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, summary_list)</span>
<span id="cb244-58"><a href="#cb244-58" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_predictions)</span>
<span id="cb244-59"><a href="#cb244-59" aria-hidden="true" tabindex="-1"></a>plot_data<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(plot_data<span class="sc">$</span>ID)  <span class="co"># for facetting</span></span>
<span id="cb244-60"><a href="#cb244-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-61"><a href="#cb244-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: Plot with facets</span></span>
<span id="cb244-62"><a href="#cb244-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> dec.time)) <span class="sc">+</span></span>
<span id="cb244-63"><a href="#cb244-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb244-64"><a href="#cb244-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_glucose), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb244-65"><a href="#cb244-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> ID, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb244-66"><a href="#cb244-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb244-67"><a href="#cb244-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cosinor Fits for All Patients"</span>,</span>
<span id="cb244-68"><a href="#cb244-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day (decimal hours)"</span>,</span>
<span id="cb244-69"><a href="#cb244-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span></span>
<span id="cb244-70"><a href="#cb244-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb244-71"><a href="#cb244-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb244-72"><a href="#cb244-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Fit for every day</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: Prepare datetime and Cosinor components</span></span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a>glucose_fit_data <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime =</span> <span class="fu">dmy_hm</span>(DeviceTimestamp, <span class="at">tz =</span> <span class="st">"Europe/Berlin"</span>), </span>
<span id="cb245-5"><a href="#cb245-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(datetime),</span>
<span id="cb245-6"><a href="#cb245-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time =</span> <span class="fu">hour</span>(datetime) <span class="sc">+</span> <span class="fu">minute</span>(datetime) <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb245-7"><a href="#cb245-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">cos_part =</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>),</span>
<span id="cb245-8"><a href="#cb245-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">sin_part =</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec.time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb245-9"><a href="#cb245-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb245-10"><a href="#cb245-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-11"><a href="#cb245-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: Initialize collectors</span></span>
<span id="cb245-12"><a href="#cb245-12" aria-hidden="true" tabindex="-1"></a>all_predictions <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb245-13"><a href="#cb245-13" aria-hidden="true" tabindex="-1"></a>summary_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb245-14"><a href="#cb245-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-15"><a href="#cb245-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: Loop over each ID and Date</span></span>
<span id="cb245-16"><a href="#cb245-16" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(glucose_fit_data<span class="sc">$</span>ID)</span>
<span id="cb245-17"><a href="#cb245-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-18"><a href="#cb245-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> ids) {</span>
<span id="cb245-19"><a href="#cb245-19" aria-hidden="true" tabindex="-1"></a>  df_id <span class="ot">&lt;-</span> glucose_fit_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb245-20"><a href="#cb245-20" aria-hidden="true" tabindex="-1"></a>  dates <span class="ot">&lt;-</span> <span class="fu">unique</span>(df_id<span class="sc">$</span>date)</span>
<span id="cb245-21"><a href="#cb245-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb245-22"><a href="#cb245-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (d <span class="cf">in</span> dates) {</span>
<span id="cb245-23"><a href="#cb245-23" aria-hidden="true" tabindex="-1"></a>    df_day <span class="ot">&lt;-</span> df_id <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date <span class="sc">==</span> d)</span>
<span id="cb245-24"><a href="#cb245-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-25"><a href="#cb245-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only fit if enough data</span></span>
<span id="cb245-26"><a href="#cb245-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(df_day) <span class="sc">&lt;</span> <span class="dv">3</span> <span class="sc">||</span> <span class="fu">all</span>(<span class="fu">is.na</span>(df_day<span class="sc">$</span><span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>))) <span class="cf">next</span></span>
<span id="cb245-27"><a href="#cb245-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-28"><a href="#cb245-28" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> df_day)</span>
<span id="cb245-29"><a href="#cb245-29" aria-hidden="true" tabindex="-1"></a>    df_day<span class="sc">$</span>predicted_glucose <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit)</span>
<span id="cb245-30"><a href="#cb245-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-31"><a href="#cb245-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store prediction</span></span>
<span id="cb245-32"><a href="#cb245-32" aria-hidden="true" tabindex="-1"></a>    all_predictions[[<span class="fu">length</span>(all_predictions) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> df_day</span>
<span id="cb245-33"><a href="#cb245-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-34"><a href="#cb245-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cosinor summary</span></span>
<span id="cb245-35"><a href="#cb245-35" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)</span>
<span id="cb245-36"><a href="#cb245-36" aria-hidden="true" tabindex="-1"></a>    intercept <span class="ot">&lt;-</span> coefs[<span class="st">"(Intercept)"</span>]</span>
<span id="cb245-37"><a href="#cb245-37" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> coefs[<span class="st">"cos_part"</span>]</span>
<span id="cb245-38"><a href="#cb245-38" aria-hidden="true" tabindex="-1"></a>    gamma <span class="ot">&lt;-</span> coefs[<span class="st">"sin_part"</span>]</span>
<span id="cb245-39"><a href="#cb245-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-40"><a href="#cb245-40" aria-hidden="true" tabindex="-1"></a>    amp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb245-41"><a href="#cb245-41" aria-hidden="true" tabindex="-1"></a>    acr_rad <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma, beta)</span>
<span id="cb245-42"><a href="#cb245-42" aria-hidden="true" tabindex="-1"></a>    acr_hr <span class="ot">&lt;-</span> (acr_rad <span class="sc">*</span> <span class="dv">24</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb245-43"><a href="#cb245-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb245-44"><a href="#cb245-44" aria-hidden="true" tabindex="-1"></a>    summary_list[[<span class="fu">length</span>(summary_list) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb245-45"><a href="#cb245-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">Patient_ID =</span> id,</span>
<span id="cb245-46"><a href="#cb245-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">Date =</span> d,</span>
<span id="cb245-47"><a href="#cb245-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept,</span>
<span id="cb245-48"><a href="#cb245-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amplitude =</span> amp,</span>
<span id="cb245-49"><a href="#cb245-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_rad,</span>
<span id="cb245-50"><a href="#cb245-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Hours =</span> acr_hr,</span>
<span id="cb245-51"><a href="#cb245-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">N_Obs =</span> <span class="fu">nrow</span>(df_day)</span>
<span id="cb245-52"><a href="#cb245-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb245-53"><a href="#cb245-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb245-54"><a href="#cb245-54" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb245-55"><a href="#cb245-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-56"><a href="#cb245-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: Combine results</span></span>
<span id="cb245-57"><a href="#cb245-57" aria-hidden="true" tabindex="-1"></a>cosinor_daily_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, summary_list)</span>
<span id="cb245-58"><a href="#cb245-58" aria-hidden="true" tabindex="-1"></a>cosinor_daily_predictions <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Check fit with 14-day plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ID 102</span></span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for ID 102 and select first 14 dates</span></span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>df_102_first14 <span class="ot">&lt;-</span> cosinor_daily_predictions <span class="sc">%&gt;%</span></span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"102"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">%in%</span> <span class="fu">sort</span>(<span class="fu">unique</span>(date))[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>])  <span class="co"># keep only first 14 days</span></span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with facets</span></span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_102_first14, <span class="fu">aes</span>(<span class="at">x =</span> datetime)) <span class="sc">+</span></span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_glucose), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Cosinor Fits for ID 102 – First 14 Days"</span>,</span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span></span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb246-17"><a href="#cb246-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>, <span class="at">date_breaks =</span> <span class="st">"3 hours"</span>) <span class="sc">+</span></span>
<span id="cb246-18"><a href="#cb246-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb246-19"><a href="#cb246-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb246-20"><a href="#cb246-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ID 104</span></span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for ID 104 and select first 14 dates</span></span>
<span id="cb247-3"><a href="#cb247-3" aria-hidden="true" tabindex="-1"></a>df_104_first14 <span class="ot">&lt;-</span> cosinor_daily_predictions <span class="sc">%&gt;%</span></span>
<span id="cb247-4"><a href="#cb247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"104"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb247-5"><a href="#cb247-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb247-6"><a href="#cb247-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">%in%</span> <span class="fu">sort</span>(<span class="fu">unique</span>(date))[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>])  <span class="co"># keep only first 14 days</span></span>
<span id="cb247-7"><a href="#cb247-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-8"><a href="#cb247-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with facets</span></span>
<span id="cb247-9"><a href="#cb247-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_104_first14, <span class="fu">aes</span>(<span class="at">x =</span> datetime)) <span class="sc">+</span></span>
<span id="cb247-10"><a href="#cb247-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb247-11"><a href="#cb247-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_glucose), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb247-12"><a href="#cb247-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb247-13"><a href="#cb247-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Cosinor Fits for ID 104 – First 14 Days"</span>,</span>
<span id="cb247-14"><a href="#cb247-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb247-15"><a href="#cb247-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span></span>
<span id="cb247-16"><a href="#cb247-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb247-17"><a href="#cb247-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>, <span class="at">date_breaks =</span> <span class="st">"3 hours"</span>) <span class="sc">+</span></span>
<span id="cb247-18"><a href="#cb247-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb247-19"><a href="#cb247-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb247-20"><a href="#cb247-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-92-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ID 107</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for ID 107 and select first 14 dates</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>df_107_first14 <span class="ot">&lt;-</span> cosinor_daily_predictions <span class="sc">%&gt;%</span></span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"107"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">%in%</span> <span class="fu">sort</span>(<span class="fu">unique</span>(date))[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>])  <span class="co"># keep only first 14 days</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with facets</span></span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_107_first14, <span class="fu">aes</span>(<span class="at">x =</span> datetime)) <span class="sc">+</span></span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_glucose), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb248-13"><a href="#cb248-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Cosinor Fits for ID 107 – First 14 Days"</span>,</span>
<span id="cb248-14"><a href="#cb248-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb248-15"><a href="#cb248-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span></span>
<span id="cb248-16"><a href="#cb248-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb248-17"><a href="#cb248-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>, <span class="at">date_breaks =</span> <span class="st">"3 hours"</span>) <span class="sc">+</span></span>
<span id="cb248-18"><a href="#cb248-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb248-19"><a href="#cb248-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb248-20"><a href="#cb248-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-92-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ID 108</span></span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for ID 108 and select first 14 dates</span></span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>df_108_first14 <span class="ot">&lt;-</span> cosinor_daily_predictions <span class="sc">%&gt;%</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"108"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">%in%</span> <span class="fu">sort</span>(<span class="fu">unique</span>(date))[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>])  <span class="co"># keep only first 14 days</span></span>
<span id="cb249-7"><a href="#cb249-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-8"><a href="#cb249-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with facets</span></span>
<span id="cb249-9"><a href="#cb249-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_108_first14, <span class="fu">aes</span>(<span class="at">x =</span> datetime)) <span class="sc">+</span></span>
<span id="cb249-10"><a href="#cb249-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb249-11"><a href="#cb249-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_glucose), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb249-12"><a href="#cb249-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb249-13"><a href="#cb249-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Cosinor Fits for ID 108 – First 14 Days"</span>,</span>
<span id="cb249-14"><a href="#cb249-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb249-15"><a href="#cb249-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span></span>
<span id="cb249-16"><a href="#cb249-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb249-17"><a href="#cb249-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>, <span class="at">date_breaks =</span> <span class="st">"3 hours"</span>) <span class="sc">+</span></span>
<span id="cb249-18"><a href="#cb249-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb249-19"><a href="#cb249-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb249-20"><a href="#cb249-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-92-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ID 109</span></span>
<span id="cb250-2"><a href="#cb250-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for ID 109 and select first 14 dates</span></span>
<span id="cb250-3"><a href="#cb250-3" aria-hidden="true" tabindex="-1"></a>df_109_first14 <span class="ot">&lt;-</span> cosinor_daily_predictions <span class="sc">%&gt;%</span></span>
<span id="cb250-4"><a href="#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"109"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb250-5"><a href="#cb250-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb250-6"><a href="#cb250-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">%in%</span> <span class="fu">sort</span>(<span class="fu">unique</span>(date))[<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>])  <span class="co"># keep only first 14 days</span></span>
<span id="cb250-7"><a href="#cb250-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-8"><a href="#cb250-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with facets</span></span>
<span id="cb250-9"><a href="#cb250-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_109_first14, <span class="fu">aes</span>(<span class="at">x =</span> datetime)) <span class="sc">+</span></span>
<span id="cb250-10"><a href="#cb250-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb250-11"><a href="#cb250-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_glucose), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb250-12"><a href="#cb250-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb250-13"><a href="#cb250-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Cosinor Fits for ID 109 – First 14 Days"</span>,</span>
<span id="cb250-14"><a href="#cb250-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb250-15"><a href="#cb250-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span></span>
<span id="cb250-16"><a href="#cb250-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb250-17"><a href="#cb250-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>, <span class="at">date_breaks =</span> <span class="st">"3 hours"</span>) <span class="sc">+</span></span>
<span id="cb250-18"><a href="#cb250-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb250-19"><a href="#cb250-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb250-20"><a href="#cb250-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-92-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ID 112</span></span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter for ID 112 and select second 14 dates</span></span>
<span id="cb251-3"><a href="#cb251-3" aria-hidden="true" tabindex="-1"></a>df_112_first14 <span class="ot">&lt;-</span> cosinor_daily_predictions <span class="sc">%&gt;%</span></span>
<span id="cb251-4"><a href="#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ID <span class="sc">==</span> <span class="st">"112"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb251-5"><a href="#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(datetime)) <span class="sc">%&gt;%</span></span>
<span id="cb251-6"><a href="#cb251-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">%in%</span> <span class="fu">sort</span>(<span class="fu">unique</span>(date))[<span class="dv">15</span><span class="sc">:</span><span class="dv">28</span>])  <span class="co"># keep only second 14 days</span></span>
<span id="cb251-7"><a href="#cb251-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb251-8"><a href="#cb251-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with facets</span></span>
<span id="cb251-9"><a href="#cb251-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df_112_first14, <span class="fu">aes</span>(<span class="at">x =</span> datetime)) <span class="sc">+</span></span>
<span id="cb251-10"><a href="#cb251-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>), <span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb251-11"><a href="#cb251-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_glucose), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb251-12"><a href="#cb251-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb251-13"><a href="#cb251-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Cosinor Fits for ID 112 – Second 14 Days"</span>,</span>
<span id="cb251-14"><a href="#cb251-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb251-15"><a href="#cb251-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Glucose (mg/dl)"</span></span>
<span id="cb251-16"><a href="#cb251-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb251-17"><a href="#cb251-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_datetime</span>(<span class="at">date_labels =</span> <span class="st">"%H:%M"</span>, <span class="at">date_breaks =</span> <span class="st">"3 hours"</span>) <span class="sc">+</span></span>
<span id="cb251-18"><a href="#cb251-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb251-19"><a href="#cb251-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb251-20"><a href="#cb251-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-92-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="moving-window" class="level3">
<h3 class="anchored" data-anchor-id="moving-window">Moving window</h3>
<section id="moving-window-with-cosinor.lm" class="level4">
<h4 class="anchored" data-anchor-id="moving-window-with-cosinor.lm">Moving Window with cosinor.lm()</h4>
<p><strong>Description:</strong> Cos for 102: Moving window for 102</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Storage for results</span></span>
<span id="cb252-2"><a href="#cb252-2" aria-hidden="true" tabindex="-1"></a>  moving_window_102 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb252-3"><a href="#cb252-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb252-4"><a href="#cb252-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb252-5"><a href="#cb252-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb252-6"><a href="#cb252-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb252-7"><a href="#cb252-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb252-8"><a href="#cb252-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb252-9"><a href="#cb252-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb252-10"><a href="#cb252-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb252-11"><a href="#cb252-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb252-12"><a href="#cb252-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb252-13"><a href="#cb252-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-14"><a href="#cb252-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Time boundaries</span></span>
<span id="cb252-15"><a href="#cb252-15" aria-hidden="true" tabindex="-1"></a>  start_time_mv_102 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb252-16"><a href="#cb252-16" aria-hidden="true" tabindex="-1"></a>  end_time_mv_102 <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb252-17"><a href="#cb252-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-18"><a href="#cb252-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Window setup</span></span>
<span id="cb252-19"><a href="#cb252-19" aria-hidden="true" tabindex="-1"></a>  window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb252-20"><a href="#cb252-20" aria-hidden="true" tabindex="-1"></a>  step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb252-21"><a href="#cb252-21" aria-hidden="true" tabindex="-1"></a>  current_start_102 <span class="ot">&lt;-</span> start_time_mv_102</span>
<span id="cb252-22"><a href="#cb252-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-23"><a href="#cb252-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (current_start_102 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_102) {</span>
<span id="cb252-24"><a href="#cb252-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-25"><a href="#cb252-25" aria-hidden="true" tabindex="-1"></a>    current_end_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> window_length</span>
<span id="cb252-26"><a href="#cb252-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-27"><a href="#cb252-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter window</span></span>
<span id="cb252-28"><a href="#cb252-28" aria-hidden="true" tabindex="-1"></a>    window_data_102 <span class="ot">&lt;-</span> glucose_fit_102_data <span class="sc">%&gt;%</span></span>
<span id="cb252-29"><a href="#cb252-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_102 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_102)</span>
<span id="cb252-30"><a href="#cb252-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-31"><a href="#cb252-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip small windows</span></span>
<span id="cb252-32"><a href="#cb252-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_102) <span class="sc">&lt;</span> <span class="dv">100</span>) {</span>
<span id="cb252-33"><a href="#cb252-33" aria-hidden="true" tabindex="-1"></a>      current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb252-34"><a href="#cb252-34" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb252-35"><a href="#cb252-35" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb252-36"><a href="#cb252-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-37"><a href="#cb252-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try fitting model</span></span>
<span id="cb252-38"><a href="#cb252-38" aria-hidden="true" tabindex="-1"></a>    fit_102 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb252-39"><a href="#cb252-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> window_data_102, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb252-40"><a href="#cb252-40" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb252-41"><a href="#cb252-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-42"><a href="#cb252-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Proceed only if fit succeeded</span></span>
<span id="cb252-43"><a href="#cb252-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">inherits</span>(fit_102, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb252-44"><a href="#cb252-44" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb252-45"><a href="#cb252-45" aria-hidden="true" tabindex="-1"></a>      coefs_102 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_102, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb252-46"><a href="#cb252-46" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb252-47"><a href="#cb252-47" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Safe extraction</span></span>
<span id="cb252-48"><a href="#cb252-48" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_102)) {</span>
<span id="cb252-49"><a href="#cb252-49" aria-hidden="true" tabindex="-1"></a>        amp_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb252-50"><a href="#cb252-50" aria-hidden="true" tabindex="-1"></a>        acr_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb252-51"><a href="#cb252-51" aria-hidden="true" tabindex="-1"></a>        intercept_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb252-52"><a href="#cb252-52" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_102)) {</span>
<span id="cb252-53"><a href="#cb252-53" aria-hidden="true" tabindex="-1"></a>        amp_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"amp"</span>]</span>
<span id="cb252-54"><a href="#cb252-54" aria-hidden="true" tabindex="-1"></a>        acr_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"acr"</span>]</span>
<span id="cb252-55"><a href="#cb252-55" aria-hidden="true" tabindex="-1"></a>        intercept_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"(Intercept)"</span>]</span>
<span id="cb252-56"><a href="#cb252-56" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb252-57"><a href="#cb252-57" aria-hidden="true" tabindex="-1"></a>        current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb252-58"><a href="#cb252-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">next</span></span>
<span id="cb252-59"><a href="#cb252-59" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb252-60"><a href="#cb252-60" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb252-61"><a href="#cb252-61" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb252-62"><a href="#cb252-62" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Raw acrophase in hours</span></span>
<span id="cb252-63"><a href="#cb252-63" aria-hidden="true" tabindex="-1"></a>    acrophase_raw_102 <span class="ot">&lt;-</span> (acr_102 <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb252-64"><a href="#cb252-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-65"><a href="#cb252-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate max time (adjusted by 12h if amplitude is negative)</span></span>
<span id="cb252-66"><a href="#cb252-66" aria-hidden="true" tabindex="-1"></a>    max_time_102 <span class="ot">&lt;-</span> ((acrophase_raw_102 <span class="sc">+</span> <span class="fu">ifelse</span>(amp_102 <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">12</span>, <span class="dv">0</span>)) <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb252-67"><a href="#cb252-67" aria-hidden="true" tabindex="-1"></a>    min_time_102 <span class="ot">&lt;-</span> (max_time_102 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb252-68"><a href="#cb252-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb252-69"><a href="#cb252-69" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb252-70"><a href="#cb252-70" aria-hidden="true" tabindex="-1"></a>    moving_window_102 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_102, <span class="fu">data.frame</span>(</span>
<span id="cb252-71"><a href="#cb252-71" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_102,</span>
<span id="cb252-72"><a href="#cb252-72" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp_102,</span>
<span id="cb252-73"><a href="#cb252-73" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_102,</span>
<span id="cb252-74"><a href="#cb252-74" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw_102,</span>
<span id="cb252-75"><a href="#cb252-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> (acrophase_raw_102 <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span>,</span>
<span id="cb252-76"><a href="#cb252-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time_102,</span>
<span id="cb252-77"><a href="#cb252-77" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time_102,</span>
<span id="cb252-78"><a href="#cb252-78" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept_102</span>
<span id="cb252-79"><a href="#cb252-79" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb252-80"><a href="#cb252-80" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb252-81"><a href="#cb252-81" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb252-82"><a href="#cb252-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move to next window</span></span>
<span id="cb252-83"><a href="#cb252-83" aria-hidden="true" tabindex="-1"></a>  current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb252-84"><a href="#cb252-84" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Cos for 102: Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb253"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_102, <span class="fu">aes</span>(<span class="at">x =</span> Window_Start)) <span class="sc">+</span></span>
<span id="cb253-2"><a href="#cb253-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>)) <span class="sc">+</span></span>
<span id="cb253-3"><a href="#cb253-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>)) <span class="sc">+</span></span>
<span id="cb253-4"><a href="#cb253-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>)) <span class="sc">+</span></span>
<span id="cb253-5"><a href="#cb253-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>)) <span class="sc">+</span></span>
<span id="cb253-6"><a href="#cb253-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Maximum"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Minimum"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb253-7"><a href="#cb253-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">2</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">24</span>)) <span class="sc">+</span></span>
<span id="cb253-8"><a href="#cb253-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb253-9"><a href="#cb253-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Diurnal Pattern of Maximum and Minimum (Glucose Cosinor)"</span>,</span>
<span id="cb253-10"><a href="#cb253-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Window Start Time"</span>,</span>
<span id="cb253-11"><a href="#cb253-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time of Day (Hours)"</span>,</span>
<span id="cb253-12"><a href="#cb253-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Time Point"</span></span>
<span id="cb253-13"><a href="#cb253-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb253-14"><a href="#cb253-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 102: min. 400 datapoints are needed to calculate the cos + using package cosinor.lm()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Empty dataframe to store results</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>moving_window_102 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb254-6"><a href="#cb254-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb254-7"><a href="#cb254-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb254-8"><a href="#cb254-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb254-9"><a href="#cb254-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb254-10"><a href="#cb254-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb254-11"><a href="#cb254-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb254-12"><a href="#cb254-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb254-13"><a href="#cb254-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-14"><a href="#cb254-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time boundaries</span></span>
<span id="cb254-15"><a href="#cb254-15" aria-hidden="true" tabindex="-1"></a>start_time_mv_102 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb254-16"><a href="#cb254-16" aria-hidden="true" tabindex="-1"></a>end_time_mv_102 <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb254-17"><a href="#cb254-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-18"><a href="#cb254-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Window and step sizes</span></span>
<span id="cb254-19"><a href="#cb254-19" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb254-20"><a href="#cb254-20" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb254-21"><a href="#cb254-21" aria-hidden="true" tabindex="-1"></a>current_start_102 <span class="ot">&lt;-</span> start_time_mv_102</span>
<span id="cb254-22"><a href="#cb254-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-23"><a href="#cb254-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Sliding window analysis</span></span>
<span id="cb254-24"><a href="#cb254-24" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (current_start_102 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_102) {</span>
<span id="cb254-25"><a href="#cb254-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-26"><a href="#cb254-26" aria-hidden="true" tabindex="-1"></a>  current_end_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> window_length</span>
<span id="cb254-27"><a href="#cb254-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-28"><a href="#cb254-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter data within window</span></span>
<span id="cb254-29"><a href="#cb254-29" aria-hidden="true" tabindex="-1"></a>  window_data_102 <span class="ot">&lt;-</span> glucose_fit_102_data <span class="sc">%&gt;%</span></span>
<span id="cb254-30"><a href="#cb254-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_102 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_102)</span>
<span id="cb254-31"><a href="#cb254-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-32"><a href="#cb254-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skip windows with too few data points</span></span>
<span id="cb254-33"><a href="#cb254-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_102) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb254-34"><a href="#cb254-34" aria-hidden="true" tabindex="-1"></a>    current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb254-35"><a href="#cb254-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb254-36"><a href="#cb254-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb254-37"><a href="#cb254-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-38"><a href="#cb254-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit cosinor model</span></span>
<span id="cb254-39"><a href="#cb254-39" aria-hidden="true" tabindex="-1"></a>  fit_102 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb254-40"><a href="#cb254-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> window_data_102, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb254-41"><a href="#cb254-41" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb254-42"><a href="#cb254-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-43"><a href="#cb254-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit_102, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb254-44"><a href="#cb254-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb254-45"><a href="#cb254-45" aria-hidden="true" tabindex="-1"></a>    coefs_102 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_102, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb254-46"><a href="#cb254-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb254-47"><a href="#cb254-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb254-48"><a href="#cb254-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_102)) {</span>
<span id="cb254-49"><a href="#cb254-49" aria-hidden="true" tabindex="-1"></a>      amp_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb254-50"><a href="#cb254-50" aria-hidden="true" tabindex="-1"></a>      acr_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb254-51"><a href="#cb254-51" aria-hidden="true" tabindex="-1"></a>      intercept_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb254-52"><a href="#cb254-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_102)) {</span>
<span id="cb254-53"><a href="#cb254-53" aria-hidden="true" tabindex="-1"></a>      amp_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"amp"</span>]</span>
<span id="cb254-54"><a href="#cb254-54" aria-hidden="true" tabindex="-1"></a>      acr_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"acr"</span>]</span>
<span id="cb254-55"><a href="#cb254-55" aria-hidden="true" tabindex="-1"></a>      intercept_102 <span class="ot">&lt;-</span> coefs_102[<span class="st">"(Intercept)"</span>]</span>
<span id="cb254-56"><a href="#cb254-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb254-57"><a href="#cb254-57" aria-hidden="true" tabindex="-1"></a>      current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb254-58"><a href="#cb254-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb254-59"><a href="#cb254-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb254-60"><a href="#cb254-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb254-61"><a href="#cb254-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Raw acrophase in hours</span></span>
<span id="cb254-62"><a href="#cb254-62" aria-hidden="true" tabindex="-1"></a>    acrophase_raw_102 <span class="ot">&lt;-</span> (acr_102 <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb254-63"><a href="#cb254-63" aria-hidden="true" tabindex="-1"></a>    acrophase_norm_102 <span class="ot">&lt;-</span> (acrophase_raw_102 <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb254-64"><a href="#cb254-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb254-65"><a href="#cb254-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max and min time depending on amplitude sign</span></span>
<span id="cb254-66"><a href="#cb254-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amp_102 <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb254-67"><a href="#cb254-67" aria-hidden="true" tabindex="-1"></a>      max_time_102 <span class="ot">&lt;-</span> acrophase_norm_102</span>
<span id="cb254-68"><a href="#cb254-68" aria-hidden="true" tabindex="-1"></a>      min_time_102 <span class="ot">&lt;-</span> (acrophase_norm_102 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb254-69"><a href="#cb254-69" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb254-70"><a href="#cb254-70" aria-hidden="true" tabindex="-1"></a>      min_time_102 <span class="ot">&lt;-</span> acrophase_norm_102</span>
<span id="cb254-71"><a href="#cb254-71" aria-hidden="true" tabindex="-1"></a>      max_time_102 <span class="ot">&lt;-</span> (acrophase_norm_102 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb254-72"><a href="#cb254-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb254-73"><a href="#cb254-73" aria-hidden="true" tabindex="-1"></a>     <span class="co"># Ensure max &gt; 12 and min &lt; 12 (if desired visual convention)</span></span>
<span id="cb254-74"><a href="#cb254-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (max_time_102 <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb254-75"><a href="#cb254-75" aria-hidden="true" tabindex="-1"></a>      temp_102 <span class="ot">&lt;-</span> max_time_102</span>
<span id="cb254-76"><a href="#cb254-76" aria-hidden="true" tabindex="-1"></a>      max_time_102 <span class="ot">&lt;-</span> min_time_102</span>
<span id="cb254-77"><a href="#cb254-77" aria-hidden="true" tabindex="-1"></a>      min_time_102 <span class="ot">&lt;-</span> temp_102</span>
<span id="cb254-78"><a href="#cb254-78" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb254-79"><a href="#cb254-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb254-80"><a href="#cb254-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb254-81"><a href="#cb254-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb254-82"><a href="#cb254-82" aria-hidden="true" tabindex="-1"></a>    moving_window_102 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_102, <span class="fu">data.frame</span>(</span>
<span id="cb254-83"><a href="#cb254-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_102,</span>
<span id="cb254-84"><a href="#cb254-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp_102,</span>
<span id="cb254-85"><a href="#cb254-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_102,</span>
<span id="cb254-86"><a href="#cb254-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw_102,</span>
<span id="cb254-87"><a href="#cb254-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm_102,</span>
<span id="cb254-88"><a href="#cb254-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time_102,</span>
<span id="cb254-89"><a href="#cb254-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time_102,</span>
<span id="cb254-90"><a href="#cb254-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept_102</span>
<span id="cb254-91"><a href="#cb254-91" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb254-92"><a href="#cb254-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb254-93"><a href="#cb254-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb254-94"><a href="#cb254-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move to next window</span></span>
<span id="cb254-95"><a href="#cb254-95" aria-hidden="true" tabindex="-1"></a>  current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb254-96"><a href="#cb254-96" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 102: Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_102, <span class="fu">aes</span>(<span class="at">x =</span> Window_Start)) <span class="sc">+</span></span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb255-4"><a href="#cb255-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb255-5"><a href="#cb255-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb255-6"><a href="#cb255-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb255-7"><a href="#cb255-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb255-8"><a href="#cb255-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Maximum"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Minimum"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb255-9"><a href="#cb255-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb255-10"><a href="#cb255-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb255-11"><a href="#cb255-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">2</span>),</span>
<span id="cb255-12"><a href="#cb255-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">24</span>),</span>
<span id="cb255-13"><a href="#cb255-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb255-14"><a href="#cb255-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb255-15"><a href="#cb255-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb255-16"><a href="#cb255-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Diurnal Timing of Maximum and Minimum (Glucose Cosinor)"</span>,</span>
<span id="cb255-17"><a href="#cb255-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Window Start Time"</span>,</span>
<span id="cb255-18"><a href="#cb255-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time of Day (Hours)"</span></span>
<span id="cb255-19"><a href="#cb255-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb255-20"><a href="#cb255-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb255-21"><a href="#cb255-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 102 with lm</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb256"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Empty Dataframe to store results</span></span>
<span id="cb256-2"><a href="#cb256-2" aria-hidden="true" tabindex="-1"></a> moving_window_102_l <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb256-3"><a href="#cb256-3" aria-hidden="true" tabindex="-1"></a>   <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb256-4"><a href="#cb256-4" aria-hidden="true" tabindex="-1"></a>   <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb256-5"><a href="#cb256-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb256-6"><a href="#cb256-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb256-7"><a href="#cb256-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb256-8"><a href="#cb256-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb256-9"><a href="#cb256-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb256-10"><a href="#cb256-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb256-11"><a href="#cb256-11" aria-hidden="true" tabindex="-1"></a>   <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb256-12"><a href="#cb256-12" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb256-13"><a href="#cb256-13" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb256-14"><a href="#cb256-14" aria-hidden="true" tabindex="-1"></a> <span class="co"># Defining time boundaries</span></span>
<span id="cb256-15"><a href="#cb256-15" aria-hidden="true" tabindex="-1"></a> start_time_mv_102 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb256-16"><a href="#cb256-16" aria-hidden="true" tabindex="-1"></a> end_time_mv_102   <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb256-17"><a href="#cb256-17" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb256-18"><a href="#cb256-18" aria-hidden="true" tabindex="-1"></a> <span class="co"># window and step sizes</span></span>
<span id="cb256-19"><a href="#cb256-19" aria-hidden="true" tabindex="-1"></a> window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb256-20"><a href="#cb256-20" aria-hidden="true" tabindex="-1"></a> step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb256-21"><a href="#cb256-21" aria-hidden="true" tabindex="-1"></a> current_start_102 <span class="ot">&lt;-</span> start_time_mv_102</span>
<span id="cb256-22"><a href="#cb256-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb256-23"><a href="#cb256-23" aria-hidden="true" tabindex="-1"></a> <span class="co"># Sliding window loop</span></span>
<span id="cb256-24"><a href="#cb256-24" aria-hidden="true" tabindex="-1"></a> <span class="cf">while</span> (current_start_102 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_102) {</span>
<span id="cb256-25"><a href="#cb256-25" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-26"><a href="#cb256-26" aria-hidden="true" tabindex="-1"></a>   current_end_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> window_length</span>
<span id="cb256-27"><a href="#cb256-27" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-28"><a href="#cb256-28" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Filter Data within window</span></span>
<span id="cb256-29"><a href="#cb256-29" aria-hidden="true" tabindex="-1"></a>   window_data_102_l <span class="ot">&lt;-</span> glucose_fit_102_data <span class="sc">%&gt;%</span></span>
<span id="cb256-30"><a href="#cb256-30" aria-hidden="true" tabindex="-1"></a>     <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_102 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_102)</span>
<span id="cb256-31"><a href="#cb256-31" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-32"><a href="#cb256-32" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Skip windows with too few data points</span></span>
<span id="cb256-33"><a href="#cb256-33" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_102_l) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb256-34"><a href="#cb256-34" aria-hidden="true" tabindex="-1"></a>     current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb256-35"><a href="#cb256-35" aria-hidden="true" tabindex="-1"></a>     <span class="cf">next</span></span>
<span id="cb256-36"><a href="#cb256-36" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb256-37"><a href="#cb256-37" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-38"><a href="#cb256-38" aria-hidden="true" tabindex="-1"></a>   <span class="co"># calculate cosinus components</span></span>
<span id="cb256-39"><a href="#cb256-39" aria-hidden="true" tabindex="-1"></a>   dec_time_102_l <span class="ot">&lt;-</span> window_data_102_l<span class="sc">$</span>dec.time</span>
<span id="cb256-40"><a href="#cb256-40" aria-hidden="true" tabindex="-1"></a>   window_data_102_l<span class="sc">$</span>cos_part <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time_102_l <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb256-41"><a href="#cb256-41" aria-hidden="true" tabindex="-1"></a>   window_data_102_l<span class="sc">$</span>sin_part <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time_102_l <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb256-42"><a href="#cb256-42" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-43"><a href="#cb256-43" aria-hidden="true" tabindex="-1"></a>   <span class="co"># fit with linear regression</span></span>
<span id="cb256-44"><a href="#cb256-44" aria-hidden="true" tabindex="-1"></a>   fit_test_102_l <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb256-45"><a href="#cb256-45" aria-hidden="true" tabindex="-1"></a>     <span class="fu">lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> window_data_102_l)</span>
<span id="cb256-46"><a href="#cb256-46" aria-hidden="true" tabindex="-1"></a>   }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb256-47"><a href="#cb256-47" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-48"><a href="#cb256-48" aria-hidden="true" tabindex="-1"></a>   <span class="co"># test</span></span>
<span id="cb256-49"><a href="#cb256-49" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(fit_test_102_l, <span class="st">"lm"</span>)) {</span>
<span id="cb256-50"><a href="#cb256-50" aria-hidden="true" tabindex="-1"></a>     current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb256-51"><a href="#cb256-51" aria-hidden="true" tabindex="-1"></a>     <span class="cf">next</span></span>
<span id="cb256-52"><a href="#cb256-52" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb256-53"><a href="#cb256-53" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-54"><a href="#cb256-54" aria-hidden="true" tabindex="-1"></a>   coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_test_102_l)</span>
<span id="cb256-55"><a href="#cb256-55" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-56"><a href="#cb256-56" aria-hidden="true" tabindex="-1"></a>   <span class="co"># skip if NA in relevant coefficents</span></span>
<span id="cb256-57"><a href="#cb256-57" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(coefs[<span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"cos_part"</span>, <span class="st">"sin_part"</span>)]))) {</span>
<span id="cb256-58"><a href="#cb256-58" aria-hidden="true" tabindex="-1"></a>     current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb256-59"><a href="#cb256-59" aria-hidden="true" tabindex="-1"></a>     <span class="cf">next</span></span>
<span id="cb256-60"><a href="#cb256-60" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb256-61"><a href="#cb256-61" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-62"><a href="#cb256-62" aria-hidden="true" tabindex="-1"></a>   <span class="co"># extract coefficients</span></span>
<span id="cb256-63"><a href="#cb256-63" aria-hidden="true" tabindex="-1"></a>   intercept_102_l <span class="ot">&lt;-</span> coefs[<span class="st">"(Intercept)"</span>]</span>
<span id="cb256-64"><a href="#cb256-64" aria-hidden="true" tabindex="-1"></a>   beta_102_l      <span class="ot">&lt;-</span> coefs[<span class="st">"cos_part"</span>]</span>
<span id="cb256-65"><a href="#cb256-65" aria-hidden="true" tabindex="-1"></a>   gamma_102_l     <span class="ot">&lt;-</span> coefs[<span class="st">"sin_part"</span>]</span>
<span id="cb256-66"><a href="#cb256-66" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-67"><a href="#cb256-67" aria-hidden="true" tabindex="-1"></a>   <span class="co"># amolitude</span></span>
<span id="cb256-68"><a href="#cb256-68" aria-hidden="true" tabindex="-1"></a>   amp_102_l <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta_102_l<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma_102_l<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb256-69"><a href="#cb256-69" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-70"><a href="#cb256-70" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Acrophase (radiant)</span></span>
<span id="cb256-71"><a href="#cb256-71" aria-hidden="true" tabindex="-1"></a>   acr_rad_102_l <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma_102_l, beta_102_l)  <span class="co"># without minus</span></span>
<span id="cb256-72"><a href="#cb256-72" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-73"><a href="#cb256-73" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Acrophase (hours)</span></span>
<span id="cb256-74"><a href="#cb256-74" aria-hidden="true" tabindex="-1"></a>   acrophase_raw_102_l <span class="ot">&lt;-</span> (acr_rad_102_l <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb256-75"><a href="#cb256-75" aria-hidden="true" tabindex="-1"></a>   acrophase_norm_102_l <span class="ot">&lt;-</span> (acrophase_raw_102_l <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb256-76"><a href="#cb256-76" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-77"><a href="#cb256-77" aria-hidden="true" tabindex="-1"></a>   <span class="co"># max and min time</span></span>
<span id="cb256-78"><a href="#cb256-78" aria-hidden="true" tabindex="-1"></a>   max_time_102_l <span class="ot">&lt;-</span> acrophase_norm_102_l</span>
<span id="cb256-79"><a href="#cb256-79" aria-hidden="true" tabindex="-1"></a>   min_time_102_l <span class="ot">&lt;-</span> (acrophase_norm_102_l <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb256-80"><a href="#cb256-80" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-81"><a href="#cb256-81" aria-hidden="true" tabindex="-1"></a>   <span class="co"># store results</span></span>
<span id="cb256-82"><a href="#cb256-82" aria-hidden="true" tabindex="-1"></a>   moving_window_102_l <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_102_l, <span class="fu">data.frame</span>(</span>
<span id="cb256-83"><a href="#cb256-83" aria-hidden="true" tabindex="-1"></a>     <span class="at">Window_Start =</span> current_start_102,</span>
<span id="cb256-84"><a href="#cb256-84" aria-hidden="true" tabindex="-1"></a>     <span class="at">Amp =</span> amp_102_l,</span>
<span id="cb256-85"><a href="#cb256-85" aria-hidden="true" tabindex="-1"></a>     <span class="at">Acrophase_Rad =</span> acr_rad_102_l,</span>
<span id="cb256-86"><a href="#cb256-86" aria-hidden="true" tabindex="-1"></a>     <span class="at">Acrophase_Raw =</span> acrophase_raw_102_l,</span>
<span id="cb256-87"><a href="#cb256-87" aria-hidden="true" tabindex="-1"></a>     <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm_102_l,</span>
<span id="cb256-88"><a href="#cb256-88" aria-hidden="true" tabindex="-1"></a>     <span class="at">Max_Time_Hours =</span> max_time_102_l,</span>
<span id="cb256-89"><a href="#cb256-89" aria-hidden="true" tabindex="-1"></a>     <span class="at">Min_Time_Hours =</span> min_time_102_l,</span>
<span id="cb256-90"><a href="#cb256-90" aria-hidden="true" tabindex="-1"></a>     <span class="at">Intercept =</span> intercept_102_l</span>
<span id="cb256-91"><a href="#cb256-91" aria-hidden="true" tabindex="-1"></a>   ))</span>
<span id="cb256-92"><a href="#cb256-92" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb256-93"><a href="#cb256-93" aria-hidden="true" tabindex="-1"></a>   <span class="co"># next window</span></span>
<span id="cb256-94"><a href="#cb256-94" aria-hidden="true" tabindex="-1"></a>   current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb256-95"><a href="#cb256-95" aria-hidden="true" tabindex="-1"></a> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Data Set for Comparison of cosinor.lm() and lm() method</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Leerer DataFrame zur Speicherung</span></span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>moving_window_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp_C =</span> <span class="fu">numeric</span>(),</span>
<span id="cb257-5"><a href="#cb257-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp_L =</span> <span class="fu">numeric</span>(),</span>
<span id="cb257-6"><a href="#cb257-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad_C =</span> <span class="fu">numeric</span>(),</span>
<span id="cb257-7"><a href="#cb257-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad_L =</span> <span class="fu">numeric</span>(),</span>
<span id="cb257-8"><a href="#cb257-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept_C =</span> <span class="fu">numeric</span>(),</span>
<span id="cb257-9"><a href="#cb257-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept_L =</span> <span class="fu">numeric</span>(),</span>
<span id="cb257-10"><a href="#cb257-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb257-11"><a href="#cb257-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb257-12"><a href="#cb257-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-13"><a href="#cb257-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Zeitgrenzen</span></span>
<span id="cb257-14"><a href="#cb257-14" aria-hidden="true" tabindex="-1"></a>start_time_mv_102 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb257-15"><a href="#cb257-15" aria-hidden="true" tabindex="-1"></a>end_time_mv_102   <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_102_data<span class="sc">$</span>datetime)</span>
<span id="cb257-16"><a href="#cb257-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-17"><a href="#cb257-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fenster und Schritt</span></span>
<span id="cb257-18"><a href="#cb257-18" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb257-19"><a href="#cb257-19" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb257-20"><a href="#cb257-20" aria-hidden="true" tabindex="-1"></a>current_start_102 <span class="ot">&lt;-</span> start_time_mv_102</span>
<span id="cb257-21"><a href="#cb257-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-22"><a href="#cb257-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Sliding-Window</span></span>
<span id="cb257-23"><a href="#cb257-23" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (current_start_102 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_102) {</span>
<span id="cb257-24"><a href="#cb257-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-25"><a href="#cb257-25" aria-hidden="true" tabindex="-1"></a>  current_end_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> window_length</span>
<span id="cb257-26"><a href="#cb257-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-27"><a href="#cb257-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Daten filtern</span></span>
<span id="cb257-28"><a href="#cb257-28" aria-hidden="true" tabindex="-1"></a>  window_data_102_comparison <span class="ot">&lt;-</span> glucose_fit_102_data <span class="sc">%&gt;%</span></span>
<span id="cb257-29"><a href="#cb257-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_102 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_102)</span>
<span id="cb257-30"><a href="#cb257-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-31"><a href="#cb257-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_102_comparison) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb257-32"><a href="#cb257-32" aria-hidden="true" tabindex="-1"></a>    current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb257-33"><a href="#cb257-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb257-34"><a href="#cb257-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb257-35"><a href="#cb257-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-36"><a href="#cb257-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cosinor-Teile berechnen</span></span>
<span id="cb257-37"><a href="#cb257-37" aria-hidden="true" tabindex="-1"></a>  dec_time <span class="ot">&lt;-</span> window_data_102_comparison<span class="sc">$</span>dec.time</span>
<span id="cb257-38"><a href="#cb257-38" aria-hidden="true" tabindex="-1"></a>  window_data_102_comparison<span class="sc">$</span>cos_part <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb257-39"><a href="#cb257-39" aria-hidden="true" tabindex="-1"></a>  window_data_102_comparison<span class="sc">$</span>sin_part <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb257-40"><a href="#cb257-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-41"><a href="#cb257-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lineares Modell</span></span>
<span id="cb257-42"><a href="#cb257-42" aria-hidden="true" tabindex="-1"></a>  fit_test <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb257-43"><a href="#cb257-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> window_data_102_comparison)</span>
<span id="cb257-44"><a href="#cb257-44" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb257-45"><a href="#cb257-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-46"><a href="#cb257-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(fit_test, <span class="st">"lm"</span>)) {</span>
<span id="cb257-47"><a href="#cb257-47" aria-hidden="true" tabindex="-1"></a>    current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb257-48"><a href="#cb257-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb257-49"><a href="#cb257-49" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb257-50"><a href="#cb257-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-51"><a href="#cb257-51" aria-hidden="true" tabindex="-1"></a>  coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_test)</span>
<span id="cb257-52"><a href="#cb257-52" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(coefs[<span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"cos_part"</span>, <span class="st">"sin_part"</span>)]))) {</span>
<span id="cb257-53"><a href="#cb257-53" aria-hidden="true" tabindex="-1"></a>    current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb257-54"><a href="#cb257-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb257-55"><a href="#cb257-55" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb257-56"><a href="#cb257-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-57"><a href="#cb257-57" aria-hidden="true" tabindex="-1"></a>  intercept_L <span class="ot">&lt;-</span> coefs[<span class="st">"(Intercept)"</span>]</span>
<span id="cb257-58"><a href="#cb257-58" aria-hidden="true" tabindex="-1"></a>  beta_102    <span class="ot">&lt;-</span> coefs[<span class="st">"cos_part"</span>]</span>
<span id="cb257-59"><a href="#cb257-59" aria-hidden="true" tabindex="-1"></a>  gamma_102   <span class="ot">&lt;-</span> coefs[<span class="st">"sin_part"</span>]</span>
<span id="cb257-60"><a href="#cb257-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-61"><a href="#cb257-61" aria-hidden="true" tabindex="-1"></a>  amp_L      <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta_102<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma_102<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb257-62"><a href="#cb257-62" aria-hidden="true" tabindex="-1"></a>  acr_L_rad  <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma_102, beta_102)</span>
<span id="cb257-63"><a href="#cb257-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-64"><a href="#cb257-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cosinor-Paketmodell</span></span>
<span id="cb257-65"><a href="#cb257-65" aria-hidden="true" tabindex="-1"></a>  fit_102 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb257-66"><a href="#cb257-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), </span>
<span id="cb257-67"><a href="#cb257-67" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> window_data_102_comparison, </span>
<span id="cb257-68"><a href="#cb257-68" aria-hidden="true" tabindex="-1"></a>               <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb257-69"><a href="#cb257-69" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb257-70"><a href="#cb257-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-71"><a href="#cb257-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit_102, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb257-72"><a href="#cb257-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb257-73"><a href="#cb257-73" aria-hidden="true" tabindex="-1"></a>    coefs_102 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_102, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb257-74"><a href="#cb257-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb257-75"><a href="#cb257-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_102)) {</span>
<span id="cb257-76"><a href="#cb257-76" aria-hidden="true" tabindex="-1"></a>      amp_C      <span class="ot">&lt;-</span> coefs_102[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb257-77"><a href="#cb257-77" aria-hidden="true" tabindex="-1"></a>      acr_C_rad  <span class="ot">&lt;-</span> coefs_102[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb257-78"><a href="#cb257-78" aria-hidden="true" tabindex="-1"></a>      intercept_C <span class="ot">&lt;-</span> coefs_102[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb257-79"><a href="#cb257-79" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_102)) {</span>
<span id="cb257-80"><a href="#cb257-80" aria-hidden="true" tabindex="-1"></a>      amp_C      <span class="ot">&lt;-</span> coefs_102[<span class="st">"amp"</span>]</span>
<span id="cb257-81"><a href="#cb257-81" aria-hidden="true" tabindex="-1"></a>      acr_C_rad  <span class="ot">&lt;-</span> coefs_102[<span class="st">"acr"</span>]</span>
<span id="cb257-82"><a href="#cb257-82" aria-hidden="true" tabindex="-1"></a>      intercept_C <span class="ot">&lt;-</span> coefs_102[<span class="st">"(Intercept)"</span>]</span>
<span id="cb257-83"><a href="#cb257-83" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb257-84"><a href="#cb257-84" aria-hidden="true" tabindex="-1"></a>      current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb257-85"><a href="#cb257-85" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb257-86"><a href="#cb257-86" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb257-87"><a href="#cb257-87" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb257-88"><a href="#cb257-88" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ergebnisse speichern</span></span>
<span id="cb257-89"><a href="#cb257-89" aria-hidden="true" tabindex="-1"></a>    moving_window_comparison <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_comparison, <span class="fu">data.frame</span>(</span>
<span id="cb257-90"><a href="#cb257-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_102,</span>
<span id="cb257-91"><a href="#cb257-91" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp_C =</span> amp_C,</span>
<span id="cb257-92"><a href="#cb257-92" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp_L =</span> amp_L,</span>
<span id="cb257-93"><a href="#cb257-93" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad_C =</span> acr_C_rad,</span>
<span id="cb257-94"><a href="#cb257-94" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad_L =</span> acr_L_rad,</span>
<span id="cb257-95"><a href="#cb257-95" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept_C =</span> intercept_C,</span>
<span id="cb257-96"><a href="#cb257-96" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept_L =</span> intercept_L</span>
<span id="cb257-97"><a href="#cb257-97" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb257-98"><a href="#cb257-98" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb257-99"><a href="#cb257-99" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb257-100"><a href="#cb257-100" aria-hidden="true" tabindex="-1"></a>  current_start_102 <span class="ot">&lt;-</span> current_start_102 <span class="sc">+</span> step_size</span>
<span id="cb257-101"><a href="#cb257-101" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 104</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb258"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Empty dataframe to store results</span></span>
<span id="cb258-2"><a href="#cb258-2" aria-hidden="true" tabindex="-1"></a>moving_window_104 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb258-3"><a href="#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb258-4"><a href="#cb258-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb258-5"><a href="#cb258-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb258-6"><a href="#cb258-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb258-7"><a href="#cb258-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb258-8"><a href="#cb258-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb258-9"><a href="#cb258-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb258-10"><a href="#cb258-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb258-11"><a href="#cb258-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb258-12"><a href="#cb258-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb258-13"><a href="#cb258-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-14"><a href="#cb258-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time boundaries</span></span>
<span id="cb258-15"><a href="#cb258-15" aria-hidden="true" tabindex="-1"></a>start_time_mv_104 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_104_data<span class="sc">$</span>datetime)</span>
<span id="cb258-16"><a href="#cb258-16" aria-hidden="true" tabindex="-1"></a>end_time_mv_104 <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_104_data<span class="sc">$</span>datetime)</span>
<span id="cb258-17"><a href="#cb258-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-18"><a href="#cb258-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Window and step sizes</span></span>
<span id="cb258-19"><a href="#cb258-19" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb258-20"><a href="#cb258-20" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb258-21"><a href="#cb258-21" aria-hidden="true" tabindex="-1"></a>current_start_104 <span class="ot">&lt;-</span> start_time_mv_104</span>
<span id="cb258-22"><a href="#cb258-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb258-23"><a href="#cb258-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Sliding window analysis</span></span>
<span id="cb258-24"><a href="#cb258-24" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (current_start_104 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_104) {</span>
<span id="cb258-25"><a href="#cb258-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-26"><a href="#cb258-26" aria-hidden="true" tabindex="-1"></a>  current_end_104 <span class="ot">&lt;-</span> current_start_104 <span class="sc">+</span> window_length</span>
<span id="cb258-27"><a href="#cb258-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-28"><a href="#cb258-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter data within window</span></span>
<span id="cb258-29"><a href="#cb258-29" aria-hidden="true" tabindex="-1"></a>  window_data_104 <span class="ot">&lt;-</span> glucose_fit_104_data <span class="sc">%&gt;%</span></span>
<span id="cb258-30"><a href="#cb258-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_104 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_104)</span>
<span id="cb258-31"><a href="#cb258-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-32"><a href="#cb258-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skip windows with too few data points</span></span>
<span id="cb258-33"><a href="#cb258-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_104) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb258-34"><a href="#cb258-34" aria-hidden="true" tabindex="-1"></a>    current_start_104 <span class="ot">&lt;-</span> current_start_104 <span class="sc">+</span> step_size</span>
<span id="cb258-35"><a href="#cb258-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb258-36"><a href="#cb258-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb258-37"><a href="#cb258-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-38"><a href="#cb258-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit cosinor model</span></span>
<span id="cb258-39"><a href="#cb258-39" aria-hidden="true" tabindex="-1"></a>  fit_104 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb258-40"><a href="#cb258-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> window_data_104, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb258-41"><a href="#cb258-41" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb258-42"><a href="#cb258-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-43"><a href="#cb258-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit_104, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb258-44"><a href="#cb258-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb258-45"><a href="#cb258-45" aria-hidden="true" tabindex="-1"></a>    coefs_104 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_104, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb258-46"><a href="#cb258-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb258-47"><a href="#cb258-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb258-48"><a href="#cb258-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_104)) {</span>
<span id="cb258-49"><a href="#cb258-49" aria-hidden="true" tabindex="-1"></a>      amp_104 <span class="ot">&lt;-</span> coefs_104[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb258-50"><a href="#cb258-50" aria-hidden="true" tabindex="-1"></a>      acr_104 <span class="ot">&lt;-</span> coefs_104[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb258-51"><a href="#cb258-51" aria-hidden="true" tabindex="-1"></a>      intercept_104 <span class="ot">&lt;-</span> coefs_104[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb258-52"><a href="#cb258-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_104)) {</span>
<span id="cb258-53"><a href="#cb258-53" aria-hidden="true" tabindex="-1"></a>      amp_104 <span class="ot">&lt;-</span> coefs_104[<span class="st">"amp"</span>]</span>
<span id="cb258-54"><a href="#cb258-54" aria-hidden="true" tabindex="-1"></a>      acr_104 <span class="ot">&lt;-</span> coefs_104[<span class="st">"acr"</span>]</span>
<span id="cb258-55"><a href="#cb258-55" aria-hidden="true" tabindex="-1"></a>      intercept_104 <span class="ot">&lt;-</span> coefs_104[<span class="st">"(Intercept)"</span>]</span>
<span id="cb258-56"><a href="#cb258-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb258-57"><a href="#cb258-57" aria-hidden="true" tabindex="-1"></a>      current_start_104 <span class="ot">&lt;-</span> current_start_104 <span class="sc">+</span> step_size</span>
<span id="cb258-58"><a href="#cb258-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb258-59"><a href="#cb258-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb258-60"><a href="#cb258-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb258-61"><a href="#cb258-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Raw acrophase in hours</span></span>
<span id="cb258-62"><a href="#cb258-62" aria-hidden="true" tabindex="-1"></a>    acrophase_raw_104 <span class="ot">&lt;-</span> (acr_104 <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb258-63"><a href="#cb258-63" aria-hidden="true" tabindex="-1"></a>    acrophase_norm_104 <span class="ot">&lt;-</span> (acrophase_raw_104 <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb258-64"><a href="#cb258-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb258-65"><a href="#cb258-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max and min time depending on amplitude sign</span></span>
<span id="cb258-66"><a href="#cb258-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amp_104 <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb258-67"><a href="#cb258-67" aria-hidden="true" tabindex="-1"></a>      max_time_104 <span class="ot">&lt;-</span> acrophase_norm_104</span>
<span id="cb258-68"><a href="#cb258-68" aria-hidden="true" tabindex="-1"></a>      min_time_104 <span class="ot">&lt;-</span> (acrophase_norm_104 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb258-69"><a href="#cb258-69" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb258-70"><a href="#cb258-70" aria-hidden="true" tabindex="-1"></a>      min_time_104 <span class="ot">&lt;-</span> acrophase_norm_104</span>
<span id="cb258-71"><a href="#cb258-71" aria-hidden="true" tabindex="-1"></a>      max_time_104 <span class="ot">&lt;-</span> (acrophase_norm_104 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb258-72"><a href="#cb258-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb258-73"><a href="#cb258-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb258-74"><a href="#cb258-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure max &gt; 12 and min &lt; 12 (if desired visual convention)</span></span>
<span id="cb258-75"><a href="#cb258-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (max_time_104 <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb258-76"><a href="#cb258-76" aria-hidden="true" tabindex="-1"></a>      temp_104 <span class="ot">&lt;-</span> max_time_104</span>
<span id="cb258-77"><a href="#cb258-77" aria-hidden="true" tabindex="-1"></a>      max_time_104 <span class="ot">&lt;-</span> min_time_104</span>
<span id="cb258-78"><a href="#cb258-78" aria-hidden="true" tabindex="-1"></a>      min_time_104 <span class="ot">&lt;-</span> temp_104</span>
<span id="cb258-79"><a href="#cb258-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb258-80"><a href="#cb258-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb258-81"><a href="#cb258-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb258-82"><a href="#cb258-82" aria-hidden="true" tabindex="-1"></a>    moving_window_104 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_104, <span class="fu">data.frame</span>(</span>
<span id="cb258-83"><a href="#cb258-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_104,</span>
<span id="cb258-84"><a href="#cb258-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp_104,</span>
<span id="cb258-85"><a href="#cb258-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_104,</span>
<span id="cb258-86"><a href="#cb258-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw_104,</span>
<span id="cb258-87"><a href="#cb258-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm_104,</span>
<span id="cb258-88"><a href="#cb258-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time_104,</span>
<span id="cb258-89"><a href="#cb258-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time_104,</span>
<span id="cb258-90"><a href="#cb258-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept_104</span>
<span id="cb258-91"><a href="#cb258-91" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb258-92"><a href="#cb258-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb258-93"><a href="#cb258-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb258-94"><a href="#cb258-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move to next window</span></span>
<span id="cb258-95"><a href="#cb258-95" aria-hidden="true" tabindex="-1"></a>  current_start_104 <span class="ot">&lt;-</span> current_start_104 <span class="sc">+</span> step_size</span>
<span id="cb258-96"><a href="#cb258-96" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 104: Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb259"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_104, <span class="fu">aes</span>(<span class="at">x =</span> Window_Start)) <span class="sc">+</span></span>
<span id="cb259-2"><a href="#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb259-3"><a href="#cb259-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb259-4"><a href="#cb259-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb259-5"><a href="#cb259-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb259-6"><a href="#cb259-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb259-7"><a href="#cb259-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb259-8"><a href="#cb259-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Maximum"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Minimum"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb259-9"><a href="#cb259-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb259-10"><a href="#cb259-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb259-11"><a href="#cb259-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">2</span>),</span>
<span id="cb259-12"><a href="#cb259-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">24</span>),</span>
<span id="cb259-13"><a href="#cb259-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb259-14"><a href="#cb259-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb259-15"><a href="#cb259-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb259-16"><a href="#cb259-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Diurnal Timing of Maximum and Minimum (Glucose Cosinor)"</span>,</span>
<span id="cb259-17"><a href="#cb259-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Window Start Time"</span>,</span>
<span id="cb259-18"><a href="#cb259-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time of Day (Hours)"</span></span>
<span id="cb259-19"><a href="#cb259-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb259-20"><a href="#cb259-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb259-21"><a href="#cb259-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-100-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 107</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb260"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Empty dataframe to store results</span></span>
<span id="cb260-2"><a href="#cb260-2" aria-hidden="true" tabindex="-1"></a>moving_window_107 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb260-3"><a href="#cb260-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb260-4"><a href="#cb260-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb260-5"><a href="#cb260-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb260-6"><a href="#cb260-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb260-7"><a href="#cb260-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb260-8"><a href="#cb260-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb260-9"><a href="#cb260-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb260-10"><a href="#cb260-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb260-11"><a href="#cb260-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb260-12"><a href="#cb260-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb260-13"><a href="#cb260-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-14"><a href="#cb260-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time boundaries</span></span>
<span id="cb260-15"><a href="#cb260-15" aria-hidden="true" tabindex="-1"></a>start_time_mv_107 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_107_data<span class="sc">$</span>datetime)</span>
<span id="cb260-16"><a href="#cb260-16" aria-hidden="true" tabindex="-1"></a>end_time_mv_107 <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_107_data<span class="sc">$</span>datetime)</span>
<span id="cb260-17"><a href="#cb260-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-18"><a href="#cb260-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Window and step sizes</span></span>
<span id="cb260-19"><a href="#cb260-19" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb260-20"><a href="#cb260-20" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb260-21"><a href="#cb260-21" aria-hidden="true" tabindex="-1"></a>current_start_107 <span class="ot">&lt;-</span> start_time_mv_107</span>
<span id="cb260-22"><a href="#cb260-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb260-23"><a href="#cb260-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Sliding window analysis</span></span>
<span id="cb260-24"><a href="#cb260-24" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (current_start_107 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_107) {</span>
<span id="cb260-25"><a href="#cb260-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-26"><a href="#cb260-26" aria-hidden="true" tabindex="-1"></a>  current_end_107 <span class="ot">&lt;-</span> current_start_107 <span class="sc">+</span> window_length</span>
<span id="cb260-27"><a href="#cb260-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-28"><a href="#cb260-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter data within window</span></span>
<span id="cb260-29"><a href="#cb260-29" aria-hidden="true" tabindex="-1"></a>  window_data_107 <span class="ot">&lt;-</span> glucose_fit_107_data <span class="sc">%&gt;%</span></span>
<span id="cb260-30"><a href="#cb260-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_107 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_107)</span>
<span id="cb260-31"><a href="#cb260-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-32"><a href="#cb260-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skip windows with too few data points</span></span>
<span id="cb260-33"><a href="#cb260-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_107) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb260-34"><a href="#cb260-34" aria-hidden="true" tabindex="-1"></a>    current_start_107 <span class="ot">&lt;-</span> current_start_107 <span class="sc">+</span> step_size</span>
<span id="cb260-35"><a href="#cb260-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb260-36"><a href="#cb260-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb260-37"><a href="#cb260-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-38"><a href="#cb260-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit cosinor model</span></span>
<span id="cb260-39"><a href="#cb260-39" aria-hidden="true" tabindex="-1"></a>  fit_107 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb260-40"><a href="#cb260-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> window_data_107, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb260-41"><a href="#cb260-41" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb260-42"><a href="#cb260-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-43"><a href="#cb260-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit_107, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb260-44"><a href="#cb260-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-45"><a href="#cb260-45" aria-hidden="true" tabindex="-1"></a>    coefs_107 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_107, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb260-46"><a href="#cb260-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-47"><a href="#cb260-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb260-48"><a href="#cb260-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_107)) {</span>
<span id="cb260-49"><a href="#cb260-49" aria-hidden="true" tabindex="-1"></a>      amp_107 <span class="ot">&lt;-</span> coefs_107[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb260-50"><a href="#cb260-50" aria-hidden="true" tabindex="-1"></a>      acr_107 <span class="ot">&lt;-</span> coefs_107[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb260-51"><a href="#cb260-51" aria-hidden="true" tabindex="-1"></a>      intercept_107 <span class="ot">&lt;-</span> coefs_107[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb260-52"><a href="#cb260-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_107)) {</span>
<span id="cb260-53"><a href="#cb260-53" aria-hidden="true" tabindex="-1"></a>      amp_107 <span class="ot">&lt;-</span> coefs_107[<span class="st">"amp"</span>]</span>
<span id="cb260-54"><a href="#cb260-54" aria-hidden="true" tabindex="-1"></a>      acr_107 <span class="ot">&lt;-</span> coefs_107[<span class="st">"acr"</span>]</span>
<span id="cb260-55"><a href="#cb260-55" aria-hidden="true" tabindex="-1"></a>      intercept_107 <span class="ot">&lt;-</span> coefs_107[<span class="st">"(Intercept)"</span>]</span>
<span id="cb260-56"><a href="#cb260-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb260-57"><a href="#cb260-57" aria-hidden="true" tabindex="-1"></a>      current_start_107 <span class="ot">&lt;-</span> current_start_107 <span class="sc">+</span> step_size</span>
<span id="cb260-58"><a href="#cb260-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb260-59"><a href="#cb260-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb260-60"><a href="#cb260-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-61"><a href="#cb260-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Raw acrophase in hours</span></span>
<span id="cb260-62"><a href="#cb260-62" aria-hidden="true" tabindex="-1"></a>    acrophase_raw_107 <span class="ot">&lt;-</span> (acr_107 <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb260-63"><a href="#cb260-63" aria-hidden="true" tabindex="-1"></a>    acrophase_norm_107 <span class="ot">&lt;-</span> (acrophase_raw_107 <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb260-64"><a href="#cb260-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-65"><a href="#cb260-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max and min time depending on amplitude sign</span></span>
<span id="cb260-66"><a href="#cb260-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amp_107 <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb260-67"><a href="#cb260-67" aria-hidden="true" tabindex="-1"></a>      max_time_107 <span class="ot">&lt;-</span> acrophase_norm_107</span>
<span id="cb260-68"><a href="#cb260-68" aria-hidden="true" tabindex="-1"></a>      min_time_107 <span class="ot">&lt;-</span> (acrophase_norm_107 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb260-69"><a href="#cb260-69" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb260-70"><a href="#cb260-70" aria-hidden="true" tabindex="-1"></a>      min_time_107 <span class="ot">&lt;-</span> acrophase_norm_107</span>
<span id="cb260-71"><a href="#cb260-71" aria-hidden="true" tabindex="-1"></a>      max_time_107 <span class="ot">&lt;-</span> (acrophase_norm_107 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb260-72"><a href="#cb260-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb260-73"><a href="#cb260-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-74"><a href="#cb260-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure max &gt; 12 and min &lt; 12 (if desired visual convention)</span></span>
<span id="cb260-75"><a href="#cb260-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (max_time_107 <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb260-76"><a href="#cb260-76" aria-hidden="true" tabindex="-1"></a>      temp_107 <span class="ot">&lt;-</span> max_time_107</span>
<span id="cb260-77"><a href="#cb260-77" aria-hidden="true" tabindex="-1"></a>      max_time_107 <span class="ot">&lt;-</span> min_time_107</span>
<span id="cb260-78"><a href="#cb260-78" aria-hidden="true" tabindex="-1"></a>      min_time_107 <span class="ot">&lt;-</span> temp_107</span>
<span id="cb260-79"><a href="#cb260-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb260-80"><a href="#cb260-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb260-81"><a href="#cb260-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb260-82"><a href="#cb260-82" aria-hidden="true" tabindex="-1"></a>    moving_window_107 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_107, <span class="fu">data.frame</span>(</span>
<span id="cb260-83"><a href="#cb260-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_107,</span>
<span id="cb260-84"><a href="#cb260-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp_107,</span>
<span id="cb260-85"><a href="#cb260-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_107,</span>
<span id="cb260-86"><a href="#cb260-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw_107,</span>
<span id="cb260-87"><a href="#cb260-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm_107,</span>
<span id="cb260-88"><a href="#cb260-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time_107,</span>
<span id="cb260-89"><a href="#cb260-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time_107,</span>
<span id="cb260-90"><a href="#cb260-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept_107</span>
<span id="cb260-91"><a href="#cb260-91" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb260-92"><a href="#cb260-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb260-93"><a href="#cb260-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb260-94"><a href="#cb260-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move to next window</span></span>
<span id="cb260-95"><a href="#cb260-95" aria-hidden="true" tabindex="-1"></a>  current_start_107 <span class="ot">&lt;-</span> current_start_107 <span class="sc">+</span> step_size</span>
<span id="cb260-96"><a href="#cb260-96" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 107: Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb261"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_107, <span class="fu">aes</span>(<span class="at">x =</span> Window_Start)) <span class="sc">+</span></span>
<span id="cb261-2"><a href="#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb261-3"><a href="#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb261-4"><a href="#cb261-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb261-5"><a href="#cb261-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb261-6"><a href="#cb261-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb261-7"><a href="#cb261-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb261-8"><a href="#cb261-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Maximum"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Minimum"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb261-9"><a href="#cb261-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb261-10"><a href="#cb261-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb261-11"><a href="#cb261-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">2</span>),</span>
<span id="cb261-12"><a href="#cb261-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">24</span>),</span>
<span id="cb261-13"><a href="#cb261-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb261-14"><a href="#cb261-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb261-15"><a href="#cb261-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb261-16"><a href="#cb261-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Diurnal Timing of Maximum and Minimum (Glucose Cosinor)"</span>,</span>
<span id="cb261-17"><a href="#cb261-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Window Start Time"</span>,</span>
<span id="cb261-18"><a href="#cb261-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time of Day (Hours)"</span></span>
<span id="cb261-19"><a href="#cb261-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb261-20"><a href="#cb261-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb261-21"><a href="#cb261-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 108</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb262"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Empty dataframe to store results</span></span>
<span id="cb262-2"><a href="#cb262-2" aria-hidden="true" tabindex="-1"></a>moving_window_108 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb262-3"><a href="#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb262-4"><a href="#cb262-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb262-5"><a href="#cb262-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb262-6"><a href="#cb262-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb262-7"><a href="#cb262-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb262-8"><a href="#cb262-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb262-9"><a href="#cb262-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb262-10"><a href="#cb262-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb262-11"><a href="#cb262-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb262-12"><a href="#cb262-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb262-13"><a href="#cb262-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-14"><a href="#cb262-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time boundaries</span></span>
<span id="cb262-15"><a href="#cb262-15" aria-hidden="true" tabindex="-1"></a>start_time_mv_108 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_108_data<span class="sc">$</span>datetime)</span>
<span id="cb262-16"><a href="#cb262-16" aria-hidden="true" tabindex="-1"></a>end_time_mv_108 <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_108_data<span class="sc">$</span>datetime)</span>
<span id="cb262-17"><a href="#cb262-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-18"><a href="#cb262-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Window and step sizes</span></span>
<span id="cb262-19"><a href="#cb262-19" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb262-20"><a href="#cb262-20" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb262-21"><a href="#cb262-21" aria-hidden="true" tabindex="-1"></a>current_start_108 <span class="ot">&lt;-</span> start_time_mv_108</span>
<span id="cb262-22"><a href="#cb262-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-23"><a href="#cb262-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Sliding window analysis</span></span>
<span id="cb262-24"><a href="#cb262-24" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (current_start_108 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_108) {</span>
<span id="cb262-25"><a href="#cb262-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-26"><a href="#cb262-26" aria-hidden="true" tabindex="-1"></a>  current_end_108 <span class="ot">&lt;-</span> current_start_108 <span class="sc">+</span> window_length</span>
<span id="cb262-27"><a href="#cb262-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-28"><a href="#cb262-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter data within window</span></span>
<span id="cb262-29"><a href="#cb262-29" aria-hidden="true" tabindex="-1"></a>  window_data_108 <span class="ot">&lt;-</span> glucose_fit_108_data <span class="sc">%&gt;%</span></span>
<span id="cb262-30"><a href="#cb262-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_108 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_108)</span>
<span id="cb262-31"><a href="#cb262-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-32"><a href="#cb262-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skip windows with too few data points</span></span>
<span id="cb262-33"><a href="#cb262-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_108) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb262-34"><a href="#cb262-34" aria-hidden="true" tabindex="-1"></a>    current_start_108 <span class="ot">&lt;-</span> current_start_108 <span class="sc">+</span> step_size</span>
<span id="cb262-35"><a href="#cb262-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb262-36"><a href="#cb262-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb262-37"><a href="#cb262-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-38"><a href="#cb262-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit cosinor model</span></span>
<span id="cb262-39"><a href="#cb262-39" aria-hidden="true" tabindex="-1"></a>  fit_108 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb262-40"><a href="#cb262-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> window_data_108, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb262-41"><a href="#cb262-41" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb262-42"><a href="#cb262-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-43"><a href="#cb262-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit_108, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb262-44"><a href="#cb262-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-45"><a href="#cb262-45" aria-hidden="true" tabindex="-1"></a>    coefs_108 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_108, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb262-46"><a href="#cb262-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-47"><a href="#cb262-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb262-48"><a href="#cb262-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_108)) {</span>
<span id="cb262-49"><a href="#cb262-49" aria-hidden="true" tabindex="-1"></a>      amp_108 <span class="ot">&lt;-</span> coefs_108[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb262-50"><a href="#cb262-50" aria-hidden="true" tabindex="-1"></a>      acr_108 <span class="ot">&lt;-</span> coefs_108[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb262-51"><a href="#cb262-51" aria-hidden="true" tabindex="-1"></a>      intercept_108 <span class="ot">&lt;-</span> coefs_108[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb262-52"><a href="#cb262-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_108)) {</span>
<span id="cb262-53"><a href="#cb262-53" aria-hidden="true" tabindex="-1"></a>      amp_108 <span class="ot">&lt;-</span> coefs_108[<span class="st">"amp"</span>]</span>
<span id="cb262-54"><a href="#cb262-54" aria-hidden="true" tabindex="-1"></a>      acr_108 <span class="ot">&lt;-</span> coefs_108[<span class="st">"acr"</span>]</span>
<span id="cb262-55"><a href="#cb262-55" aria-hidden="true" tabindex="-1"></a>      intercept_108 <span class="ot">&lt;-</span> coefs_108[<span class="st">"(Intercept)"</span>]</span>
<span id="cb262-56"><a href="#cb262-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb262-57"><a href="#cb262-57" aria-hidden="true" tabindex="-1"></a>      current_start_108 <span class="ot">&lt;-</span> current_start_108 <span class="sc">+</span> step_size</span>
<span id="cb262-58"><a href="#cb262-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb262-59"><a href="#cb262-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb262-60"><a href="#cb262-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-61"><a href="#cb262-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Raw acrophase in hours</span></span>
<span id="cb262-62"><a href="#cb262-62" aria-hidden="true" tabindex="-1"></a>    acrophase_raw_108 <span class="ot">&lt;-</span> (acr_108 <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb262-63"><a href="#cb262-63" aria-hidden="true" tabindex="-1"></a>    acrophase_norm_108 <span class="ot">&lt;-</span> (acrophase_raw_108 <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb262-64"><a href="#cb262-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-65"><a href="#cb262-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max and min time depending on amplitude sign</span></span>
<span id="cb262-66"><a href="#cb262-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amp_108 <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb262-67"><a href="#cb262-67" aria-hidden="true" tabindex="-1"></a>      max_time_108 <span class="ot">&lt;-</span> acrophase_norm_108</span>
<span id="cb262-68"><a href="#cb262-68" aria-hidden="true" tabindex="-1"></a>      min_time_108 <span class="ot">&lt;-</span> (acrophase_norm_108 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb262-69"><a href="#cb262-69" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb262-70"><a href="#cb262-70" aria-hidden="true" tabindex="-1"></a>      min_time_108 <span class="ot">&lt;-</span> acrophase_norm_108</span>
<span id="cb262-71"><a href="#cb262-71" aria-hidden="true" tabindex="-1"></a>      max_time_108 <span class="ot">&lt;-</span> (acrophase_norm_108 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb262-72"><a href="#cb262-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb262-73"><a href="#cb262-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-74"><a href="#cb262-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure max &gt; 12 and min &lt; 12 (if desired visual convention)</span></span>
<span id="cb262-75"><a href="#cb262-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (max_time_108 <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb262-76"><a href="#cb262-76" aria-hidden="true" tabindex="-1"></a>      temp_108 <span class="ot">&lt;-</span> max_time_108</span>
<span id="cb262-77"><a href="#cb262-77" aria-hidden="true" tabindex="-1"></a>      max_time_108 <span class="ot">&lt;-</span> min_time_108</span>
<span id="cb262-78"><a href="#cb262-78" aria-hidden="true" tabindex="-1"></a>      min_time_108 <span class="ot">&lt;-</span> temp_108</span>
<span id="cb262-79"><a href="#cb262-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb262-80"><a href="#cb262-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb262-81"><a href="#cb262-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb262-82"><a href="#cb262-82" aria-hidden="true" tabindex="-1"></a>    moving_window_108 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_108, <span class="fu">data.frame</span>(</span>
<span id="cb262-83"><a href="#cb262-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_108,</span>
<span id="cb262-84"><a href="#cb262-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp_108,</span>
<span id="cb262-85"><a href="#cb262-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_108,</span>
<span id="cb262-86"><a href="#cb262-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw_108,</span>
<span id="cb262-87"><a href="#cb262-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm_108,</span>
<span id="cb262-88"><a href="#cb262-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time_108,</span>
<span id="cb262-89"><a href="#cb262-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time_108,</span>
<span id="cb262-90"><a href="#cb262-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept_108</span>
<span id="cb262-91"><a href="#cb262-91" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb262-92"><a href="#cb262-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb262-93"><a href="#cb262-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb262-94"><a href="#cb262-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move to next window</span></span>
<span id="cb262-95"><a href="#cb262-95" aria-hidden="true" tabindex="-1"></a>  current_start_108 <span class="ot">&lt;-</span> current_start_108 <span class="sc">+</span> step_size</span>
<span id="cb262-96"><a href="#cb262-96" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 108: Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb263"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_108, <span class="fu">aes</span>(<span class="at">x =</span> Window_Start)) <span class="sc">+</span></span>
<span id="cb263-2"><a href="#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb263-3"><a href="#cb263-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb263-4"><a href="#cb263-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb263-5"><a href="#cb263-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb263-6"><a href="#cb263-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb263-7"><a href="#cb263-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb263-8"><a href="#cb263-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Maximum"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Minimum"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb263-9"><a href="#cb263-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb263-10"><a href="#cb263-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb263-11"><a href="#cb263-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">2</span>),</span>
<span id="cb263-12"><a href="#cb263-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">24</span>),</span>
<span id="cb263-13"><a href="#cb263-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb263-14"><a href="#cb263-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb263-15"><a href="#cb263-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb263-16"><a href="#cb263-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Diurnal Timing of Maximum and Minimum (Glucose Cosinor)"</span>,</span>
<span id="cb263-17"><a href="#cb263-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Window Start Time"</span>,</span>
<span id="cb263-18"><a href="#cb263-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time of Day (Hours)"</span></span>
<span id="cb263-19"><a href="#cb263-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb263-20"><a href="#cb263-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb263-21"><a href="#cb263-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-104-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 109</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb264"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb264-1"><a href="#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Empty dataframe to store results</span></span>
<span id="cb264-2"><a href="#cb264-2" aria-hidden="true" tabindex="-1"></a>moving_window_109 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb264-3"><a href="#cb264-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb264-4"><a href="#cb264-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb264-5"><a href="#cb264-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb264-6"><a href="#cb264-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb264-7"><a href="#cb264-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb264-8"><a href="#cb264-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb264-9"><a href="#cb264-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb264-10"><a href="#cb264-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb264-11"><a href="#cb264-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb264-12"><a href="#cb264-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb264-13"><a href="#cb264-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-14"><a href="#cb264-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time boundaries</span></span>
<span id="cb264-15"><a href="#cb264-15" aria-hidden="true" tabindex="-1"></a>start_time_mv_109 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_109_data<span class="sc">$</span>datetime)</span>
<span id="cb264-16"><a href="#cb264-16" aria-hidden="true" tabindex="-1"></a>end_time_mv_109 <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_109_data<span class="sc">$</span>datetime)</span>
<span id="cb264-17"><a href="#cb264-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-18"><a href="#cb264-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Window and step sizes</span></span>
<span id="cb264-19"><a href="#cb264-19" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb264-20"><a href="#cb264-20" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb264-21"><a href="#cb264-21" aria-hidden="true" tabindex="-1"></a>current_start_109 <span class="ot">&lt;-</span> start_time_mv_109</span>
<span id="cb264-22"><a href="#cb264-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-23"><a href="#cb264-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Sliding window analysis</span></span>
<span id="cb264-24"><a href="#cb264-24" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (current_start_109 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_109) {</span>
<span id="cb264-25"><a href="#cb264-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-26"><a href="#cb264-26" aria-hidden="true" tabindex="-1"></a>  current_end_109 <span class="ot">&lt;-</span> current_start_109 <span class="sc">+</span> window_length</span>
<span id="cb264-27"><a href="#cb264-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-28"><a href="#cb264-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter data within window</span></span>
<span id="cb264-29"><a href="#cb264-29" aria-hidden="true" tabindex="-1"></a>  window_data_109 <span class="ot">&lt;-</span> glucose_fit_109_data <span class="sc">%&gt;%</span></span>
<span id="cb264-30"><a href="#cb264-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_109 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_109)</span>
<span id="cb264-31"><a href="#cb264-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-32"><a href="#cb264-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skip windows with too few data points</span></span>
<span id="cb264-33"><a href="#cb264-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_109) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb264-34"><a href="#cb264-34" aria-hidden="true" tabindex="-1"></a>    current_start_109 <span class="ot">&lt;-</span> current_start_109 <span class="sc">+</span> step_size</span>
<span id="cb264-35"><a href="#cb264-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb264-36"><a href="#cb264-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb264-37"><a href="#cb264-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-38"><a href="#cb264-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit cosinor model</span></span>
<span id="cb264-39"><a href="#cb264-39" aria-hidden="true" tabindex="-1"></a>  fit_109 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb264-40"><a href="#cb264-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> window_data_109, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb264-41"><a href="#cb264-41" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb264-42"><a href="#cb264-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-43"><a href="#cb264-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit_109, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb264-44"><a href="#cb264-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb264-45"><a href="#cb264-45" aria-hidden="true" tabindex="-1"></a>    coefs_109 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_109, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb264-46"><a href="#cb264-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb264-47"><a href="#cb264-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb264-48"><a href="#cb264-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_109)) {</span>
<span id="cb264-49"><a href="#cb264-49" aria-hidden="true" tabindex="-1"></a>      amp_109 <span class="ot">&lt;-</span> coefs_109[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb264-50"><a href="#cb264-50" aria-hidden="true" tabindex="-1"></a>      acr_109 <span class="ot">&lt;-</span> coefs_109[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb264-51"><a href="#cb264-51" aria-hidden="true" tabindex="-1"></a>      intercept_109 <span class="ot">&lt;-</span> coefs_109[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb264-52"><a href="#cb264-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_109)) {</span>
<span id="cb264-53"><a href="#cb264-53" aria-hidden="true" tabindex="-1"></a>      amp_109 <span class="ot">&lt;-</span> coefs_109[<span class="st">"amp"</span>]</span>
<span id="cb264-54"><a href="#cb264-54" aria-hidden="true" tabindex="-1"></a>      acr_109 <span class="ot">&lt;-</span> coefs_109[<span class="st">"acr"</span>]</span>
<span id="cb264-55"><a href="#cb264-55" aria-hidden="true" tabindex="-1"></a>      intercept_109 <span class="ot">&lt;-</span> coefs_109[<span class="st">"(Intercept)"</span>]</span>
<span id="cb264-56"><a href="#cb264-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb264-57"><a href="#cb264-57" aria-hidden="true" tabindex="-1"></a>      current_start_109 <span class="ot">&lt;-</span> current_start_109 <span class="sc">+</span> step_size</span>
<span id="cb264-58"><a href="#cb264-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb264-59"><a href="#cb264-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb264-60"><a href="#cb264-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb264-61"><a href="#cb264-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Raw acrophase in hours</span></span>
<span id="cb264-62"><a href="#cb264-62" aria-hidden="true" tabindex="-1"></a>    acrophase_raw_109 <span class="ot">&lt;-</span> (acr_109 <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb264-63"><a href="#cb264-63" aria-hidden="true" tabindex="-1"></a>    acrophase_norm_109 <span class="ot">&lt;-</span> (acrophase_raw_109 <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb264-64"><a href="#cb264-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb264-65"><a href="#cb264-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max and min time depending on amplitude sign</span></span>
<span id="cb264-66"><a href="#cb264-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amp_109 <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb264-67"><a href="#cb264-67" aria-hidden="true" tabindex="-1"></a>      max_time_109 <span class="ot">&lt;-</span> acrophase_norm_109</span>
<span id="cb264-68"><a href="#cb264-68" aria-hidden="true" tabindex="-1"></a>      min_time_109 <span class="ot">&lt;-</span> (acrophase_norm_109 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb264-69"><a href="#cb264-69" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb264-70"><a href="#cb264-70" aria-hidden="true" tabindex="-1"></a>      min_time_109 <span class="ot">&lt;-</span> acrophase_norm_109</span>
<span id="cb264-71"><a href="#cb264-71" aria-hidden="true" tabindex="-1"></a>      max_time_109 <span class="ot">&lt;-</span> (acrophase_norm_109 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb264-72"><a href="#cb264-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb264-73"><a href="#cb264-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb264-74"><a href="#cb264-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure max &gt; 12 and min &lt; 12 (if desired visual convention)</span></span>
<span id="cb264-75"><a href="#cb264-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (max_time_109 <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb264-76"><a href="#cb264-76" aria-hidden="true" tabindex="-1"></a>      temp_109 <span class="ot">&lt;-</span> max_time_109</span>
<span id="cb264-77"><a href="#cb264-77" aria-hidden="true" tabindex="-1"></a>      max_time_109 <span class="ot">&lt;-</span> min_time_109</span>
<span id="cb264-78"><a href="#cb264-78" aria-hidden="true" tabindex="-1"></a>      min_time_109 <span class="ot">&lt;-</span> temp_109</span>
<span id="cb264-79"><a href="#cb264-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb264-80"><a href="#cb264-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb264-81"><a href="#cb264-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb264-82"><a href="#cb264-82" aria-hidden="true" tabindex="-1"></a>    moving_window_109 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_109, <span class="fu">data.frame</span>(</span>
<span id="cb264-83"><a href="#cb264-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_109,</span>
<span id="cb264-84"><a href="#cb264-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp_109,</span>
<span id="cb264-85"><a href="#cb264-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_109,</span>
<span id="cb264-86"><a href="#cb264-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw_109,</span>
<span id="cb264-87"><a href="#cb264-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm_109,</span>
<span id="cb264-88"><a href="#cb264-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time_109,</span>
<span id="cb264-89"><a href="#cb264-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time_109,</span>
<span id="cb264-90"><a href="#cb264-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept_109</span>
<span id="cb264-91"><a href="#cb264-91" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb264-92"><a href="#cb264-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb264-93"><a href="#cb264-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb264-94"><a href="#cb264-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move to next window</span></span>
<span id="cb264-95"><a href="#cb264-95" aria-hidden="true" tabindex="-1"></a>  current_start_109 <span class="ot">&lt;-</span> current_start_109 <span class="sc">+</span> step_size</span>
<span id="cb264-96"><a href="#cb264-96" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 109: Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb265"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_109, <span class="fu">aes</span>(<span class="at">x =</span> Window_Start)) <span class="sc">+</span></span>
<span id="cb265-2"><a href="#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb265-3"><a href="#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb265-4"><a href="#cb265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb265-5"><a href="#cb265-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb265-6"><a href="#cb265-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb265-7"><a href="#cb265-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb265-8"><a href="#cb265-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Maximum"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Minimum"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb265-9"><a href="#cb265-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb265-10"><a href="#cb265-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb265-11"><a href="#cb265-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">2</span>),</span>
<span id="cb265-12"><a href="#cb265-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">24</span>),</span>
<span id="cb265-13"><a href="#cb265-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb265-14"><a href="#cb265-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb265-15"><a href="#cb265-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb265-16"><a href="#cb265-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Diurnal Timing of Maximum and Minimum (Glucose Cosinor)"</span>,</span>
<span id="cb265-17"><a href="#cb265-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Window Start Time"</span>,</span>
<span id="cb265-18"><a href="#cb265-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time of Day (Hours)"</span></span>
<span id="cb265-19"><a href="#cb265-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb265-20"><a href="#cb265-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb265-21"><a href="#cb265-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-106-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 112</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb266"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Empty dataframe to store results</span></span>
<span id="cb266-2"><a href="#cb266-2" aria-hidden="true" tabindex="-1"></a>moving_window_112 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb266-3"><a href="#cb266-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Window_Start =</span> <span class="fu">as.POSIXct</span>(<span class="fu">character</span>()),</span>
<span id="cb266-4"><a href="#cb266-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Amp =</span> <span class="fu">numeric</span>(),</span>
<span id="cb266-5"><a href="#cb266-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Rad =</span> <span class="fu">numeric</span>(),</span>
<span id="cb266-6"><a href="#cb266-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw =</span> <span class="fu">numeric</span>(),</span>
<span id="cb266-7"><a href="#cb266-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Acrophase_Raw_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb266-8"><a href="#cb266-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Max_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb266-9"><a href="#cb266-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Min_Time_Hours =</span> <span class="fu">numeric</span>(),</span>
<span id="cb266-10"><a href="#cb266-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Intercept =</span> <span class="fu">numeric</span>(),</span>
<span id="cb266-11"><a href="#cb266-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb266-12"><a href="#cb266-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb266-13"><a href="#cb266-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-14"><a href="#cb266-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Define time boundaries</span></span>
<span id="cb266-15"><a href="#cb266-15" aria-hidden="true" tabindex="-1"></a>start_time_mv_112 <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_fit_112_data<span class="sc">$</span>datetime)</span>
<span id="cb266-16"><a href="#cb266-16" aria-hidden="true" tabindex="-1"></a>end_time_mv_112 <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_fit_112_data<span class="sc">$</span>datetime)</span>
<span id="cb266-17"><a href="#cb266-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-18"><a href="#cb266-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Window and step sizes</span></span>
<span id="cb266-19"><a href="#cb266-19" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb266-20"><a href="#cb266-20" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb266-21"><a href="#cb266-21" aria-hidden="true" tabindex="-1"></a>current_start_112 <span class="ot">&lt;-</span> start_time_mv_112</span>
<span id="cb266-22"><a href="#cb266-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-23"><a href="#cb266-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Sliding window analysis</span></span>
<span id="cb266-24"><a href="#cb266-24" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (current_start_112 <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time_mv_112) {</span>
<span id="cb266-25"><a href="#cb266-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-26"><a href="#cb266-26" aria-hidden="true" tabindex="-1"></a>  current_end_112 <span class="ot">&lt;-</span> current_start_112 <span class="sc">+</span> window_length</span>
<span id="cb266-27"><a href="#cb266-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-28"><a href="#cb266-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter data within window</span></span>
<span id="cb266-29"><a href="#cb266-29" aria-hidden="true" tabindex="-1"></a>  window_data_112 <span class="ot">&lt;-</span> glucose_fit_112_data <span class="sc">%&gt;%</span></span>
<span id="cb266-30"><a href="#cb266-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start_112 <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end_112)</span>
<span id="cb266-31"><a href="#cb266-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-32"><a href="#cb266-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Skip windows with too few data points</span></span>
<span id="cb266-33"><a href="#cb266-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(window_data_112) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb266-34"><a href="#cb266-34" aria-hidden="true" tabindex="-1"></a>    current_start_112 <span class="ot">&lt;-</span> current_start_112 <span class="sc">+</span> step_size</span>
<span id="cb266-35"><a href="#cb266-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb266-36"><a href="#cb266-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb266-37"><a href="#cb266-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-38"><a href="#cb266-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit cosinor model</span></span>
<span id="cb266-39"><a href="#cb266-39" aria-hidden="true" tabindex="-1"></a>  fit_112 <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb266-40"><a href="#cb266-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cosinor.lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> <span class="fu">time</span>(dec.time), <span class="at">data =</span> window_data_112, <span class="at">period =</span> <span class="dv">24</span>)</span>
<span id="cb266-41"><a href="#cb266-41" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb266-42"><a href="#cb266-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-43"><a href="#cb266-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(fit_112, <span class="st">"cosinor.lm"</span>)) {</span>
<span id="cb266-44"><a href="#cb266-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb266-45"><a href="#cb266-45" aria-hidden="true" tabindex="-1"></a>    coefs_112 <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit_112, <span class="at">transformed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb266-46"><a href="#cb266-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb266-47"><a href="#cb266-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb266-48"><a href="#cb266-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.matrix</span>(coefs_112)) {</span>
<span id="cb266-49"><a href="#cb266-49" aria-hidden="true" tabindex="-1"></a>      amp_112 <span class="ot">&lt;-</span> coefs_112[<span class="st">"amp"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb266-50"><a href="#cb266-50" aria-hidden="true" tabindex="-1"></a>      acr_112 <span class="ot">&lt;-</span> coefs_112[<span class="st">"acr"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb266-51"><a href="#cb266-51" aria-hidden="true" tabindex="-1"></a>      intercept_112 <span class="ot">&lt;-</span> coefs_112[<span class="st">"(Intercept)"</span>, <span class="st">"estimate"</span>]</span>
<span id="cb266-52"><a href="#cb266-52" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.vector</span>(coefs_112)) {</span>
<span id="cb266-53"><a href="#cb266-53" aria-hidden="true" tabindex="-1"></a>      amp_112 <span class="ot">&lt;-</span> coefs_112[<span class="st">"amp"</span>]</span>
<span id="cb266-54"><a href="#cb266-54" aria-hidden="true" tabindex="-1"></a>      acr_112 <span class="ot">&lt;-</span> coefs_112[<span class="st">"acr"</span>]</span>
<span id="cb266-55"><a href="#cb266-55" aria-hidden="true" tabindex="-1"></a>      intercept_112 <span class="ot">&lt;-</span> coefs_112[<span class="st">"(Intercept)"</span>]</span>
<span id="cb266-56"><a href="#cb266-56" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb266-57"><a href="#cb266-57" aria-hidden="true" tabindex="-1"></a>      current_start_112 <span class="ot">&lt;-</span> current_start_112 <span class="sc">+</span> step_size</span>
<span id="cb266-58"><a href="#cb266-58" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb266-59"><a href="#cb266-59" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb266-60"><a href="#cb266-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb266-61"><a href="#cb266-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Raw acrophase in hours</span></span>
<span id="cb266-62"><a href="#cb266-62" aria-hidden="true" tabindex="-1"></a>    acrophase_raw_112 <span class="ot">&lt;-</span> (acr_112 <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb266-63"><a href="#cb266-63" aria-hidden="true" tabindex="-1"></a>    acrophase_norm_112 <span class="ot">&lt;-</span> (acrophase_raw_112 <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb266-64"><a href="#cb266-64" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb266-65"><a href="#cb266-65" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Max and min time depending on amplitude sign</span></span>
<span id="cb266-66"><a href="#cb266-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (amp_112 <span class="sc">&gt;=</span> <span class="dv">0</span>) {</span>
<span id="cb266-67"><a href="#cb266-67" aria-hidden="true" tabindex="-1"></a>      max_time_112 <span class="ot">&lt;-</span> acrophase_norm_112</span>
<span id="cb266-68"><a href="#cb266-68" aria-hidden="true" tabindex="-1"></a>      min_time_112 <span class="ot">&lt;-</span> (acrophase_norm_112 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb266-69"><a href="#cb266-69" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb266-70"><a href="#cb266-70" aria-hidden="true" tabindex="-1"></a>      min_time_112 <span class="ot">&lt;-</span> acrophase_norm_112</span>
<span id="cb266-71"><a href="#cb266-71" aria-hidden="true" tabindex="-1"></a>      max_time_112 <span class="ot">&lt;-</span> (acrophase_norm_112 <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb266-72"><a href="#cb266-72" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb266-73"><a href="#cb266-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb266-74"><a href="#cb266-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure max &gt; 12 and min &lt; 12 (if desired visual convention)</span></span>
<span id="cb266-75"><a href="#cb266-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (max_time_112 <span class="sc">&lt;</span> <span class="dv">12</span>) {</span>
<span id="cb266-76"><a href="#cb266-76" aria-hidden="true" tabindex="-1"></a>      temp_112 <span class="ot">&lt;-</span> max_time_112</span>
<span id="cb266-77"><a href="#cb266-77" aria-hidden="true" tabindex="-1"></a>      max_time_112 <span class="ot">&lt;-</span> min_time_112</span>
<span id="cb266-78"><a href="#cb266-78" aria-hidden="true" tabindex="-1"></a>      min_time_112 <span class="ot">&lt;-</span> temp_112</span>
<span id="cb266-79"><a href="#cb266-79" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb266-80"><a href="#cb266-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb266-81"><a href="#cb266-81" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store results</span></span>
<span id="cb266-82"><a href="#cb266-82" aria-hidden="true" tabindex="-1"></a>    moving_window_112 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(moving_window_112, <span class="fu">data.frame</span>(</span>
<span id="cb266-83"><a href="#cb266-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start_112,</span>
<span id="cb266-84"><a href="#cb266-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp_112,</span>
<span id="cb266-85"><a href="#cb266-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_112,</span>
<span id="cb266-86"><a href="#cb266-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw_112,</span>
<span id="cb266-87"><a href="#cb266-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm_112,</span>
<span id="cb266-88"><a href="#cb266-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time_112,</span>
<span id="cb266-89"><a href="#cb266-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time_112,</span>
<span id="cb266-90"><a href="#cb266-90" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept_112</span>
<span id="cb266-91"><a href="#cb266-91" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb266-92"><a href="#cb266-92" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb266-93"><a href="#cb266-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb266-94"><a href="#cb266-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Move to next window</span></span>
<span id="cb266-95"><a href="#cb266-95" aria-hidden="true" tabindex="-1"></a>  current_start_112 <span class="ot">&lt;-</span> current_start_112 <span class="sc">+</span> step_size</span>
<span id="cb266-96"><a href="#cb266-96" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving Window Cos for 112: Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb267"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_112, <span class="fu">aes</span>(<span class="at">x =</span> Window_Start)) <span class="sc">+</span></span>
<span id="cb267-2"><a href="#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb267-3"><a href="#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb267-4"><a href="#cb267-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Max_Time_Hours, <span class="at">color =</span> <span class="st">"Maximum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb267-5"><a href="#cb267-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Min_Time_Hours, <span class="at">color =</span> <span class="st">"Minimum"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb267-6"><a href="#cb267-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb267-7"><a href="#cb267-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Time Point"</span>,</span>
<span id="cb267-8"><a href="#cb267-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Maximum"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Minimum"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb267-9"><a href="#cb267-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb267-10"><a href="#cb267-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb267-11"><a href="#cb267-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">24</span>, <span class="dv">2</span>),</span>
<span id="cb267-12"><a href="#cb267-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">24</span>),</span>
<span id="cb267-13"><a href="#cb267-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb267-14"><a href="#cb267-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb267-15"><a href="#cb267-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb267-16"><a href="#cb267-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Diurnal Timing of Maximum and Minimum (Glucose Cosinor)"</span>,</span>
<span id="cb267-17"><a href="#cb267-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Window Start Time"</span>,</span>
<span id="cb267-18"><a href="#cb267-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Time of Day (Hours)"</span></span>
<span id="cb267-19"><a href="#cb267-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb267-20"><a href="#cb267-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb267-21"><a href="#cb267-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-108-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="moving-window-with-lm" class="level4">
<h4 class="anchored" data-anchor-id="moving-window-with-lm">Moving Window with lm()</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb268"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb268-1"><a href="#cb268-1" aria-hidden="true" tabindex="-1"></a>glucose_fit_data <span class="ot">&lt;-</span> glucose_fit_data <span class="sc">%&gt;%</span></span>
<span id="cb268-2"><a href="#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb268-3"><a href="#cb268-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># DST-Correction</span></span>
<span id="cb268-4"><a href="#cb268-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">datetime_std =</span> datetime <span class="sc">-</span> <span class="fu">hours</span>(<span class="fu">as.integer</span>(lubridate<span class="sc">::</span><span class="fu">dst</span>(datetime))),</span>
<span id="cb268-5"><a href="#cb268-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb268-6"><a href="#cb268-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># decimal time based on standard time</span></span>
<span id="cb268-7"><a href="#cb268-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">dec.time_std =</span> <span class="fu">hour</span>(datetime_std) <span class="sc">+</span> <span class="fu">minute</span>(datetime_std) <span class="sc">/</span> <span class="dv">60</span>,</span>
<span id="cb268-8"><a href="#cb268-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Moving window with lm() and standard time</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb269"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leere Liste für alle IDs</span></span>
<span id="cb269-2"><a href="#cb269-2" aria-hidden="true" tabindex="-1"></a>all_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb269-3"><a href="#cb269-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-4"><a href="#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle IDs extrahieren</span></span>
<span id="cb269-5"><a href="#cb269-5" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(glucose_fit_data<span class="sc">$</span>ID)</span>
<span id="cb269-6"><a href="#cb269-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-7"><a href="#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fenster-Parameter</span></span>
<span id="cb269-8"><a href="#cb269-8" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb269-9"><a href="#cb269-9" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb269-10"><a href="#cb269-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-11"><a href="#cb269-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Schleife über alle IDs</span></span>
<span id="cb269-12"><a href="#cb269-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> ids) {</span>
<span id="cb269-13"><a href="#cb269-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb269-14"><a href="#cb269-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Daten für aktuelle ID</span></span>
<span id="cb269-15"><a href="#cb269-15" aria-hidden="true" tabindex="-1"></a>  glucose_id_data <span class="ot">&lt;-</span> glucose_fit_data <span class="sc">%&gt;%</span></span>
<span id="cb269-16"><a href="#cb269-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb269-17"><a href="#cb269-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb269-18"><a href="#cb269-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prüfe, ob genug Daten da sind</span></span>
<span id="cb269-19"><a href="#cb269-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(glucose_id_data) <span class="sc">&lt;</span> <span class="dv">400</span>) <span class="cf">next</span></span>
<span id="cb269-20"><a href="#cb269-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb269-21"><a href="#cb269-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zeitgrenzent</span></span>
<span id="cb269-22"><a href="#cb269-22" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_id_data<span class="sc">$</span>datetime_std,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb269-23"><a href="#cb269-23" aria-hidden="true" tabindex="-1"></a>  end_time   <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_id_data<span class="sc">$</span>datetime_std,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb269-24"><a href="#cb269-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb269-25"><a href="#cb269-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Starte Sliding Window</span></span>
<span id="cb269-26"><a href="#cb269-26" aria-hidden="true" tabindex="-1"></a>  current_start <span class="ot">&lt;-</span> start_time</span>
<span id="cb269-27"><a href="#cb269-27" aria-hidden="true" tabindex="-1"></a>  id_results <span class="ot">&lt;-</span> <span class="fu">list</span>()  <span class="co"># save per ID</span></span>
<span id="cb269-28"><a href="#cb269-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb269-29"><a href="#cb269-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (current_start <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time) {</span>
<span id="cb269-30"><a href="#cb269-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-31"><a href="#cb269-31" aria-hidden="true" tabindex="-1"></a>    current_end <span class="ot">&lt;-</span> current_start <span class="sc">+</span> window_length</span>
<span id="cb269-32"><a href="#cb269-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-33"><a href="#cb269-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Daten im Fenster</span></span>
<span id="cb269-34"><a href="#cb269-34" aria-hidden="true" tabindex="-1"></a>    window_data <span class="ot">&lt;-</span> glucose_id_data <span class="sc">%&gt;%</span></span>
<span id="cb269-35"><a href="#cb269-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(datetime_std <span class="sc">&gt;=</span> current_start <span class="sc">&amp;</span> datetime_std <span class="sc">&lt;</span> current_end)</span>
<span id="cb269-36"><a href="#cb269-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-37"><a href="#cb269-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip bei zu wenigen Datenpunkten</span></span>
<span id="cb269-38"><a href="#cb269-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(window_data) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb269-39"><a href="#cb269-39" aria-hidden="true" tabindex="-1"></a>      current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb269-40"><a href="#cb269-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb269-41"><a href="#cb269-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb269-42"><a href="#cb269-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-43"><a href="#cb269-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate cosine components</span></span>
<span id="cb269-44"><a href="#cb269-44" aria-hidden="true" tabindex="-1"></a>    dec_time <span class="ot">&lt;-</span> window_data<span class="sc">$</span>dec.time_std</span>
<span id="cb269-45"><a href="#cb269-45" aria-hidden="true" tabindex="-1"></a>    window_data<span class="sc">$</span>cos_part <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb269-46"><a href="#cb269-46" aria-hidden="true" tabindex="-1"></a>    window_data<span class="sc">$</span>sin_part <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb269-47"><a href="#cb269-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-48"><a href="#cb269-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cosinor-Fit</span></span>
<span id="cb269-49"><a href="#cb269-49" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb269-50"><a href="#cb269-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> window_data)</span>
<span id="cb269-51"><a href="#cb269-51" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb269-52"><a href="#cb269-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-53"><a href="#cb269-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Falls Fit nicht funktioniert</span></span>
<span id="cb269-54"><a href="#cb269-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(fit, <span class="st">"lm"</span>)) {</span>
<span id="cb269-55"><a href="#cb269-55" aria-hidden="true" tabindex="-1"></a>      current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb269-56"><a href="#cb269-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb269-57"><a href="#cb269-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb269-58"><a href="#cb269-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-59"><a href="#cb269-59" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)</span>
<span id="cb269-60"><a href="#cb269-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-61"><a href="#cb269-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Falls NA in Koeffizienten</span></span>
<span id="cb269-62"><a href="#cb269-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(coefs[<span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"cos_part"</span>, <span class="st">"sin_part"</span>)]))) {</span>
<span id="cb269-63"><a href="#cb269-63" aria-hidden="true" tabindex="-1"></a>      current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb269-64"><a href="#cb269-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb269-65"><a href="#cb269-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb269-66"><a href="#cb269-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-67"><a href="#cb269-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extrahiere Parameter</span></span>
<span id="cb269-68"><a href="#cb269-68" aria-hidden="true" tabindex="-1"></a>    intercept <span class="ot">&lt;-</span> coefs[<span class="st">"(Intercept)"</span>]</span>
<span id="cb269-69"><a href="#cb269-69" aria-hidden="true" tabindex="-1"></a>    beta      <span class="ot">&lt;-</span> coefs[<span class="st">"cos_part"</span>]</span>
<span id="cb269-70"><a href="#cb269-70" aria-hidden="true" tabindex="-1"></a>    gamma     <span class="ot">&lt;-</span> coefs[<span class="st">"sin_part"</span>]</span>
<span id="cb269-71"><a href="#cb269-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-72"><a href="#cb269-72" aria-hidden="true" tabindex="-1"></a>    amp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb269-73"><a href="#cb269-73" aria-hidden="true" tabindex="-1"></a>    acr_rad <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma, beta)</span>
<span id="cb269-74"><a href="#cb269-74" aria-hidden="true" tabindex="-1"></a>    acrophase_raw <span class="ot">&lt;-</span> (acr_rad <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb269-75"><a href="#cb269-75" aria-hidden="true" tabindex="-1"></a>    acrophase_norm <span class="ot">&lt;-</span> (acrophase_raw <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb269-76"><a href="#cb269-76" aria-hidden="true" tabindex="-1"></a>    max_time <span class="ot">&lt;-</span> acrophase_norm</span>
<span id="cb269-77"><a href="#cb269-77" aria-hidden="true" tabindex="-1"></a>    min_time <span class="ot">&lt;-</span> (acrophase_norm <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb269-78"><a href="#cb269-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-79"><a href="#cb269-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ergebnisse speichern</span></span>
<span id="cb269-80"><a href="#cb269-80" aria-hidden="true" tabindex="-1"></a>    id_results[[<span class="fu">length</span>(id_results) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb269-81"><a href="#cb269-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">ID =</span> id,</span>
<span id="cb269-82"><a href="#cb269-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start,</span>
<span id="cb269-83"><a href="#cb269-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp,</span>
<span id="cb269-84"><a href="#cb269-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_rad,</span>
<span id="cb269-85"><a href="#cb269-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw,</span>
<span id="cb269-86"><a href="#cb269-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm,</span>
<span id="cb269-87"><a href="#cb269-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time,</span>
<span id="cb269-88"><a href="#cb269-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time,</span>
<span id="cb269-89"><a href="#cb269-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept</span>
<span id="cb269-90"><a href="#cb269-90" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb269-91"><a href="#cb269-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb269-92"><a href="#cb269-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nächstes Fenster</span></span>
<span id="cb269-93"><a href="#cb269-93" aria-hidden="true" tabindex="-1"></a>    current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb269-94"><a href="#cb269-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb269-95"><a href="#cb269-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb269-96"><a href="#cb269-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ergebnisse der aktuellen ID speichern</span></span>
<span id="cb269-97"><a href="#cb269-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(id_results) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb269-98"><a href="#cb269-98" aria-hidden="true" tabindex="-1"></a>    all_results[[<span class="fu">length</span>(all_results) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, id_results)</span>
<span id="cb269-99"><a href="#cb269-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb269-100"><a href="#cb269-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb269-101"><a href="#cb269-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-102"><a href="#cb269-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Kombiniere alle Ergebnisse in ein DataFrame</span></span>
<span id="cb269-103"><a href="#cb269-103" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_results)</span>
<span id="cb269-104"><a href="#cb269-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-105"><a href="#cb269-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Ergebnisse ansehen</span></span>
<span id="cb269-106"><a href="#cb269-106" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(moving_window_all_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           ID        Window_Start      Amp Acrophase_Rad Acrophase_Raw
cos_part  102 2024-03-11 09:07:00 6.879407    -1.7614604     -6.728283
cos_part1 102 2024-03-12 09:07:00 6.954755    -1.5105129     -5.769734
cos_part2 102 2024-03-13 09:07:00 6.442515    -1.5192387     -5.803064
cos_part3 102 2024-03-14 09:07:00 7.488937    -0.8934785     -3.412837
cos_part4 102 2024-03-15 09:07:00 7.955284    -1.1222525     -4.286689
cos_part5 102 2024-03-16 09:07:00 9.245462    -0.9536299     -3.642598
          Acrophase_Raw_Hours Max_Time_Hours Min_Time_Hours Intercept
cos_part             17.27172       17.27172       5.271717  96.63079
cos_part1            18.23027       18.23027       6.230266  96.61262
cos_part2            18.19694       18.19694       6.196936  95.66533
cos_part3            20.58716       20.58716       8.587163  95.79960
cos_part4            19.71331       19.71331       7.713311  99.80324
cos_part5            20.35740       20.35740       8.357402 102.33565</code></pre>
</div>
</div>
<p><strong>Description:</strong> Moving window with lm() and daylight saving time</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb271"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Leere Liste für alle IDs</span></span>
<span id="cb271-2"><a href="#cb271-2" aria-hidden="true" tabindex="-1"></a>all_results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb271-3"><a href="#cb271-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-4"><a href="#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alle IDs extrahieren</span></span>
<span id="cb271-5"><a href="#cb271-5" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(glucose_fit_data<span class="sc">$</span>ID)</span>
<span id="cb271-6"><a href="#cb271-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-7"><a href="#cb271-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fenster-Parameter</span></span>
<span id="cb271-8"><a href="#cb271-8" aria-hidden="true" tabindex="-1"></a>window_length <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">3</span>)</span>
<span id="cb271-9"><a href="#cb271-9" aria-hidden="true" tabindex="-1"></a>step_size <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb271-10"><a href="#cb271-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-11"><a href="#cb271-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Schleife über alle IDs</span></span>
<span id="cb271-12"><a href="#cb271-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> ids) {</span>
<span id="cb271-13"><a href="#cb271-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-14"><a href="#cb271-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Daten für aktuelle ID</span></span>
<span id="cb271-15"><a href="#cb271-15" aria-hidden="true" tabindex="-1"></a>  glucose_id_data <span class="ot">&lt;-</span> glucose_fit_data <span class="sc">%&gt;%</span></span>
<span id="cb271-16"><a href="#cb271-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb271-17"><a href="#cb271-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-18"><a href="#cb271-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prüfe, ob genug Daten da sind</span></span>
<span id="cb271-19"><a href="#cb271-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(glucose_id_data) <span class="sc">&lt;</span> <span class="dv">400</span>) <span class="cf">next</span></span>
<span id="cb271-20"><a href="#cb271-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-21"><a href="#cb271-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Zeitgrenzent</span></span>
<span id="cb271-22"><a href="#cb271-22" aria-hidden="true" tabindex="-1"></a>  start_time <span class="ot">&lt;-</span> <span class="fu">min</span>(glucose_id_data<span class="sc">$</span>datetime,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb271-23"><a href="#cb271-23" aria-hidden="true" tabindex="-1"></a>  end_time   <span class="ot">&lt;-</span> <span class="fu">max</span>(glucose_id_data<span class="sc">$</span>datetime,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb271-24"><a href="#cb271-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-25"><a href="#cb271-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Starte Sliding Window</span></span>
<span id="cb271-26"><a href="#cb271-26" aria-hidden="true" tabindex="-1"></a>  current_start <span class="ot">&lt;-</span> start_time</span>
<span id="cb271-27"><a href="#cb271-27" aria-hidden="true" tabindex="-1"></a>  id_results <span class="ot">&lt;-</span> <span class="fu">list</span>()  <span class="co"># save per ID</span></span>
<span id="cb271-28"><a href="#cb271-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-29"><a href="#cb271-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (current_start <span class="sc">+</span> window_length <span class="sc">&lt;=</span> end_time) {</span>
<span id="cb271-30"><a href="#cb271-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-31"><a href="#cb271-31" aria-hidden="true" tabindex="-1"></a>    current_end <span class="ot">&lt;-</span> current_start <span class="sc">+</span> window_length</span>
<span id="cb271-32"><a href="#cb271-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-33"><a href="#cb271-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Daten im Fenster</span></span>
<span id="cb271-34"><a href="#cb271-34" aria-hidden="true" tabindex="-1"></a>    window_data <span class="ot">&lt;-</span> glucose_id_data <span class="sc">%&gt;%</span></span>
<span id="cb271-35"><a href="#cb271-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(datetime <span class="sc">&gt;=</span> current_start <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> current_end)</span>
<span id="cb271-36"><a href="#cb271-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-37"><a href="#cb271-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Skip bei zu wenigen Datenpunkten</span></span>
<span id="cb271-38"><a href="#cb271-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(window_data) <span class="sc">&lt;</span> <span class="dv">400</span>) {</span>
<span id="cb271-39"><a href="#cb271-39" aria-hidden="true" tabindex="-1"></a>      current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb271-40"><a href="#cb271-40" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb271-41"><a href="#cb271-41" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb271-42"><a href="#cb271-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-43"><a href="#cb271-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate cosine components</span></span>
<span id="cb271-44"><a href="#cb271-44" aria-hidden="true" tabindex="-1"></a>    dec_time <span class="ot">&lt;-</span> window_data<span class="sc">$</span>dec.time</span>
<span id="cb271-45"><a href="#cb271-45" aria-hidden="true" tabindex="-1"></a>    window_data<span class="sc">$</span>cos_part <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb271-46"><a href="#cb271-46" aria-hidden="true" tabindex="-1"></a>    window_data<span class="sc">$</span>sin_part <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> dec_time <span class="sc">/</span> <span class="dv">24</span>)</span>
<span id="cb271-47"><a href="#cb271-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-48"><a href="#cb271-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cosinor-Fit</span></span>
<span id="cb271-49"><a href="#cb271-49" aria-hidden="true" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({</span>
<span id="cb271-50"><a href="#cb271-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lm</span>(<span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span> <span class="sc">~</span> cos_part <span class="sc">+</span> sin_part, <span class="at">data =</span> window_data)</span>
<span id="cb271-51"><a href="#cb271-51" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb271-52"><a href="#cb271-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-53"><a href="#cb271-53" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Falls Fit nicht funktioniert</span></span>
<span id="cb271-54"><a href="#cb271-54" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(fit, <span class="st">"lm"</span>)) {</span>
<span id="cb271-55"><a href="#cb271-55" aria-hidden="true" tabindex="-1"></a>      current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb271-56"><a href="#cb271-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb271-57"><a href="#cb271-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb271-58"><a href="#cb271-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-59"><a href="#cb271-59" aria-hidden="true" tabindex="-1"></a>    coefs <span class="ot">&lt;-</span> <span class="fu">coef</span>(fit)</span>
<span id="cb271-60"><a href="#cb271-60" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-61"><a href="#cb271-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Falls NA in Koeffizienten</span></span>
<span id="cb271-62"><a href="#cb271-62" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">is.na</span>(coefs[<span class="fu">c</span>(<span class="st">"(Intercept)"</span>, <span class="st">"cos_part"</span>, <span class="st">"sin_part"</span>)]))) {</span>
<span id="cb271-63"><a href="#cb271-63" aria-hidden="true" tabindex="-1"></a>      current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb271-64"><a href="#cb271-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">next</span></span>
<span id="cb271-65"><a href="#cb271-65" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb271-66"><a href="#cb271-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-67"><a href="#cb271-67" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extrahiere Parameter</span></span>
<span id="cb271-68"><a href="#cb271-68" aria-hidden="true" tabindex="-1"></a>    intercept <span class="ot">&lt;-</span> coefs[<span class="st">"(Intercept)"</span>]</span>
<span id="cb271-69"><a href="#cb271-69" aria-hidden="true" tabindex="-1"></a>    beta      <span class="ot">&lt;-</span> coefs[<span class="st">"cos_part"</span>]</span>
<span id="cb271-70"><a href="#cb271-70" aria-hidden="true" tabindex="-1"></a>    gamma     <span class="ot">&lt;-</span> coefs[<span class="st">"sin_part"</span>]</span>
<span id="cb271-71"><a href="#cb271-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-72"><a href="#cb271-72" aria-hidden="true" tabindex="-1"></a>    amp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(beta<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> gamma<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb271-73"><a href="#cb271-73" aria-hidden="true" tabindex="-1"></a>    acr_rad <span class="ot">&lt;-</span> <span class="fu">atan2</span>(gamma, beta)</span>
<span id="cb271-74"><a href="#cb271-74" aria-hidden="true" tabindex="-1"></a>    acrophase_raw <span class="ot">&lt;-</span> (acr_rad <span class="sc">*</span> <span class="dv">24</span>) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb271-75"><a href="#cb271-75" aria-hidden="true" tabindex="-1"></a>    acrophase_norm <span class="ot">&lt;-</span> (acrophase_raw <span class="sc">+</span> <span class="dv">24</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb271-76"><a href="#cb271-76" aria-hidden="true" tabindex="-1"></a>    max_time <span class="ot">&lt;-</span> acrophase_norm</span>
<span id="cb271-77"><a href="#cb271-77" aria-hidden="true" tabindex="-1"></a>    min_time <span class="ot">&lt;-</span> (acrophase_norm <span class="sc">+</span> <span class="dv">12</span>) <span class="sc">%%</span> <span class="dv">24</span></span>
<span id="cb271-78"><a href="#cb271-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-79"><a href="#cb271-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ergebnisse speichern</span></span>
<span id="cb271-80"><a href="#cb271-80" aria-hidden="true" tabindex="-1"></a>    id_results[[<span class="fu">length</span>(id_results) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb271-81"><a href="#cb271-81" aria-hidden="true" tabindex="-1"></a>      <span class="at">ID =</span> id,</span>
<span id="cb271-82"><a href="#cb271-82" aria-hidden="true" tabindex="-1"></a>      <span class="at">Window_Start =</span> current_start,</span>
<span id="cb271-83"><a href="#cb271-83" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp =</span> amp,</span>
<span id="cb271-84"><a href="#cb271-84" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Rad =</span> acr_rad,</span>
<span id="cb271-85"><a href="#cb271-85" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw =</span> acrophase_raw,</span>
<span id="cb271-86"><a href="#cb271-86" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_Raw_Hours =</span> acrophase_norm,</span>
<span id="cb271-87"><a href="#cb271-87" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max_Time_Hours =</span> max_time,</span>
<span id="cb271-88"><a href="#cb271-88" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min_Time_Hours =</span> min_time,</span>
<span id="cb271-89"><a href="#cb271-89" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept =</span> intercept</span>
<span id="cb271-90"><a href="#cb271-90" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb271-91"><a href="#cb271-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb271-92"><a href="#cb271-92" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Nächstes Fenster</span></span>
<span id="cb271-93"><a href="#cb271-93" aria-hidden="true" tabindex="-1"></a>    current_start <span class="ot">&lt;-</span> current_start <span class="sc">+</span> step_size</span>
<span id="cb271-94"><a href="#cb271-94" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb271-95"><a href="#cb271-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb271-96"><a href="#cb271-96" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ergebnisse der aktuellen ID speichern</span></span>
<span id="cb271-97"><a href="#cb271-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(id_results) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb271-98"><a href="#cb271-98" aria-hidden="true" tabindex="-1"></a>    all_results[[<span class="fu">length</span>(all_results) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, id_results)</span>
<span id="cb271-99"><a href="#cb271-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb271-100"><a href="#cb271-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb271-101"><a href="#cb271-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-102"><a href="#cb271-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Kombiniere alle Ergebnisse in ein DataFrame</span></span>
<span id="cb271-103"><a href="#cb271-103" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids_dst <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, all_results)</span>
<span id="cb271-104"><a href="#cb271-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-105"><a href="#cb271-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional: Ergebnisse ansehen</span></span>
<span id="cb271-106"><a href="#cb271-106" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(moving_window_all_ids_dst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           ID        Window_Start      Amp Acrophase_Rad Acrophase_Raw
cos_part  102 2024-03-11 09:07:00 6.879407    -1.7614604     -6.728283
cos_part1 102 2024-03-12 09:07:00 6.954755    -1.5105129     -5.769734
cos_part2 102 2024-03-13 09:07:00 6.442515    -1.5192387     -5.803064
cos_part3 102 2024-03-14 09:07:00 7.488937    -0.8934785     -3.412837
cos_part4 102 2024-03-15 09:07:00 7.955284    -1.1222525     -4.286689
cos_part5 102 2024-03-16 09:07:00 9.245462    -0.9536299     -3.642598
          Acrophase_Raw_Hours Max_Time_Hours Min_Time_Hours Intercept
cos_part             17.27172       17.27172       5.271717  96.63079
cos_part1            18.23027       18.23027       6.230266  96.61262
cos_part2            18.19694       18.19694       6.196936  95.66533
cos_part3            20.58716       20.58716       8.587163  95.79960
cos_part4            19.71331       19.71331       7.713311  99.80324
cos_part5            20.35740       20.35740       8.357402 102.33565</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="seasonal-analysis" class="level2">
<h2 class="anchored" data-anchor-id="seasonal-analysis">Seasonal Analysis</h2>
<p><strong>Description:</strong> Define Seasons</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb273"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1" aria-hidden="true" tabindex="-1"></a>seasons <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb273-2"><a href="#cb273-2" aria-hidden="true" tabindex="-1"></a>    m <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">format</span>(date, <span class="st">"%m"</span>))</span>
<span id="cb273-3"><a href="#cb273-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)) {</span>
<span id="cb273-4"><a href="#cb273-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">"Autumn"</span>)</span>
<span id="cb273-5"><a href="#cb273-5" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)) {</span>
<span id="cb273-6"><a href="#cb273-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">"Spring"</span>)</span>
<span id="cb273-7"><a href="#cb273-7" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>)) {</span>
<span id="cb273-8"><a href="#cb273-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">"Summer"</span>)</span>
<span id="cb273-9"><a href="#cb273-9" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb273-10"><a href="#cb273-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="st">"Winter"</span>)</span>
<span id="cb273-11"><a href="#cb273-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb273-12"><a href="#cb273-12" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Add Seasons to Moving Window Data Frame</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb274"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb274-2"><a href="#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Season =</span> <span class="fu">sapply</span>(Window_Start, seasons))</span>
<span id="cb274-3"><a href="#cb274-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-4"><a href="#cb274-4" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids_dst <span class="ot">&lt;-</span> moving_window_all_ids_dst <span class="sc">%&gt;%</span></span>
<span id="cb274-5"><a href="#cb274-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Season =</span> <span class="fu">sapply</span>(Window_Start, seasons))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="acrophase-linear-mixed-effects-model-standard-time" class="level4">
<h4 class="anchored" data-anchor-id="acrophase-linear-mixed-effects-model-standard-time">Acrophase: Linear Mixed Effects Model Standard Time</h4>
<p><strong>Description:</strong> Install and Load Packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb275"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"lme4"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb275-2"><a href="#cb275-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"lme4"</span>)</span>
<span id="cb275-3"><a href="#cb275-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb275-4"><a href="#cb275-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"lmerTest"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb275-5"><a href="#cb275-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"lmerTest"</span>)</span>
<span id="cb275-6"><a href="#cb275-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb275-7"><a href="#cb275-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(lme4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="sourceCode cell-code" id="cb279"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(lmerTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lmerTest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:lme4':

    lmer</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stats':

    step</code></pre>
</div>
</div>
<p><strong>Description:</strong> Apply Linear Mixed Effects Model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb283"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set winter as reference level</span></span>
<span id="cb283-2"><a href="#cb283-2" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids<span class="sc">$</span>Season <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(moving_window_all_ids<span class="sc">$</span>Season), <span class="at">ref =</span> <span class="st">"Winter"</span>)</span>
<span id="cb283-3"><a href="#cb283-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb283-4"><a href="#cb283-4" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids_dst<span class="sc">$</span>Season <span class="ot">&lt;-</span> <span class="fu">relevel</span>(<span class="fu">factor</span>(moving_window_all_ids_dst<span class="sc">$</span>Season), <span class="at">ref =</span> <span class="st">"Winter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb284"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb284-2"><a href="#cb284-2" aria-hidden="true" tabindex="-1"></a>model_acr_season <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Acrophase_Raw_Hours <span class="sc">~</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data =</span> moving_window_all_ids)</span>
<span id="cb284-3"><a href="#cb284-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-4"><a href="#cb284-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show results</span></span>
<span id="cb284-5"><a href="#cb284-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_acr_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Acrophase_Raw_Hours ~ Season + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 6981.1

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.5754 -0.2753  0.0968  0.5331  1.8986 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept)  1.543   1.242   
 Residual             16.051   4.006   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
              Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)    16.6328     0.5681    6.0897  29.281 8.74e-08 ***
SeasonAutumn    0.5359     0.3450 1232.8726   1.553    0.121    
SeasonSpring    1.2480     0.3108 1232.2973   4.015 6.30e-05 ***
SeasonSummer   -0.0284     0.3397 1236.6373  -0.084    0.933    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) SsnAtm SsnSpr
SeasonAutmn -0.271              
SeasonSprng -0.341  0.492       
SeasonSummr -0.293  0.459  0.519</code></pre>
</div>
<div class="sourceCode cell-code" id="cb286"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(moving_window_all_ids, <span class="fu">aes</span>(<span class="at">x =</span> Season, <span class="at">y =</span> Acrophase_Raw_Hours)) <span class="sc">+</span></span>
<span id="cb286-2"><a href="#cb286-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb286-3"><a href="#cb286-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb286-4"><a href="#cb286-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Acrophase by Season"</span>,</span>
<span id="cb286-5"><a href="#cb286-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Season"</span>,</span>
<span id="cb286-6"><a href="#cb286-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"Acrophase"</span>) <span class="sc">+</span></span>
<span id="cb286-7"><a href="#cb286-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-116-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot with adjusted data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb287"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"emmeans"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb287-2"><a href="#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"emmeans"</span>)</span>
<span id="cb287-3"><a href="#cb287-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb287-4"><a href="#cb287-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-5"><a href="#cb287-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Welcome to emmeans.
Caution: You lose important information if you filter this package's results.
See '? untidy'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb289"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get estimated marginal means (adjusted for ID random effect)</span></span>
<span id="cb289-2"><a href="#cb289-2" aria-hidden="true" tabindex="-1"></a>emm_acr <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model_acr_season, <span class="sc">~</span> Season)</span>
<span id="cb289-3"><a href="#cb289-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-4"><a href="#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb289-5"><a href="#cb289-5" aria-hidden="true" tabindex="-1"></a>emm_acr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(emm_acr)</span>
<span id="cb289-6"><a href="#cb289-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb289-7"><a href="#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot adjusted means with 95% CI</span></span>
<span id="cb289-8"><a href="#cb289-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emm_acr, <span class="fu">aes</span>(<span class="at">x =</span> Season, <span class="at">y =</span> emmean)) <span class="sc">+</span></span>
<span id="cb289-9"><a href="#cb289-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb289-10"><a href="#cb289-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, df),</span>
<span id="cb289-11"><a href="#cb289-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> emmean <span class="sc">+</span> SE <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, df)),</span>
<span id="cb289-12"><a href="#cb289-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb289-13"><a href="#cb289-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb289-14"><a href="#cb289-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model-adjusted Acrophase by Season"</span>,</span>
<span id="cb289-15"><a href="#cb289-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Season"</span>,</span>
<span id="cb289-16"><a href="#cb289-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Adjusted Acrophase (in hours)"</span>) <span class="sc">+</span></span>
<span id="cb289-17"><a href="#cb289-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-117-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="amplitude-linear-mixed-effects-model-standard-time" class="level4">
<h4 class="anchored" data-anchor-id="amplitude-linear-mixed-effects-model-standard-time">Amplitude: Linear Mixed Effects Model Standard Time</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb290"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" aria-hidden="true" tabindex="-1"></a>model_amp_season <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Amp <span class="sc">~</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data =</span> moving_window_all_ids)</span>
<span id="cb290-2"><a href="#cb290-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_amp_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Amp ~ Season + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 6074.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.8829 -0.6489 -0.0410  0.6076  6.9206 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 8.432    2.904   
 Residual             7.638    2.764   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
               Estimate Std. Error         df t value Pr(&gt;|t|)    
(Intercept)     8.87309    1.19899    5.08854   7.400 0.000657 ***
SeasonAutumn   -0.08290    0.23805 1232.05170  -0.348 0.727712    
SeasonSpring   -0.48975    0.21527 1233.96090  -2.275 0.023074 *  
SeasonSummer   -0.03774    0.23467 1232.58267  -0.161 0.872261    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) SsnAtm SsnSpr
SeasonAutmn -0.088              
SeasonSprng -0.113  0.490       
SeasonSummr -0.096  0.459  0.517</code></pre>
</div>
<div class="sourceCode cell-code" id="cb292"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Amplitude Boxplot</span></span>
<span id="cb292-2"><a href="#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_all_ids, <span class="fu">aes</span>(<span class="at">x =</span> Season, <span class="at">y =</span> Amp)) <span class="sc">+</span></span>
<span id="cb292-3"><a href="#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb292-4"><a href="#cb292-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb292-5"><a href="#cb292-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Amplitude by Season"</span>,</span>
<span id="cb292-6"><a href="#cb292-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Season"</span>,</span>
<span id="cb292-7"><a href="#cb292-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Amplitude"</span>) <span class="sc">+</span></span>
<span id="cb292-8"><a href="#cb292-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-118-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot with adjusted data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb293"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get estimated marginal means (adjusted for ID random effect)</span></span>
<span id="cb293-2"><a href="#cb293-2" aria-hidden="true" tabindex="-1"></a>emm_amp <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model_amp_season, <span class="sc">~</span> Season)</span>
<span id="cb293-3"><a href="#cb293-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-4"><a href="#cb293-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb293-5"><a href="#cb293-5" aria-hidden="true" tabindex="-1"></a>emm_amp <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(emm_amp)</span>
<span id="cb293-6"><a href="#cb293-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-7"><a href="#cb293-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot adjusted means with 95% CI</span></span>
<span id="cb293-8"><a href="#cb293-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb293-9"><a href="#cb293-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emm_amp, <span class="fu">aes</span>(<span class="at">x =</span> Season, <span class="at">y =</span> emmean)) <span class="sc">+</span></span>
<span id="cb293-10"><a href="#cb293-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb293-11"><a href="#cb293-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> emmean <span class="sc">-</span> SE <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, df),</span>
<span id="cb293-12"><a href="#cb293-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> emmean <span class="sc">+</span> SE <span class="sc">*</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, df)),</span>
<span id="cb293-13"><a href="#cb293-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb293-14"><a href="#cb293-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb293-15"><a href="#cb293-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model-adjusted Amplitude by Season"</span>,</span>
<span id="cb293-16"><a href="#cb293-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Season"</span>,</span>
<span id="cb293-17"><a href="#cb293-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Adjusted Amplitude (in mg/dl)"</span>) <span class="sc">+</span></span>
<span id="cb293-18"><a href="#cb293-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-119-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="intercept-linear-mixed-effects-model-standard-time" class="level4">
<h4 class="anchored" data-anchor-id="intercept-linear-mixed-effects-model-standard-time">Intercept: Linear Mixed Effects Model Standard Time</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb294"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" aria-hidden="true" tabindex="-1"></a>model_int_season <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Intercept <span class="sc">~</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data =</span> moving_window_all_ids)</span>
<span id="cb294-2"><a href="#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_int_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Intercept ~ Season + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 8562.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.4562 -0.6196  0.0211  0.7005  2.6998 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 11.29    3.360   
 Residual             57.47    7.581   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
              Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)  9.952e+01  1.456e+00 5.455e+00  68.348 3.26e-09 ***
SeasonAutumn 3.603e+00  6.529e-01 1.232e+03   5.518 4.17e-08 ***
SeasonSpring 5.455e-02  5.894e-01 1.237e+03   0.093    0.926    
SeasonSummer 1.018e+00  6.433e-01 1.235e+03   1.583    0.114    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) SsnAtm SsnSpr
SeasonAutmn -0.200              
SeasonSprng -0.254  0.491       
SeasonSummr -0.216  0.459  0.518</code></pre>
</div>
<div class="sourceCode cell-code" id="cb296"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb296-1"><a href="#cb296-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intercept Boxplot</span></span>
<span id="cb296-2"><a href="#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_all_ids, <span class="fu">aes</span>(<span class="at">x =</span> Season, <span class="at">y =</span> Intercept)) <span class="sc">+</span></span>
<span id="cb296-3"><a href="#cb296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"orange"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb296-4"><a href="#cb296-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb296-5"><a href="#cb296-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Intercept by Season"</span>,</span>
<span id="cb296-6"><a href="#cb296-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Season"</span>,</span>
<span id="cb296-7"><a href="#cb296-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Intercept"</span>) <span class="sc">+</span></span>
<span id="cb296-8"><a href="#cb296-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-120-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Plot with adjusted data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb297"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get estimated marginal means (model-adjusted means)</span></span>
<span id="cb297-2"><a href="#cb297-2" aria-hidden="true" tabindex="-1"></a>emm_int <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(model_int_season, <span class="sc">~</span> Season)</span>
<span id="cb297-3"><a href="#cb297-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-4"><a href="#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to data frame for plotting</span></span>
<span id="cb297-5"><a href="#cb297-5" aria-hidden="true" tabindex="-1"></a>emm_int <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(emm_int)</span>
<span id="cb297-6"><a href="#cb297-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-7"><a href="#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot adjusted means with 95% CI</span></span>
<span id="cb297-8"><a href="#cb297-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(emm_int, <span class="fu">aes</span>(<span class="at">x =</span> Season, <span class="at">y =</span> emmean)) <span class="sc">+</span></span>
<span id="cb297-9"><a href="#cb297-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb297-10"><a href="#cb297-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower.CL, <span class="at">ymax =</span> upper.CL), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="st">"darkred"</span>) <span class="sc">+</span></span>
<span id="cb297-11"><a href="#cb297-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb297-12"><a href="#cb297-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb297-13"><a href="#cb297-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Model-adjusted Intercept by Season"</span>,</span>
<span id="cb297-14"><a href="#cb297-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Season"</span>,</span>
<span id="cb297-15"><a href="#cb297-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Adjusted Intercept (in mg/dl)"</span></span>
<span id="cb297-16"><a href="#cb297-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb297-17"><a href="#cb297-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-121-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="acrophase-linear-mixed-effects-model-daylight-saving-time" class="level4">
<h4 class="anchored" data-anchor-id="acrophase-linear-mixed-effects-model-daylight-saving-time">Acrophase: Linear Mixed Effects Model Daylight Saving Time</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb298"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb298-1"><a href="#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb298-2"><a href="#cb298-2" aria-hidden="true" tabindex="-1"></a>model_acr_season_dst <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Acrophase_Raw_Hours <span class="sc">~</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data =</span> moving_window_all_ids_dst)</span>
<span id="cb298-3"><a href="#cb298-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-4"><a href="#cb298-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Show results</span></span>
<span id="cb298-5"><a href="#cb298-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_acr_season_dst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Acrophase_Raw_Hours ~ Season + (1 | ID)
   Data: moving_window_all_ids_dst

REML criterion at convergence: 7170.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.6068 -0.1900  0.1173  0.5067  1.7005 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept)  1.498   1.224   
 Residual             18.628   4.316   
Number of obs: 1242, groups:  ID, 6

Fixed effects:
              Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)    16.8381     0.5703    6.8333  29.525 1.84e-08 ***
SeasonAutumn    1.0152     0.3713 1234.4265   2.734  0.00635 ** 
SeasonSpring    1.4410     0.3346 1230.9628   4.306 1.79e-05 ***
SeasonSummer    0.4640     0.3659 1237.9278   1.268  0.20499    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) SsnAtm SsnSpr
SeasonAutmn -0.291              
SeasonSprng -0.364  0.493       
SeasonSummr -0.314  0.460  0.519</code></pre>
</div>
</div>
</section>
<section id="amplitude-linear-mixed-effects-model-daylight-saving-time" class="level4">
<h4 class="anchored" data-anchor-id="amplitude-linear-mixed-effects-model-daylight-saving-time">Amplitude: Linear Mixed Effects Model Daylight Saving Time</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb300"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb300-1"><a href="#cb300-1" aria-hidden="true" tabindex="-1"></a>model_amp_season_dst <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Amp <span class="sc">~</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data =</span> moving_window_all_ids_dst)</span>
<span id="cb300-2"><a href="#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_amp_season_dst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Amp ~ Season + (1 | ID)
   Data: moving_window_all_ids_dst

REML criterion at convergence: 6076.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.0147 -0.6462 -0.0313  0.6080  6.6142 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 8.403    2.899   
 Residual             7.620    2.760   
Number of obs: 1242, groups:  ID, 6

Fixed effects:
               Estimate Std. Error         df t value Pr(&gt;|t|)    
(Intercept)     8.85837    1.19693    5.08867   7.401 0.000657 ***
SeasonAutumn   -0.06181    0.23755 1233.05635  -0.260 0.794743    
SeasonSpring   -0.46808    0.21500 1234.96251  -2.177 0.029662 *  
SeasonSummer   -0.02052    0.23438 1233.58252  -0.088 0.930264    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) SsnAtm SsnSpr
SeasonAutmn -0.089              
SeasonSprng -0.113  0.491       
SeasonSummr -0.096  0.460  0.517</code></pre>
</div>
</div>
</section>
<section id="intercept-linear-mixed-effects-model-daylight-saving-time" class="level4">
<h4 class="anchored" data-anchor-id="intercept-linear-mixed-effects-model-daylight-saving-time">Intercept: Linear Mixed Effects Model Daylight Saving Time</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb302"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" aria-hidden="true" tabindex="-1"></a>model_int_season <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Intercept <span class="sc">~</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID), <span class="at">data =</span> moving_window_all_ids)</span>
<span id="cb302-2"><a href="#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_int_season)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Intercept ~ Season + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 8562.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.4562 -0.6196  0.0211  0.7005  2.6998 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 11.29    3.360   
 Residual             57.47    7.581   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
              Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)  9.952e+01  1.456e+00 5.455e+00  68.348 3.26e-09 ***
SeasonAutumn 3.603e+00  6.529e-01 1.232e+03   5.518 4.17e-08 ***
SeasonSpring 5.455e-02  5.894e-01 1.237e+03   0.093    0.926    
SeasonSummer 1.018e+00  6.433e-01 1.235e+03   1.583    0.114    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr) SsnAtm SsnSpr
SeasonAutmn -0.200              
SeasonSprng -0.254  0.491       
SeasonSummr -0.216  0.459  0.518</code></pre>
</div>
</div>
</section>
<section id="polar-plots" class="level3">
<h3 class="anchored" data-anchor-id="polar-plots">Polar Plots</h3>
<section id="polar-plot-for-acrophase-for-all-ids" class="level4">
<h4 class="anchored" data-anchor-id="polar-plot-for-acrophase-for-all-ids">Polar Plot for Acrophase for all IDs</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb304"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" aria-hidden="true" tabindex="-1"></a> id_list <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">102</span>, <span class="dv">104</span>, <span class="dv">107</span>, <span class="dv">108</span>, <span class="dv">109</span>, <span class="dv">112</span>)</span>
<span id="cb304-2"><a href="#cb304-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-3"><a href="#cb304-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Max_Rad</span></span>
<span id="cb304-4"><a href="#cb304-4" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb304-5"><a href="#cb304-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Max_Rad =</span> (Max_Time_Hours <span class="sc">/</span> <span class="dv">24</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb304-6"><a href="#cb304-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-7"><a href="#cb304-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize Data Frames for Pointer and SD-Rectangles</span></span>
<span id="cb304-8"><a href="#cb304-8" aria-hidden="true" tabindex="-1"></a>all_pointers <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb304-9"><a href="#cb304-9" aria-hidden="true" tabindex="-1"></a>all_rects <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb304-10"><a href="#cb304-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-11"><a href="#cb304-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop for all IDs</span></span>
<span id="cb304-12"><a href="#cb304-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> id_list) {</span>
<span id="cb304-13"><a href="#cb304-13" aria-hidden="true" tabindex="-1"></a>  df_id <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb304-14"><a href="#cb304-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-15"><a href="#cb304-15" aria-hidden="true" tabindex="-1"></a>  avg_max <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_id<span class="sc">$</span>Max_Rad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb304-16"><a href="#cb304-16" aria-hidden="true" tabindex="-1"></a>  sd_max <span class="ot">&lt;-</span> <span class="fu">sd</span>(df_id<span class="sc">$</span>Max_Rad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb304-17"><a href="#cb304-17" aria-hidden="true" tabindex="-1"></a>  n_points <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(df_id<span class="sc">$</span>Max_Rad))  <span class="co"># sample size</span></span>
<span id="cb304-18"><a href="#cb304-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-19"><a href="#cb304-19" aria-hidden="true" tabindex="-1"></a>  rect_ymin <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fl">0.05</span> <span class="sc">*</span> (<span class="fu">which</span>(id_list <span class="sc">==</span> id))  </span>
<span id="cb304-20"><a href="#cb304-20" aria-hidden="true" tabindex="-1"></a>  rect_ymax <span class="ot">&lt;-</span> rect_ymin <span class="sc">+</span> <span class="fl">0.05</span></span>
<span id="cb304-21"><a href="#cb304-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-22"><a href="#cb304-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Label with n</span></span>
<span id="cb304-23"><a href="#cb304-23" aria-hidden="true" tabindex="-1"></a>  label_with_n <span class="ot">&lt;-</span> <span class="fu">paste0</span>(id, <span class="st">" (n = "</span>, n_points, <span class="st">")"</span>)</span>
<span id="cb304-24"><a href="#cb304-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-25"><a href="#cb304-25" aria-hidden="true" tabindex="-1"></a>  all_pointers <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_pointers, <span class="fu">data.frame</span>(</span>
<span id="cb304-26"><a href="#cb304-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> avg_max,</span>
<span id="cb304-27"><a href="#cb304-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> label_with_n</span>
<span id="cb304-28"><a href="#cb304-28" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb304-29"><a href="#cb304-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-30"><a href="#cb304-30" aria-hidden="true" tabindex="-1"></a>  all_rects <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_rects, <span class="fu">data.frame</span>(</span>
<span id="cb304-31"><a href="#cb304-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> avg_max <span class="sc">-</span> sd_max,</span>
<span id="cb304-32"><a href="#cb304-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> avg_max <span class="sc">+</span> sd_max,</span>
<span id="cb304-33"><a href="#cb304-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymin =</span> rect_ymin,</span>
<span id="cb304-34"><a href="#cb304-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">ymax =</span> rect_ymax,</span>
<span id="cb304-35"><a href="#cb304-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> label_with_n</span>
<span id="cb304-36"><a href="#cb304-36" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb304-37"><a href="#cb304-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb304-38"><a href="#cb304-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb304-39"><a href="#cb304-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb304-40"><a href="#cb304-40" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb304-41"><a href="#cb304-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> all_rects,</span>
<span id="cb304-42"><a href="#cb304-42" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> xmin, <span class="at">xmax =</span> xmax, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax, <span class="at">fill =</span> ID),</span>
<span id="cb304-43"><a href="#cb304-43" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb304-44"><a href="#cb304-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> all_pointers,</span>
<span id="cb304-45"><a href="#cb304-45" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> angle, <span class="at">xend =</span> angle, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>, <span class="at">color =</span> ID),</span>
<span id="cb304-46"><a href="#cb304-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb304-47"><a href="#cb304-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb304-48"><a href="#cb304-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb304-49"><a href="#cb304-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">23</span><span class="sc">/</span><span class="dv">24</span>, <span class="at">length.out =</span> <span class="dv">24</span>),</span>
<span id="cb304-50"><a href="#cb304-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">23</span>,</span>
<span id="cb304-51"><a href="#cb304-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">+</span></span>
<span id="cb304-52"><a href="#cb304-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb304-53"><a href="#cb304-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb304-54"><a href="#cb304-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Acrophase + SD for all IDs"</span>,</span>
<span id="cb304-55"><a href="#cb304-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb304-56"><a href="#cb304-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb304-57"><a href="#cb304-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"ID"</span>,</span>
<span id="cb304-58"><a href="#cb304-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"ID"</span></span>
<span id="cb304-59"><a href="#cb304-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb304-60"><a href="#cb304-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb304-61"><a href="#cb304-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb304-62"><a href="#cb304-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb304-63"><a href="#cb304-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb304-64"><a href="#cb304-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb304-65"><a href="#cb304-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb304-66"><a href="#cb304-66" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-125-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Numbers of the plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb305"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table for summary values</span></span>
<span id="cb305-2"><a href="#cb305-2" aria-hidden="true" tabindex="-1"></a>all_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb305-3"><a href="#cb305-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-4"><a href="#cb305-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> id_list) {</span>
<span id="cb305-5"><a href="#cb305-5" aria-hidden="true" tabindex="-1"></a>  df_id <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ID <span class="sc">==</span> id)</span>
<span id="cb305-6"><a href="#cb305-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb305-7"><a href="#cb305-7" aria-hidden="true" tabindex="-1"></a>  avg_max <span class="ot">&lt;-</span> <span class="fu">mean</span>(df_id<span class="sc">$</span>Max_Rad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb305-8"><a href="#cb305-8" aria-hidden="true" tabindex="-1"></a>  sd_max <span class="ot">&lt;-</span> <span class="fu">sd</span>(df_id<span class="sc">$</span>Max_Rad, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb305-9"><a href="#cb305-9" aria-hidden="true" tabindex="-1"></a>  n_points <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(df_id<span class="sc">$</span>Max_Rad))  <span class="co"># sample size</span></span>
<span id="cb305-10"><a href="#cb305-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb305-11"><a href="#cb305-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert from radians -&gt; hours</span></span>
<span id="cb305-12"><a href="#cb305-12" aria-hidden="true" tabindex="-1"></a>  avg_hour <span class="ot">&lt;-</span> (avg_max <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">*</span> <span class="dv">24</span></span>
<span id="cb305-13"><a href="#cb305-13" aria-hidden="true" tabindex="-1"></a>  sd_hour  <span class="ot">&lt;-</span> (sd_max <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">*</span> <span class="dv">24</span></span>
<span id="cb305-14"><a href="#cb305-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb305-15"><a href="#cb305-15" aria-hidden="true" tabindex="-1"></a>  all_summary <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(all_summary, <span class="fu">data.frame</span>(</span>
<span id="cb305-16"><a href="#cb305-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> id,</span>
<span id="cb305-17"><a href="#cb305-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> n_points,</span>
<span id="cb305-18"><a href="#cb305-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">Avg_Rad =</span> avg_max,</span>
<span id="cb305-19"><a href="#cb305-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD_Rad =</span> sd_max,</span>
<span id="cb305-20"><a href="#cb305-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Avg_Hour =</span> avg_hour,</span>
<span id="cb305-21"><a href="#cb305-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD_Hour =</span> sd_hour</span>
<span id="cb305-22"><a href="#cb305-22" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb305-23"><a href="#cb305-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb305-24"><a href="#cb305-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb305-25"><a href="#cb305-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the summary table</span></span>
<span id="cb305-26"><a href="#cb305-26" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(all_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID   n  Avg_Rad    SD_Rad Avg_Hour  SD_Hour
1 102 277 4.273255 0.6884703 16.32263 2.629763
2 104 319 4.468490 1.3352613 17.06837 5.100322
3 107 194 4.990075 0.8389587 19.06068 3.204586
4 108  39 4.170352 0.2719528 15.92957 1.038783
5 109 160 4.683758 0.3427760 17.89064 1.309308
6 112 252 4.421759 1.4481950 16.88987 5.531698</code></pre>
</div>
</div>
</section>
<section id="polar-plot-of-all-ids-with-seasons" class="level4">
<h4 class="anchored" data-anchor-id="polar-plot-of-all-ids-with-seasons">Polar Plot of all IDs with Seasons</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb307"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Feste Reihenfolge der IDs für Farben &amp; vertikale Platzierung ---</span></span>
<span id="cb307-2"><a href="#cb307-2" aria-hidden="true" tabindex="-1"></a>id_list <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(moving_window_all_ids<span class="sc">$</span>ID))</span>
<span id="cb307-3"><a href="#cb307-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-4"><a href="#cb307-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Zusammenfassung: Durchschnitt &amp; SD des Maxima pro Season &amp; ID ---</span></span>
<span id="cb307-5"><a href="#cb307-5" aria-hidden="true" tabindex="-1"></a>season_summary <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb307-6"><a href="#cb307-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Season) <span class="sc">%&gt;%</span></span>
<span id="cb307-7"><a href="#cb307-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb307-8"><a href="#cb307-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_max_rad =</span> <span class="fu">mean</span>((Max_Time_Hours <span class="sc">/</span> <span class="dv">24</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb307-9"><a href="#cb307-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_max_rad =</span> <span class="fu">sd</span>((Max_Time_Hours <span class="sc">/</span> <span class="dv">24</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb307-10"><a href="#cb307-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb307-11"><a href="#cb307-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb307-12"><a href="#cb307-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb307-13"><a href="#cb307-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">angle =</span> avg_max_rad,</span>
<span id="cb307-14"><a href="#cb307-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmin =</span> avg_max_rad <span class="sc">-</span> sd_max_rad,</span>
<span id="cb307-15"><a href="#cb307-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">xmax =</span> avg_max_rad <span class="sc">+</span> sd_max_rad,</span>
<span id="cb307-16"><a href="#cb307-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">ID =</span> <span class="fu">factor</span>(ID, <span class="at">levels =</span> id_list),</span>
<span id="cb307-17"><a href="#cb307-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># dynamische vertikale Positionen, um Überlappung zu vermeiden</span></span>
<span id="cb307-18"><a href="#cb307-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">rect_ymin =</span> <span class="fl">0.95</span> <span class="sc">-</span> <span class="fl">0.05</span> <span class="sc">*</span> (<span class="fu">as.numeric</span>(ID) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb307-19"><a href="#cb307-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">rect_ymax =</span> rect_ymin <span class="sc">+</span> <span class="fl">0.05</span></span>
<span id="cb307-20"><a href="#cb307-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb307-21"><a href="#cb307-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-22"><a href="#cb307-22" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Zeiger-Daten extrahieren ---</span></span>
<span id="cb307-23"><a href="#cb307-23" aria-hidden="true" tabindex="-1"></a>pointers_seasons <span class="ot">&lt;-</span> season_summary <span class="sc">%&gt;%</span></span>
<span id="cb307-24"><a href="#cb307-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Season, angle)</span>
<span id="cb307-25"><a href="#cb307-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-26"><a href="#cb307-26" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Rechteck-Daten extrahieren ---</span></span>
<span id="cb307-27"><a href="#cb307-27" aria-hidden="true" tabindex="-1"></a>rects_seasons <span class="ot">&lt;-</span> season_summary <span class="sc">%&gt;%</span></span>
<span id="cb307-28"><a href="#cb307-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Season, xmin, xmax, rect_ymin, rect_ymax)</span>
<span id="cb307-29"><a href="#cb307-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-30"><a href="#cb307-30" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Plot erstellen ---</span></span>
<span id="cb307-31"><a href="#cb307-31" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb307-32"><a href="#cb307-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> rects_seasons,</span>
<span id="cb307-33"><a href="#cb307-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> xmin, <span class="at">xmax =</span> xmax, <span class="at">ymin =</span> rect_ymin, <span class="at">ymax =</span> rect_ymax, <span class="at">fill =</span> ID),</span>
<span id="cb307-34"><a href="#cb307-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb307-35"><a href="#cb307-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> pointers_seasons,</span>
<span id="cb307-36"><a href="#cb307-36" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> angle, <span class="at">xend =</span> angle, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend =</span> <span class="dv">1</span>, <span class="at">color =</span> ID),</span>
<span id="cb307-37"><a href="#cb307-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb307-38"><a href="#cb307-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">start =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb307-39"><a href="#cb307-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb307-40"><a href="#cb307-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> <span class="dv">23</span><span class="sc">/</span><span class="dv">24</span>, <span class="at">length.out =</span> <span class="dv">24</span>),</span>
<span id="cb307-41"><a href="#cb307-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">23</span>,</span>
<span id="cb307-42"><a href="#cb307-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span> <span class="sc">*</span> pi)</span>
<span id="cb307-43"><a href="#cb307-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb307-44"><a href="#cb307-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.05</span>), <span class="at">labels =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb307-45"><a href="#cb307-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb307-46"><a href="#cb307-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Acrophase + SD per Season"</span>,</span>
<span id="cb307-47"><a href="#cb307-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time of Day"</span>,</span>
<span id="cb307-48"><a href="#cb307-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span>,</span>
<span id="cb307-49"><a href="#cb307-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"ID"</span>,</span>
<span id="cb307-50"><a href="#cb307-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"ID"</span></span>
<span id="cb307-51"><a href="#cb307-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb307-52"><a href="#cb307-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Season) <span class="sc">+</span></span>
<span id="cb307-53"><a href="#cb307-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb307-54"><a href="#cb307-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb307-55"><a href="#cb307-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb307-56"><a href="#cb307-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>),</span>
<span id="cb307-57"><a href="#cb307-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb307-58"><a href="#cb307-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb307-59"><a href="#cb307-59" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_rect()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-127-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Numbers for Plots</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb309"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create summary table for acrophase per Season &amp; ID</span></span>
<span id="cb309-2"><a href="#cb309-2" aria-hidden="true" tabindex="-1"></a>season_table <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb309-3"><a href="#cb309-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID, Season) <span class="sc">%&gt;%</span></span>
<span id="cb309-4"><a href="#cb309-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb309-5"><a href="#cb309-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(Max_Time_Hours)),</span>
<span id="cb309-6"><a href="#cb309-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_max_rad =</span> <span class="fu">mean</span>((Max_Time_Hours <span class="sc">/</span> <span class="dv">24</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb309-7"><a href="#cb309-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_max_rad  =</span> <span class="fu">sd</span>((Max_Time_Hours <span class="sc">/</span> <span class="dv">24</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="sc">*</span> pi, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb309-8"><a href="#cb309-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb309-9"><a href="#cb309-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb309-10"><a href="#cb309-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb309-11"><a href="#cb309-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to hours</span></span>
<span id="cb309-12"><a href="#cb309-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_hour =</span> (avg_max_rad <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">*</span> <span class="dv">24</span>,</span>
<span id="cb309-13"><a href="#cb309-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd_hour  =</span> (sd_max_rad <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> pi)) <span class="sc">*</span> <span class="dv">24</span></span>
<span id="cb309-14"><a href="#cb309-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb309-15"><a href="#cb309-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ID, Season, n, avg_hour, sd_hour)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="photoperiod-analysis" class="level2">
<h2 class="anchored" data-anchor-id="photoperiod-analysis">Photoperiod Analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb310"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"LightLogR"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb310-2"><a href="#cb310-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"LightLogR"</span>)</span>
<span id="cb310-3"><a href="#cb310-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb311"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(LightLogR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Add photoperiod to dataset (standard time)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb312"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">52.52</span>, <span class="fl">13.405</span>)  <span class="co"># coords for Berlin</span></span>
<span id="cb312-2"><a href="#cb312-2" aria-hidden="true" tabindex="-1"></a>tz <span class="ot">&lt;-</span> <span class="st">"CET"</span> <span class="co"># Central Europe Time</span></span>
<span id="cb312-3"><a href="#cb312-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-4"><a href="#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose your dataset is `moving_window_all_ids` with a POSIXct column "Window_Start"</span></span>
<span id="cb312-5"><a href="#cb312-5" aria-hidden="true" tabindex="-1"></a>photoperiod_df <span class="ot">&lt;-</span> <span class="fu">photoperiod</span>(</span>
<span id="cb312-6"><a href="#cb312-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coordinates =</span> coords,</span>
<span id="cb312-7"><a href="#cb312-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dates =</span> <span class="fu">unique</span>(<span class="fu">as.Date</span>(moving_window_all_ids<span class="sc">$</span>Window_Start)),</span>
<span id="cb312-8"><a href="#cb312-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">tz =</span> tz,</span>
<span id="cb312-9"><a href="#cb312-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">solarDep =</span> <span class="dv">0</span>  <span class="co"># solarDep = 0 for true sunrise/sunset</span></span>
<span id="cb312-10"><a href="#cb312-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb312-11"><a href="#cb312-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-12"><a href="#cb312-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Join photoperiod info (dawn, dusk) back to  main dataset</span></span>
<span id="cb312-13"><a href="#cb312-13" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb312-14"><a href="#cb312-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(Window_Start)) <span class="sc">%&gt;%</span></span>
<span id="cb312-15"><a href="#cb312-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(photoperiod_df, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>))</span>
<span id="cb312-16"><a href="#cb312-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-17"><a href="#cb312-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add photoperiod state (day/night) for each timestamp</span></span>
<span id="cb312-18"><a href="#cb312-18" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids <span class="ot">&lt;-</span> <span class="fu">add_photoperiod</span>(</span>
<span id="cb312-19"><a href="#cb312-19" aria-hidden="true" tabindex="-1"></a>  moving_window_all_ids,</span>
<span id="cb312-20"><a href="#cb312-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">coordinates =</span> coords,</span>
<span id="cb312-21"><a href="#cb312-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Datetime.colname =</span> Window_Start,</span>
<span id="cb312-22"><a href="#cb312-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">solarDep =</span> <span class="dv">0</span>,</span>
<span id="cb312-23"><a href="#cb312-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb312-24"><a href="#cb312-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb312-25"><a href="#cb312-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb312-26"><a href="#cb312-26" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb312-27"><a href="#cb312-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">photoperiod_hours =</span> <span class="fu">as.numeric</span>(photoperiod, <span class="at">units =</span> <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Add photoperiod to dataset (daylight saving time)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb313"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb313-1"><a href="#cb313-1" aria-hidden="true" tabindex="-1"></a>photoperiod_df_dst <span class="ot">&lt;-</span> <span class="fu">photoperiod</span>(</span>
<span id="cb313-2"><a href="#cb313-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">coordinates =</span> coords,</span>
<span id="cb313-3"><a href="#cb313-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dates =</span> <span class="fu">unique</span>(<span class="fu">as.Date</span>(moving_window_all_ids_dst<span class="sc">$</span>Window_Start)),</span>
<span id="cb313-4"><a href="#cb313-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tz =</span> tz,</span>
<span id="cb313-5"><a href="#cb313-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">solarDep =</span> <span class="dv">0</span>  <span class="co"># solarDep = 0 for true sunrise/sunset</span></span>
<span id="cb313-6"><a href="#cb313-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb313-7"><a href="#cb313-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-8"><a href="#cb313-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Join photoperiod info (dawn, dusk) back to  main dataset</span></span>
<span id="cb313-9"><a href="#cb313-9" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids_dst <span class="ot">&lt;-</span> moving_window_all_ids_dst <span class="sc">%&gt;%</span></span>
<span id="cb313-10"><a href="#cb313-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(Window_Start)) <span class="sc">%&gt;%</span></span>
<span id="cb313-11"><a href="#cb313-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(photoperiod_df_dst, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"date"</span> <span class="ot">=</span> <span class="st">"date"</span>))</span>
<span id="cb313-12"><a href="#cb313-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-13"><a href="#cb313-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add photoperiod state (day/night) for each timestamp</span></span>
<span id="cb313-14"><a href="#cb313-14" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids_dst <span class="ot">&lt;-</span> <span class="fu">add_photoperiod</span>(</span>
<span id="cb313-15"><a href="#cb313-15" aria-hidden="true" tabindex="-1"></a>  moving_window_all_ids_dst,</span>
<span id="cb313-16"><a href="#cb313-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">coordinates =</span> coords,</span>
<span id="cb313-17"><a href="#cb313-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Datetime.colname =</span> Window_Start,</span>
<span id="cb313-18"><a href="#cb313-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">solarDep =</span> <span class="dv">0</span>,</span>
<span id="cb313-19"><a href="#cb313-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">overwrite =</span> <span class="cn">TRUE</span></span>
<span id="cb313-20"><a href="#cb313-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb313-21"><a href="#cb313-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-22"><a href="#cb313-22" aria-hidden="true" tabindex="-1"></a>moving_window_all_ids_dst <span class="ot">&lt;-</span> moving_window_all_ids_dst <span class="sc">%&gt;%</span></span>
<span id="cb313-23"><a href="#cb313-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">photoperiod_hours =</span> <span class="fu">as.numeric</span>(photoperiod, <span class="at">units =</span> <span class="st">"hours"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="acrophase-linear-mixed-model" class="level3">
<h3 class="anchored" data-anchor-id="acrophase-linear-mixed-model">Acrophase: Linear Mixed Model</h3>
<p><strong>Description:</strong> Linear Mixed Model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb314"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" aria-hidden="true" tabindex="-1"></a>model_photoperiod_acr <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb314-2"><a href="#cb314-2" aria-hidden="true" tabindex="-1"></a>  Acrophase_Raw_Hours <span class="sc">~</span> photoperiod_hours <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb314-3"><a href="#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> moving_window_all_ids</span>
<span id="cb314-4"><a href="#cb314-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb314-5"><a href="#cb314-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-6"><a href="#cb314-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_photoperiod_acr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Acrophase_Raw_Hours ~ photoperiod_hours + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 7005.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.5865 -0.2601  0.0838  0.5164  1.8257 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept)  1.097   1.048   
 Residual             16.324   4.040   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
                   Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)       1.674e+01  6.704e-01 2.168e+01  24.970   &lt;2e-16 ***
photoperiod_hours 3.854e-02  3.875e-02 1.218e+03   0.995     0.32    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr)
photprd_hrs -0.741</code></pre>
</div>
</div>
<p><strong>Description:</strong> Create a Graph</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb316"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb316-1"><a href="#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"ggeffects"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb316-2"><a href="#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"ggeffects"</span>)</span>
<span id="cb316-3"><a href="#cb316-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb316-4"><a href="#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggeffects)</span>
<span id="cb316-5"><a href="#cb316-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-6"><a href="#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions</span></span>
<span id="cb316-7"><a href="#cb316-7" aria-hidden="true" tabindex="-1"></a>pred_phot_acr <span class="ot">&lt;-</span> <span class="fu">ggpredict</span>(model_photoperiod_acr, <span class="at">terms =</span> <span class="st">"photoperiod_hours"</span>)</span>
<span id="cb316-8"><a href="#cb316-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-9"><a href="#cb316-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb316-10"><a href="#cb316-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_all_ids, <span class="fu">aes</span>(<span class="at">x =</span> photoperiod_hours, <span class="at">y =</span> Acrophase_Raw_Hours)) <span class="sc">+</span></span>
<span id="cb316-11"><a href="#cb316-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.4</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb316-12"><a href="#cb316-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_phot_acr, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> predicted), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb316-13"><a href="#cb316-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_phot_acr, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb316-14"><a href="#cb316-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb316-15"><a href="#cb316-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb316-16"><a href="#cb316-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb316-17"><a href="#cb316-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Acrophase vs. Photoperiod (LME fit)"</span>,</span>
<span id="cb316-18"><a href="#cb316-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Photoperiod (hours)"</span>,</span>
<span id="cb316-19"><a href="#cb316-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Acrophase (hours of the day)"</span></span>
<span id="cb316-20"><a href="#cb316-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb316-21"><a href="#cb316-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-134-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Create this graph but with models for every ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb317"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get fitted values for each ID</span></span>
<span id="cb317-2"><a href="#cb317-2" aria-hidden="true" tabindex="-1"></a>id_fits_phot_acr <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb317-3"><a href="#cb317-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb317-4"><a href="#cb317-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>({</span>
<span id="cb317-5"><a href="#cb317-5" aria-hidden="true" tabindex="-1"></a>    model_id <span class="ot">&lt;-</span> <span class="fu">lm</span>(Acrophase_Raw_Hours <span class="sc">~</span> photoperiod_hours, <span class="at">data =</span> .)</span>
<span id="cb317-6"><a href="#cb317-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb317-7"><a href="#cb317-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">photoperiod_hours =</span> <span class="fu">seq</span>(<span class="fu">min</span>(.<span class="sc">$</span>photoperiod_hours), <span class="fu">max</span>(.<span class="sc">$</span>photoperiod_hours), <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb317-8"><a href="#cb317-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">Acrophase_pred =</span> <span class="fu">predict</span>(model_id, <span class="at">newdata =</span> <span class="fu">data.frame</span>(</span>
<span id="cb317-9"><a href="#cb317-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">photoperiod_hours =</span> <span class="fu">seq</span>(<span class="fu">min</span>(.<span class="sc">$</span>photoperiod_hours), <span class="fu">max</span>(.<span class="sc">$</span>photoperiod_hours), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb317-10"><a href="#cb317-10" aria-hidden="true" tabindex="-1"></a>      )),</span>
<span id="cb317-11"><a href="#cb317-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ID =</span> <span class="fu">unique</span>(.<span class="sc">$</span>ID)</span>
<span id="cb317-12"><a href="#cb317-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb317-13"><a href="#cb317-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb317-14"><a href="#cb317-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb317-15"><a href="#cb317-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb317-16"><a href="#cb317-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_all_ids, <span class="fu">aes</span>(<span class="at">x =</span> photoperiod_hours, <span class="at">y =</span> Acrophase_Raw_Hours, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb317-17"><a href="#cb317-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb317-18"><a href="#cb317-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> id_fits_phot_acr, <span class="fu">aes</span>(<span class="at">x =</span> photoperiod_hours, <span class="at">y =</span> Acrophase_pred, <span class="at">color =</span> ID), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb317-19"><a href="#cb317-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_phot_acr, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> predicted), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb317-20"><a href="#cb317-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_phot_acr, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb317-21"><a href="#cb317-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"grey70"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb317-22"><a href="#cb317-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb317-23"><a href="#cb317-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb317-24"><a href="#cb317-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Acrophase vs. Photoperiod per ID + Overall Trend"</span>,</span>
<span id="cb317-25"><a href="#cb317-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Photoperiod (hours)"</span>,</span>
<span id="cb317-26"><a href="#cb317-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Acrophase (hours of the day)"</span></span>
<span id="cb317-27"><a href="#cb317-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb317-28"><a href="#cb317-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-135-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="amplitude-linear-mixed-model" class="level3">
<h3 class="anchored" data-anchor-id="amplitude-linear-mixed-model">Amplitude: Linear Mixed Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb318"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" aria-hidden="true" tabindex="-1"></a>model_photoperiod_amp <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb318-2"><a href="#cb318-2" aria-hidden="true" tabindex="-1"></a>  Amp <span class="sc">~</span> photoperiod_hours <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb318-3"><a href="#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> moving_window_all_ids</span>
<span id="cb318-4"><a href="#cb318-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb318-5"><a href="#cb318-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb318-6"><a href="#cb318-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_photoperiod_amp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Amp ~ photoperiod_hours + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 6080.8

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.8414 -0.6813 -0.0419  0.6031  6.9604 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 7.967    2.823   
 Residual             7.659    2.767   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
                   Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)          9.1032     1.2070    5.8553   7.542 0.000316 ***
photoperiod_hours   -0.0356     0.0267 1236.1617  -1.333 0.182718    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr)
photprd_hrs -0.286</code></pre>
</div>
</div>
<p><strong>Description:</strong> Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb320"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Per-ID fits</span></span>
<span id="cb320-2"><a href="#cb320-2" aria-hidden="true" tabindex="-1"></a>id_fits_amp <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb320-3"><a href="#cb320-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb320-4"><a href="#cb320-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>({</span>
<span id="cb320-5"><a href="#cb320-5" aria-hidden="true" tabindex="-1"></a>    model_id <span class="ot">&lt;-</span> <span class="fu">lm</span>(Amp <span class="sc">~</span> photoperiod_hours, <span class="at">data =</span> .)</span>
<span id="cb320-6"><a href="#cb320-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb320-7"><a href="#cb320-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">photoperiod_hours =</span> <span class="fu">seq</span>(<span class="fu">min</span>(.<span class="sc">$</span>photoperiod_hours), <span class="fu">max</span>(.<span class="sc">$</span>photoperiod_hours), <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb320-8"><a href="#cb320-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">Amp_pred =</span> <span class="fu">predict</span>(model_id, <span class="at">newdata =</span> <span class="fu">data.frame</span>(</span>
<span id="cb320-9"><a href="#cb320-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">photoperiod_hours =</span> <span class="fu">seq</span>(<span class="fu">min</span>(.<span class="sc">$</span>photoperiod_hours), <span class="fu">max</span>(.<span class="sc">$</span>photoperiod_hours), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb320-10"><a href="#cb320-10" aria-hidden="true" tabindex="-1"></a>      )),</span>
<span id="cb320-11"><a href="#cb320-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ID =</span> <span class="fu">unique</span>(.<span class="sc">$</span>ID)</span>
<span id="cb320-12"><a href="#cb320-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb320-13"><a href="#cb320-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb320-14"><a href="#cb320-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-15"><a href="#cb320-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall fit from the mixed model</span></span>
<span id="cb320-16"><a href="#cb320-16" aria-hidden="true" tabindex="-1"></a>pred_amp <span class="ot">&lt;-</span> ggeffects<span class="sc">::</span><span class="fu">ggpredict</span>(model_photoperiod_amp, <span class="at">terms =</span> <span class="st">"photoperiod_hours"</span>)</span>
<span id="cb320-17"><a href="#cb320-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb320-18"><a href="#cb320-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb320-19"><a href="#cb320-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_all_ids, <span class="fu">aes</span>(<span class="at">x =</span> photoperiod_hours, <span class="at">y =</span> Amp, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb320-20"><a href="#cb320-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb320-21"><a href="#cb320-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> id_fits_amp, <span class="fu">aes</span>(<span class="at">x =</span> photoperiod_hours, <span class="at">y =</span> Amp_pred, <span class="at">color =</span> ID), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb320-22"><a href="#cb320-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_amp, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> predicted), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb320-23"><a href="#cb320-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_amp, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb320-24"><a href="#cb320-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"grey70"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb320-25"><a href="#cb320-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb320-26"><a href="#cb320-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb320-27"><a href="#cb320-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Amplitude vs. Photoperiod per ID + Overall Trend"</span>,</span>
<span id="cb320-28"><a href="#cb320-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Photoperiod (hours)"</span>,</span>
<span id="cb320-29"><a href="#cb320-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Amplitude"</span></span>
<span id="cb320-30"><a href="#cb320-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb320-31"><a href="#cb320-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-137-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="intercept-linear-mixed-model" class="level3">
<h3 class="anchored" data-anchor-id="intercept-linear-mixed-model">Intercept: Linear Mixed Model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb321"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb321-1"><a href="#cb321-1" aria-hidden="true" tabindex="-1"></a>model_photoperiod_int <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb321-2"><a href="#cb321-2" aria-hidden="true" tabindex="-1"></a>  Intercept <span class="sc">~</span> photoperiod_hours <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb321-3"><a href="#cb321-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> moving_window_all_ids</span>
<span id="cb321-4"><a href="#cb321-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb321-5"><a href="#cb321-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-6"><a href="#cb321-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_photoperiod_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Intercept ~ photoperiod_hours + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 8603.3

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.3272 -0.6240  0.0496  0.6911  2.5767 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 10.65    3.263   
 Residual             59.07    7.686   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
                    Estimate Std. Error         df t value Pr(&gt;|t|)    
(Intercept)        102.06617    1.66087   10.26987   61.45 1.61e-14 ***
photoperiod_hours   -0.13320    0.07399 1238.43862   -1.80   0.0721 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr)
photprd_hrs -0.574</code></pre>
</div>
</div>
</section>
<section id="acrophase-linear-mixed-model-daylight-saving-time" class="level3">
<h3 class="anchored" data-anchor-id="acrophase-linear-mixed-model-daylight-saving-time">Acrophase: Linear Mixed Model Daylight Saving Time</h3>
<p><strong>Description:</strong> Linear Mixed Model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb323"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb323-1"><a href="#cb323-1" aria-hidden="true" tabindex="-1"></a>model_photoperiod_acr_dst <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb323-2"><a href="#cb323-2" aria-hidden="true" tabindex="-1"></a>  Acrophase_Raw_Hours <span class="sc">~</span> photoperiod_hours <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb323-3"><a href="#cb323-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> moving_window_all_ids_dst</span>
<span id="cb323-4"><a href="#cb323-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb323-5"><a href="#cb323-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-6"><a href="#cb323-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_photoperiod_acr_dst)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Acrophase_Raw_Hours ~ photoperiod_hours + (1 | ID)
   Data: moving_window_all_ids_dst

REML criterion at convergence: 7189.1

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.4487 -0.2030  0.1091  0.4971  1.6325 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept)  1.233   1.110   
 Residual             18.848   4.341   
Number of obs: 1242, groups:  ID, 6

Fixed effects:
                   Estimate Std. Error        df t value Pr(&gt;|t|)    
(Intercept)       1.649e+01  7.161e-01 2.346e+01  23.022   &lt;2e-16 ***
photoperiod_hours 9.429e-02  4.161e-02 1.218e+03   2.266   0.0236 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
            (Intr)
photprd_hrs -0.745</code></pre>
</div>
</div>
<p><strong>Description:</strong> Plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb325"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb325-1"><a href="#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Per-ID fits</span></span>
<span id="cb325-2"><a href="#cb325-2" aria-hidden="true" tabindex="-1"></a>id_fits_int <span class="ot">&lt;-</span> moving_window_all_ids <span class="sc">%&gt;%</span></span>
<span id="cb325-3"><a href="#cb325-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb325-4"><a href="#cb325-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>({</span>
<span id="cb325-5"><a href="#cb325-5" aria-hidden="true" tabindex="-1"></a>    model_id <span class="ot">&lt;-</span> <span class="fu">lm</span>(Intercept <span class="sc">~</span> photoperiod_hours, <span class="at">data =</span> .)</span>
<span id="cb325-6"><a href="#cb325-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb325-7"><a href="#cb325-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">photoperiod_hours =</span> <span class="fu">seq</span>(<span class="fu">min</span>(.<span class="sc">$</span>photoperiod_hours), <span class="fu">max</span>(.<span class="sc">$</span>photoperiod_hours), <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb325-8"><a href="#cb325-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">Intercept_pred =</span> <span class="fu">predict</span>(model_id, <span class="at">newdata =</span> <span class="fu">data.frame</span>(</span>
<span id="cb325-9"><a href="#cb325-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">photoperiod_hours =</span> <span class="fu">seq</span>(<span class="fu">min</span>(.<span class="sc">$</span>photoperiod_hours), <span class="fu">max</span>(.<span class="sc">$</span>photoperiod_hours), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb325-10"><a href="#cb325-10" aria-hidden="true" tabindex="-1"></a>      )),</span>
<span id="cb325-11"><a href="#cb325-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">ID =</span> <span class="fu">unique</span>(.<span class="sc">$</span>ID)</span>
<span id="cb325-12"><a href="#cb325-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb325-13"><a href="#cb325-13" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb325-14"><a href="#cb325-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-15"><a href="#cb325-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall fit from the mixed model</span></span>
<span id="cb325-16"><a href="#cb325-16" aria-hidden="true" tabindex="-1"></a>pred_int <span class="ot">&lt;-</span> ggeffects<span class="sc">::</span><span class="fu">ggpredict</span>(model_photoperiod_int, <span class="at">terms =</span> <span class="st">"photoperiod_hours"</span>)</span>
<span id="cb325-17"><a href="#cb325-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb325-18"><a href="#cb325-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb325-19"><a href="#cb325-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(moving_window_all_ids, <span class="fu">aes</span>(<span class="at">x =</span> photoperiod_hours, <span class="at">y =</span> Intercept, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb325-20"><a href="#cb325-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb325-21"><a href="#cb325-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> id_fits_int, <span class="fu">aes</span>(<span class="at">x =</span> photoperiod_hours, <span class="at">y =</span> Intercept_pred, <span class="at">color =</span> ID), <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb325-22"><a href="#cb325-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_int, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> predicted), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb325-23"><a href="#cb325-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_int, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high),</span>
<span id="cb325-24"><a href="#cb325-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"grey70"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb325-25"><a href="#cb325-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb325-26"><a href="#cb325-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb325-27"><a href="#cb325-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Intercept vs. Photoperiod per ID + Overall Trend"</span>,</span>
<span id="cb325-28"><a href="#cb325-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Photoperiod (hours)"</span>,</span>
<span id="cb325-29"><a href="#cb325-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Intercept"</span></span>
<span id="cb325-30"><a href="#cb325-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb325-31"><a href="#cb325-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-140-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="arcrophase-seasons" class="level3">
<h3 class="anchored" data-anchor-id="arcrophase-seasons">Arcrophase &amp; Seasons</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb326"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb326-1"><a href="#cb326-1" aria-hidden="true" tabindex="-1"></a>photoperiod_season_acr <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb326-2"><a href="#cb326-2" aria-hidden="true" tabindex="-1"></a>  Acrophase_Raw_Hours <span class="sc">~</span> photoperiod_hours <span class="sc">*</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb326-3"><a href="#cb326-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> moving_window_all_ids</span>
<span id="cb326-4"><a href="#cb326-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb326-5"><a href="#cb326-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-6"><a href="#cb326-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(photoperiod_season_acr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Acrophase_Raw_Hours ~ photoperiod_hours * Season + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 6946.9

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.9007 -0.2877  0.0991  0.5455  2.0076 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept)  1.272   1.128   
 Residual             15.589   3.948   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
                                Estimate Std. Error        df t value Pr(&gt;|t|)
(Intercept)                       6.6048     1.9059  609.9073   3.465 0.000567
photoperiod_hours                 1.1766     0.2129 1231.3057   5.526 3.99e-08
SeasonAutumn                     12.5664     2.3975 1229.1657   5.241 1.87e-07
SeasonSpring                     16.3866     2.5076 1231.8095   6.535 9.31e-11
SeasonSummer                      8.2705     4.2270 1229.8741   1.957 0.050621
photoperiod_hours:SeasonAutumn   -1.3644     0.2576 1229.5159  -5.297 1.39e-07
photoperiod_hours:SeasonSpring   -1.5402     0.2452 1232.7567  -6.281 4.64e-10
photoperiod_hours:SeasonSummer   -1.0617     0.3216 1230.1163  -3.302 0.000989
                                  
(Intercept)                    ***
photoperiod_hours              ***
SeasonAutumn                   ***
SeasonSpring                   ***
SeasonSummer                   .  
photoperiod_hours:SeasonAutumn ***
photoperiod_hours:SeasonSpring ***
photoperiod_hours:SeasonSummer ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                 (Intr) phtpr_ SsnAtm SsnSpr SsnSmm ph_:SA phtprd_hrs:SsnSp
photprd_hrs      -0.961                                                    
SeasonAutmn      -0.728  0.749                                             
SeasonSprng      -0.703  0.728  0.556                                      
SeasonSummr      -0.422  0.432  0.322  0.321                               
phtprd_h:SA       0.782 -0.816 -0.985 -0.597 -0.346                        
phtprd_hrs:SsnSp  0.827 -0.868 -0.652 -0.967 -0.376  0.711                 
phtprd_hrs:SsnSm  0.635 -0.661 -0.490 -0.483 -0.960  0.535  0.575          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb328"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb328-1"><a href="#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"rlang"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb328-2"><a href="#cb328-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"rlang"</span>)</span>
<span id="cb328-3"><a href="#cb328-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb328-4"><a href="#cb328-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb328-5"><a href="#cb328-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-6"><a href="#cb328-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Season-specific slopes of photoperiod for your model</span></span>
<span id="cb328-7"><a href="#cb328-7" aria-hidden="true" tabindex="-1"></a>acr_trends <span class="ot">&lt;-</span> <span class="fu">emtrends</span>(</span>
<span id="cb328-8"><a href="#cb328-8" aria-hidden="true" tabindex="-1"></a>  photoperiod_season_acr,</span>
<span id="cb328-9"><a href="#cb328-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> Season,</span>
<span id="cb328-10"><a href="#cb328-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"photoperiod_hours"</span></span>
<span id="cb328-11"><a href="#cb328-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb328-12"><a href="#cb328-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-13"><a href="#cb328-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Turn into a data frame and robustly find the trend column</span></span>
<span id="cb328-14"><a href="#cb328-14" aria-hidden="true" tabindex="-1"></a>acr_trends_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(acr_trends, <span class="at">infer =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb328-15"><a href="#cb328-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb328-16"><a href="#cb328-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-17"><a href="#cb328-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Find the column that holds the slope; works for names like "photoperiod_hours.trend" or "trend"</span></span>
<span id="cb328-18"><a href="#cb328-18" aria-hidden="true" tabindex="-1"></a>trend_col <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"(</span><span class="sc">\\</span><span class="st">.trend$)|(^trend$)"</span>, <span class="fu">names</span>(acr_trends_sum), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb328-19"><a href="#cb328-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-20"><a href="#cb328-20" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(trend_col) <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb328-21"><a href="#cb328-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(</span>
<span id="cb328-22"><a href="#cb328-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Could not uniquely identify the trend column. Found: "</span>,</span>
<span id="cb328-23"><a href="#cb328-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">names</span>(acr_trends_sum), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb328-24"><a href="#cb328-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb328-25"><a href="#cb328-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb328-26"><a href="#cb328-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-27"><a href="#cb328-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a standardized column name and compute minutes + CIs</span></span>
<span id="cb328-28"><a href="#cb328-28" aria-hidden="true" tabindex="-1"></a>acr_trends_sum <span class="ot">&lt;-</span> acr_trends_sum <span class="sc">%&gt;%</span></span>
<span id="cb328-29"><a href="#cb328-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb328-30"><a href="#cb328-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope_hours_per_hour =</span> .data[[trend_col]],</span>
<span id="cb328-31"><a href="#cb328-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope_minutes_per_hour =</span> <span class="dv">60</span> <span class="sc">*</span> slope_hours_per_hour,</span>
<span id="cb328-32"><a href="#cb328-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower.CL.minutes =</span> <span class="dv">60</span> <span class="sc">*</span> lower.CL,</span>
<span id="cb328-33"><a href="#cb328-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper.CL.minutes =</span> <span class="dv">60</span> <span class="sc">*</span> upper.CL</span>
<span id="cb328-34"><a href="#cb328-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb328-35"><a href="#cb328-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># keep a clean set of columns</span></span>
<span id="cb328-36"><a href="#cb328-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb328-37"><a href="#cb328-37" aria-hidden="true" tabindex="-1"></a>    Season, slope_hours_per_hour, slope_minutes_per_hour,</span>
<span id="cb328-38"><a href="#cb328-38" aria-hidden="true" tabindex="-1"></a>    SE, df, t.ratio, p.value, lower.CL, upper.CL,</span>
<span id="cb328-39"><a href="#cb328-39" aria-hidden="true" tabindex="-1"></a>    lower.CL.minutes, upper.CL.minutes</span>
<span id="cb328-40"><a href="#cb328-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb328-41"><a href="#cb328-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-42"><a href="#cb328-42" aria-hidden="true" tabindex="-1"></a>acr_trends_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Season slope_hours_per_hour slope_minutes_per_hour        SE       df
1 Winter            1.1766361              70.598166 0.2130793 1231.388
2 Autumn           -0.1877918             -11.267507 0.1491217 1232.368
3 Spring           -0.3635151             -21.810906 0.1225439 1202.729
4 Summer            0.1149524               6.897143 0.2414120 1229.486
     t.ratio      p.value   lower.CL   upper.CL lower.CL.minutes
1  5.5220580 4.083288e-08  0.7585975  1.5946747         45.51585
2 -1.2593186 2.081537e-01 -0.4803523  0.1047688        -28.82114
3 -2.9664076 3.072517e-03 -0.6039386 -0.1230916        -36.23632
4  0.4761668 6.340401e-01 -0.3586727  0.5885775        -21.52036
  upper.CL.minutes
1        95.680481
2         6.286127
3        -7.385494
4        35.314650</code></pre>
</div>
<div class="sourceCode cell-code" id="cb330"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb330-1"><a href="#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; Season-wise slopes (h per 1 h photoperiod) + SE, t, p, 95% CI</span></span>
<span id="cb330-2"><a href="#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    and the same in minutes per hour for readability.</span></span>
<span id="cb330-3"><a href="#cb330-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb330-4"><a href="#cb330-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Tests against zero for each season's slope</span></span>
<span id="cb330-5"><a href="#cb330-5" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(acr_trends)         <span class="co"># H0: slope = 0 per Season</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Season photoperiod_hours.trend    SE   df t.ratio p.value
 Winter                   1.177 0.213 1231   5.522  &lt;.0001
 Autumn                  -0.188 0.149 1232  -1.259  0.2082
 Spring                  -0.364 0.123 1203  -2.966  0.0031
 Summer                   0.115 0.241 1229   0.476  0.6340

Degrees-of-freedom method: kenward-roger </code></pre>
</div>
<div class="sourceCode cell-code" id="cb332"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb332-1"><a href="#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons of slopes between seasons (Tukey-adjusted)</span></span>
<span id="cb332-2"><a href="#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(acr_trends, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast        estimate    SE   df t.ratio p.value
 Winter - Autumn    1.364 0.258 1230   5.296  &lt;.0001
 Winter - Spring    1.540 0.246 1233   6.270  &lt;.0001
 Winter - Summer    1.062 0.322 1230   3.300  0.0055
 Autumn - Spring    0.176 0.192 1231   0.915  0.7968
 Autumn - Summer   -0.303 0.285 1231  -1.062  0.7125
 Spring - Summer   -0.478 0.270 1233  -1.770  0.2883

Degrees-of-freedom method: kenward-roger 
P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
</div>
</section>
<section id="amplitude-seasons" class="level3">
<h3 class="anchored" data-anchor-id="amplitude-seasons">Amplitude &amp; Seasons</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb334"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb334-1"><a href="#cb334-1" aria-hidden="true" tabindex="-1"></a>photoperiod_season_amp <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb334-2"><a href="#cb334-2" aria-hidden="true" tabindex="-1"></a>  Amp <span class="sc">~</span> photoperiod_hours <span class="sc">*</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb334-3"><a href="#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> moving_window_all_ids</span>
<span id="cb334-4"><a href="#cb334-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb334-5"><a href="#cb334-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-6"><a href="#cb334-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(photoperiod_season_amp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Amp ~ photoperiod_hours * Season + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 6070.9

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-2.8896 -0.6524 -0.0341  0.5787  6.9406 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 8.060    2.839   
 Residual             7.585    2.754   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
                                 Estimate Std. Error         df t value
(Intercept)                       8.65345    1.73555   24.24625   4.986
photoperiod_hours                 0.02273    0.14864 1228.27663   0.153
SeasonAutumn                      2.15171    1.67273 1228.04556   1.286
SeasonSpring                     -2.24996    1.75455 1229.41515  -1.282
SeasonSummer                      6.85803    2.94958 1228.11157   2.325
photoperiod_hours:SeasonAutumn   -0.21802    0.17971 1228.07798  -1.213
photoperiod_hours:SeasonSpring    0.11806    0.17146 1229.14603   0.689
photoperiod_hours:SeasonSummer   -0.44949    0.22440 1228.13759  -2.003
                               Pr(&gt;|t|)    
(Intercept)                    4.19e-05 ***
photoperiod_hours                0.8785    
SeasonAutumn                     0.1986    
SeasonSpring                     0.2000    
SeasonSummer                     0.0202 *  
photoperiod_hours:SeasonAutumn   0.2253    
photoperiod_hours:SeasonSpring   0.4912    
photoperiod_hours:SeasonSummer   0.0454 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                 (Intr) phtpr_ SsnAtm SsnSpr SsnSmm ph_:SA phtprd_hrs:SsnSp
photprd_hrs      -0.737                                                    
SeasonAutmn      -0.558  0.748                                             
SeasonSprng      -0.536  0.727  0.555                                      
SeasonSummr      -0.324  0.433  0.321  0.321                               
phtprd_h:SA       0.599 -0.816 -0.985 -0.596 -0.346                        
phtprd_hrs:SsnSp  0.632 -0.866 -0.651 -0.967 -0.376  0.709                 
phtprd_hrs:SsnSm  0.487 -0.661 -0.490 -0.482 -0.960  0.535  0.574          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb336"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb336-1"><a href="#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Season-specific slopes of photoperiod for the amplitude model</span></span>
<span id="cb336-2"><a href="#cb336-2" aria-hidden="true" tabindex="-1"></a>amp_trends <span class="ot">&lt;-</span> <span class="fu">emtrends</span>(</span>
<span id="cb336-3"><a href="#cb336-3" aria-hidden="true" tabindex="-1"></a>  photoperiod_season_amp,</span>
<span id="cb336-4"><a href="#cb336-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> Season,</span>
<span id="cb336-5"><a href="#cb336-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"photoperiod_hours"</span></span>
<span id="cb336-6"><a href="#cb336-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb336-7"><a href="#cb336-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-8"><a href="#cb336-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize with correct SEs, df, t, p, and 95% CIs</span></span>
<span id="cb336-9"><a href="#cb336-9" aria-hidden="true" tabindex="-1"></a>amp_trends_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(amp_trends, <span class="at">infer =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb336-10"><a href="#cb336-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb336-11"><a href="#cb336-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-12"><a href="#cb336-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Robustly detect the slope column (handles names like "photoperiod_hours.trend" or "trend")</span></span>
<span id="cb336-13"><a href="#cb336-13" aria-hidden="true" tabindex="-1"></a>trend_col_amp <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"(</span><span class="sc">\\</span><span class="st">.trend$)|(^trend$)"</span>, <span class="fu">names</span>(amp_trends_sum), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb336-14"><a href="#cb336-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-15"><a href="#cb336-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(trend_col_amp) <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb336-16"><a href="#cb336-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(</span>
<span id="cb336-17"><a href="#cb336-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Could not uniquely identify the trend column. Found: "</span>,</span>
<span id="cb336-18"><a href="#cb336-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">names</span>(amp_trends_sum), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb336-19"><a href="#cb336-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb336-20"><a href="#cb336-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb336-21"><a href="#cb336-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-22"><a href="#cb336-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize column name and keep a clean table (units: mg/dl per 1 h photoperiod)</span></span>
<span id="cb336-23"><a href="#cb336-23" aria-hidden="true" tabindex="-1"></a>amp_trends_sum <span class="ot">&lt;-</span> amp_trends_sum <span class="sc">%&gt;%</span></span>
<span id="cb336-24"><a href="#cb336-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb336-25"><a href="#cb336-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope_mgdl_per_hour =</span> .data[[trend_col_amp]]</span>
<span id="cb336-26"><a href="#cb336-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb336-27"><a href="#cb336-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb336-28"><a href="#cb336-28" aria-hidden="true" tabindex="-1"></a>    Season,</span>
<span id="cb336-29"><a href="#cb336-29" aria-hidden="true" tabindex="-1"></a>    slope_mgdl_per_hour,</span>
<span id="cb336-30"><a href="#cb336-30" aria-hidden="true" tabindex="-1"></a>    SE, df, t.ratio, p.value,</span>
<span id="cb336-31"><a href="#cb336-31" aria-hidden="true" tabindex="-1"></a>    lower.CL, upper.CL</span>
<span id="cb336-32"><a href="#cb336-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb336-33"><a href="#cb336-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb336-34"><a href="#cb336-34" aria-hidden="true" tabindex="-1"></a>amp_trends_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Season slope_mgdl_per_hour         SE       df    t.ratio    p.value
1 Winter          0.02273308 0.14864490 1228.339  0.1529355 0.87847425
2 Autumn         -0.19528515 0.10403150 1228.491 -1.8771732 0.06073118
3 Spring          0.14079704 0.08576461 1231.147  1.6416682 0.10091418
4 Summer         -0.42675282 0.16839405 1228.122 -2.5342511 0.01139221
     lower.CL     upper.CL
1 -0.26889291  0.314359079
2 -0.39938423  0.008813935
3 -0.02746393  0.309058016
4 -0.75712469 -0.096380950</code></pre>
</div>
<div class="sourceCode cell-code" id="cb338"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb338-1"><a href="#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; Season-wise slopes (mg/dl per 1 h photoperiod) with SE, t, p, and 95% CI.</span></span>
<span id="cb338-2"><a href="#cb338-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-3"><a href="#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tests against zero for each season's slope</span></span>
<span id="cb338-4"><a href="#cb338-4" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(amp_trends)          <span class="co"># H0: slope = 0 in each Season</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Season photoperiod_hours.trend     SE   df t.ratio p.value
 Winter                  0.0227 0.1490 1228   0.153  0.8785
 Autumn                 -0.1953 0.1040 1228  -1.877  0.0607
 Spring                  0.1408 0.0858 1231   1.642  0.1009
 Summer                 -0.4268 0.1680 1228  -2.534  0.0114

Degrees-of-freedom method: kenward-roger </code></pre>
</div>
<div class="sourceCode cell-code" id="cb340"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb340-1"><a href="#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons of slopes between seasons (Tukey-adjusted)</span></span>
<span id="cb340-2"><a href="#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(amp_trends, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast        estimate    SE   df t.ratio p.value
 Winter - Autumn    0.218 0.180 1228   1.213  0.6186
 Winter - Spring   -0.118 0.171 1229  -0.688  0.9015
 Winter - Summer    0.449 0.224 1228   2.003  0.1874
 Autumn - Spring   -0.336 0.134 1230  -2.505  0.0595
 Autumn - Summer    0.231 0.199 1228   1.164  0.6495
 Spring - Summer    0.568 0.189 1229   3.008  0.0142

Degrees-of-freedom method: kenward-roger 
P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
</div>
</section>
<section id="intercept-seasons" class="level3">
<h3 class="anchored" data-anchor-id="intercept-seasons">Intercept &amp; Seasons</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb342"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb342-1"><a href="#cb342-1" aria-hidden="true" tabindex="-1"></a>photoperiod_season_int <span class="ot">&lt;-</span> <span class="fu">lmer</span>(</span>
<span id="cb342-2"><a href="#cb342-2" aria-hidden="true" tabindex="-1"></a>  Intercept <span class="sc">~</span> photoperiod_hours <span class="sc">*</span> Season <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> ID),</span>
<span id="cb342-3"><a href="#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> moving_window_all_ids</span>
<span id="cb342-4"><a href="#cb342-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb342-5"><a href="#cb342-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-6"><a href="#cb342-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(photoperiod_season_int)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: Intercept ~ photoperiod_hours * Season + (1 | ID)
   Data: moving_window_all_ids

REML criterion at convergence: 8351.9

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-4.7693 -0.6091  0.0343  0.6464  2.7196 

Random effects:
 Groups   Name        Variance Std.Dev.
 ID       (Intercept) 10.19    3.191   
 Residual             48.55    6.968   
Number of obs: 1241, groups:  ID, 6

Fixed effects:
                                Estimate Std. Error        df t value Pr(&gt;|t|)
(Intercept)                     137.2564     3.5168  208.6404  39.028  &lt; 2e-16
photoperiod_hours                -4.4208     0.3759 1229.5266 -11.759  &lt; 2e-16
SeasonAutumn                    -17.7738     4.2315 1228.4839  -4.200 2.86e-05
SeasonSpring                    -60.8000     4.4336 1232.5756 -13.714  &lt; 2e-16
SeasonSummer                    -35.4420     7.4612 1228.7954  -4.750 2.27e-06
photoperiod_hours:SeasonAutumn    2.8421     0.4546 1228.6371   6.252 5.59e-10
photoperiod_hours:SeasonSpring    6.0684     0.4334 1232.0895  14.003  &lt; 2e-16
photoperiod_hours:SeasonSummer    4.3122     0.5676 1228.9127   7.597 5.99e-14
                                  
(Intercept)                    ***
photoperiod_hours              ***
SeasonAutumn                   ***
SeasonSpring                   ***
SeasonSummer                   ***
photoperiod_hours:SeasonAutumn ***
photoperiod_hours:SeasonSpring ***
photoperiod_hours:SeasonSummer ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Correlation of Fixed Effects:
                 (Intr) phtpr_ SsnAtm SsnSpr SsnSmm ph_:SA phtprd_hrs:SsnSp
photprd_hrs      -0.920                                                    
SeasonAutmn      -0.696  0.748                                             
SeasonSprng      -0.671  0.727  0.555                                      
SeasonSummr      -0.404  0.433  0.321  0.321                               
phtprd_h:SA       0.748 -0.816 -0.985 -0.596 -0.346                        
phtprd_hrs:SsnSp  0.790 -0.867 -0.651 -0.967 -0.376  0.710                 
phtprd_hrs:SsnSm  0.607 -0.661 -0.490 -0.483 -0.960  0.535  0.574          </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb344"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb344-1"><a href="#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Season-specific slopes of photoperiod for the intercept model</span></span>
<span id="cb344-2"><a href="#cb344-2" aria-hidden="true" tabindex="-1"></a>int_trends <span class="ot">&lt;-</span> <span class="fu">emtrends</span>(</span>
<span id="cb344-3"><a href="#cb344-3" aria-hidden="true" tabindex="-1"></a>  photoperiod_season_int,</span>
<span id="cb344-4"><a href="#cb344-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> Season,</span>
<span id="cb344-5"><a href="#cb344-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">var =</span> <span class="st">"photoperiod_hours"</span></span>
<span id="cb344-6"><a href="#cb344-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb344-7"><a href="#cb344-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-8"><a href="#cb344-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize with correct SEs, df, t, p, and 95% CIs</span></span>
<span id="cb344-9"><a href="#cb344-9" aria-hidden="true" tabindex="-1"></a>int_trends_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(int_trends, <span class="at">infer =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb344-10"><a href="#cb344-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb344-11"><a href="#cb344-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-12"><a href="#cb344-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Robustly detect the slope column (handles names like "photoperiod_hours.trend" or "trend")</span></span>
<span id="cb344-13"><a href="#cb344-13" aria-hidden="true" tabindex="-1"></a>trend_col_int <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"(</span><span class="sc">\\</span><span class="st">.trend$)|(^trend$)"</span>, <span class="fu">names</span>(int_trends_sum), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb344-14"><a href="#cb344-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-15"><a href="#cb344-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(trend_col_int) <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb344-16"><a href="#cb344-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(</span>
<span id="cb344-17"><a href="#cb344-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Could not uniquely identify the trend column. Found: "</span>,</span>
<span id="cb344-18"><a href="#cb344-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">names</span>(int_trends_sum), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb344-19"><a href="#cb344-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb344-20"><a href="#cb344-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb344-21"><a href="#cb344-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-22"><a href="#cb344-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize column name and keep a clean table (units: mg/dl per 1 h photoperiod)</span></span>
<span id="cb344-23"><a href="#cb344-23" aria-hidden="true" tabindex="-1"></a>int_trends_sum <span class="ot">&lt;-</span> int_trends_sum <span class="sc">%&gt;%</span></span>
<span id="cb344-24"><a href="#cb344-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb344-25"><a href="#cb344-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope_mgdl_per_hour =</span> .data[[trend_col_int]]</span>
<span id="cb344-26"><a href="#cb344-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb344-27"><a href="#cb344-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(</span>
<span id="cb344-28"><a href="#cb344-28" aria-hidden="true" tabindex="-1"></a>    Season,</span>
<span id="cb344-29"><a href="#cb344-29" aria-hidden="true" tabindex="-1"></a>    slope_mgdl_per_hour,</span>
<span id="cb344-30"><a href="#cb344-30" aria-hidden="true" tabindex="-1"></a>    SE, df, t.ratio, p.value,</span>
<span id="cb344-31"><a href="#cb344-31" aria-hidden="true" tabindex="-1"></a>    lower.CL, upper.CL</span>
<span id="cb344-32"><a href="#cb344-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb344-33"><a href="#cb344-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-34"><a href="#cb344-34" aria-hidden="true" tabindex="-1"></a>int_trends_sum</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Season slope_mgdl_per_hour        SE       df     t.ratio      p.value
1 Winter          -4.4207558 0.3760431 1229.580 -11.7559817 2.577402e-30
2 Autumn          -1.5786615 0.2631748 1230.219  -5.9985277 2.614434e-09
3 Spring           1.6476423 0.2167702 1230.355   7.6008713 5.808725e-14
4 Summer          -0.1085895 0.4260189 1228.606  -0.2548936 7.988480e-01
    lower.CL   upper.CL
1 -5.1585130 -3.6829987
2 -2.0949826 -1.0623403
3  1.2223622  2.0729224
4 -0.9443947  0.7272157</code></pre>
</div>
<div class="sourceCode cell-code" id="cb346"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb346-1"><a href="#cb346-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -&gt; Season-wise slopes (mg/dl per 1 h photoperiod) with SE, t, p, and 95% CI.</span></span>
<span id="cb346-2"><a href="#cb346-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-3"><a href="#cb346-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tests against zero for each season's slope</span></span>
<span id="cb346-4"><a href="#cb346-4" aria-hidden="true" tabindex="-1"></a><span class="fu">test</span>(int_trends)          <span class="co"># H0: slope = 0 in each Season</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Season photoperiod_hours.trend    SE   df t.ratio p.value
 Winter                  -4.421 0.376 1230 -11.756  &lt;.0001
 Autumn                  -1.579 0.263 1230  -5.999  &lt;.0001
 Spring                   1.648 0.217 1230   7.601  &lt;.0001
 Summer                  -0.109 0.426 1229  -0.255  0.7988

Degrees-of-freedom method: kenward-roger </code></pre>
</div>
<div class="sourceCode cell-code" id="cb348"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb348-1"><a href="#cb348-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pairwise comparisons of slopes between seasons (Tukey-adjusted)</span></span>
<span id="cb348-2"><a href="#cb348-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(int_trends, <span class="at">adjust =</span> <span class="st">"tukey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast        estimate    SE   df t.ratio p.value
 Winter - Autumn    -2.84 0.455 1229  -6.251  &lt;.0001
 Winter - Spring    -6.07 0.434 1232 -13.991  &lt;.0001
 Winter - Summer    -4.31 0.568 1229  -7.595  &lt;.0001
 Autumn - Spring    -3.23 0.339 1233  -9.511  &lt;.0001
 Autumn - Summer    -1.47 0.503 1229  -2.923  0.0185
 Spring - Summer     1.76 0.477 1231   3.680  0.0014

Degrees-of-freedom method: kenward-roger 
P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
</div>
</section>
</section>
<section id="frequency-analysis-of-night-data" class="level2">
<h2 class="anchored" data-anchor-id="frequency-analysis-of-night-data">Frequency Analysis of Night Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb350"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb350-1"><a href="#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"lomb"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb350-2"><a href="#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"lomb"</span>)</span>
<span id="cb350-3"><a href="#cb350-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb350-4"><a href="#cb350-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"purrr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb350-5"><a href="#cb350-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"purrr"</span>)</span>
<span id="cb350-6"><a href="#cb350-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb350-7"><a href="#cb350-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lomb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'lomb'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:LightLogR':

    photoperiod</code></pre>
</div>
<div class="sourceCode cell-code" id="cb353"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb353-1"><a href="#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'purrr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:rlang':

    %@%, flatten, flatten_chr, flatten_dbl, flatten_int, flatten_lgl,
    flatten_raw, invoke, splice</code></pre>
</div>
</div>
<p><strong>Description:</strong> Create Dataframe</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb356"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb356-1"><a href="#cb356-1" aria-hidden="true" tabindex="-1"></a>night_data_frequence <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb356-2"><a href="#cb356-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(Hour <span class="sc">&gt;=</span> <span class="dv">22</span> <span class="sc">|</span> Hour <span class="sc">&lt;</span> <span class="dv">6</span>)<span class="sc">%&gt;%</span></span>
<span id="cb356-3"><a href="#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb356-4"><a href="#cb356-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Timestamp =</span> <span class="fu">as.POSIXct</span>(Timestamp, <span class="at">tz =</span> <span class="st">"Europe/Berlin"</span>),</span>
<span id="cb356-5"><a href="#cb356-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">Month =</span> <span class="fu">as.Date</span>(<span class="fu">format</span>(Timestamp,<span class="st">"%Y-%m-01"</span>))</span>
<span id="cb356-6"><a href="#cb356-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="lomb-scargle" class="level3">
<h3 class="anchored" data-anchor-id="lomb-scargle">Lomb-Scargle</h3>
<p><strong>Description:</strong> Install and Load Packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb357"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb357-1"><a href="#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"tibble"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb357-2"><a href="#cb357-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"tibble"</span>)</span>
<span id="cb357-3"><a href="#cb357-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb357-4"><a href="#cb357-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"readr"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb357-5"><a href="#cb357-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"readr"</span>)</span>
<span id="cb357-6"><a href="#cb357-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb357-7"><a href="#cb357-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"ggrepel"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb357-8"><a href="#cb357-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"ggrepel"</span>)</span>
<span id="cb357-9"><a href="#cb357-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb357-10"><a href="#cb357-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb357-11"><a href="#cb357-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb357-12"><a href="#cb357-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb357-13"><a href="#cb357-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Create the Function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb358"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb358-1"><a href="#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define parameters</span></span>
<span id="cb358-2"><a href="#cb358-2" aria-hidden="true" tabindex="-1"></a>OFAC           <span class="ot">&lt;-</span> <span class="dv">4</span>          <span class="co"># oversampling factro</span></span>
<span id="cb358-3"><a href="#cb358-3" aria-hidden="true" tabindex="-1"></a>ROUND_MINUTES  <span class="ot">&lt;-</span> <span class="cn">FALSE</span>      </span>
<span id="cb358-4"><a href="#cb358-4" aria-hidden="true" tabindex="-1"></a>MIN_POINTS     <span class="ot">&lt;-</span> <span class="dv">60</span>         <span class="co"># minimmum measurement points per night</span></span>
<span id="cb358-5"><a href="#cb358-5" aria-hidden="true" tabindex="-1"></a>MAX_PERIOD_MIN <span class="ot">&lt;-</span> <span class="dv">180</span>        <span class="co"># maximum period</span></span>
<span id="cb358-6"><a href="#cb358-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-7"><a href="#cb358-7" aria-hidden="true" tabindex="-1"></a><span class="co"># lomb function</span></span>
<span id="cb358-8"><a href="#cb358-8" aria-hidden="true" tabindex="-1"></a>lomb_for_span <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">max_period_min =</span> <span class="dv">180</span>, <span class="at">ofac =</span> <span class="dv">4</span>,</span>
<span id="cb358-9"><a href="#cb358-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">detrend =</span> <span class="cn">TRUE</span>, <span class="at">round_minutes =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb358-10"><a href="#cb358-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename glucose column</span></span>
<span id="cb358-11"><a href="#cb358-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"Glucose (mg/dl)"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(df, <span class="at">glucose =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span>
<span id="cb358-12"><a href="#cb358-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"Timestamp"</span>,<span class="st">"glucose"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(df)))</span>
<span id="cb358-13"><a href="#cb358-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-14"><a href="#cb358-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time as POSIXct</span></span>
<span id="cb358-15"><a href="#cb358-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(df<span class="sc">$</span>Timestamp, <span class="st">"POSIXct"</span>)) {</span>
<span id="cb358-16"><a href="#cb358-16" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(df, <span class="at">Timestamp =</span> <span class="fu">as.POSIXct</span>(Timestamp, <span class="at">tz =</span> <span class="st">"Europe/Berlin"</span>))</span>
<span id="cb358-17"><a href="#cb358-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb358-18"><a href="#cb358-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-19"><a href="#cb358-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data cleaning</span></span>
<span id="cb358-20"><a href="#cb358-20" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb358-21"><a href="#cb358-21" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Timestamp), <span class="sc">!</span><span class="fu">is.na</span>(glucose)) <span class="sc">%&gt;%</span></span>
<span id="cb358-22"><a href="#cb358-22" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(Timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb358-23"><a href="#cb358-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(Timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb358-24"><a href="#cb358-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">glucose =</span> <span class="fu">mean</span>(glucose, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb358-25"><a href="#cb358-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-26"><a href="#cb358-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(df) <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="fu">return</span>(<span class="fu">tibble</span>(<span class="at">period_minutes =</span> <span class="fu">numeric</span>(), <span class="at">power =</span> <span class="fu">numeric</span>()))</span>
<span id="cb358-27"><a href="#cb358-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-28"><a href="#cb358-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># time axis in minutes since start</span></span>
<span id="cb358-29"><a href="#cb358-29" aria-hidden="true" tabindex="-1"></a>  t_min <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(df<span class="sc">$</span>Timestamp <span class="sc">-</span> df<span class="sc">$</span>Timestamp[<span class="dv">1</span>], <span class="at">units =</span> <span class="st">"mins"</span>)</span>
<span id="cb358-30"><a href="#cb358-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-31"><a href="#cb358-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># detrend</span></span>
<span id="cb358-32"><a href="#cb358-32" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> df<span class="sc">$</span>glucose</span>
<span id="cb358-33"><a href="#cb358-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (detrend) {</span>
<span id="cb358-34"><a href="#cb358-34" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">resid</span>(<span class="fu">lm</span>(x <span class="sc">~</span> t_min))</span>
<span id="cb358-35"><a href="#cb358-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb358-36"><a href="#cb358-36" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x <span class="sc">-</span> <span class="fu">mean</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb358-37"><a href="#cb358-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb358-38"><a href="#cb358-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-39"><a href="#cb358-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sampling steps and lower limit</span></span>
<span id="cb358-40"><a href="#cb358-40" aria-hidden="true" tabindex="-1"></a>  dt_min <span class="ot">&lt;-</span> stats<span class="sc">::</span><span class="fu">median</span>(<span class="fu">diff</span>(t_min), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb358-41"><a href="#cb358-41" aria-hidden="true" tabindex="-1"></a>  min_period_min <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="dv">2</span> <span class="sc">*</span> dt_min, <span class="dv">10</span>)  <span class="co"># Nyquist, minimum 10 min</span></span>
<span id="cb358-42"><a href="#cb358-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-43"><a href="#cb358-43" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  type="period" </span></span>
<span id="cb358-44"><a href="#cb358-44" aria-hidden="true" tabindex="-1"></a>  ls <span class="ot">&lt;-</span> lomb<span class="sc">::</span><span class="fu">lsp</span>(</span>
<span id="cb358-45"><a href="#cb358-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">x     =</span> x,</span>
<span id="cb358-46"><a href="#cb358-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">times =</span> t_min,</span>
<span id="cb358-47"><a href="#cb358-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">from  =</span> min_period_min,     <span class="co"># period (min)</span></span>
<span id="cb358-48"><a href="#cb358-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">to    =</span> max_period_min,     <span class="co"># period (min)</span></span>
<span id="cb358-49"><a href="#cb358-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">type  =</span> <span class="st">"period"</span>,</span>
<span id="cb358-50"><a href="#cb358-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">ofac  =</span> ofac,</span>
<span id="cb358-51"><a href="#cb358-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot  =</span> <span class="cn">FALSE</span></span>
<span id="cb358-52"><a href="#cb358-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb358-53"><a href="#cb358-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-54"><a href="#cb358-54" aria-hidden="true" tabindex="-1"></a>  period_vec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ls<span class="sc">$</span>scanned)  </span>
<span id="cb358-55"><a href="#cb358-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (round_minutes) period_vec <span class="ot">&lt;-</span> <span class="fu">round</span>(period_vec)</span>
<span id="cb358-56"><a href="#cb358-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb358-57"><a href="#cb358-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb358-58"><a href="#cb358-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">period_minutes =</span> period_vec,</span>
<span id="cb358-59"><a href="#cb358-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">power          =</span> ls<span class="sc">$</span>power</span>
<span id="cb358-60"><a href="#cb358-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(period_minutes)</span>
<span id="cb358-61"><a href="#cb358-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Prepare Data for Night</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb359"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb359-1"><a href="#cb359-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb359-2"><a href="#cb359-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Timestamp =</span> <span class="fu">as.POSIXct</span>(Timestamp, <span class="at">tz =</span> <span class="st">"Europe/Berlin"</span>),</span>
<span id="cb359-3"><a href="#cb359-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">Hour =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(Timestamp)) <span class="sc">%&gt;%</span></span>
<span id="cb359-4"><a href="#cb359-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Hour <span class="sc">&gt;=</span> <span class="dv">22</span> <span class="sc">|</span> Hour <span class="sc">&lt;</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb359-5"><a href="#cb359-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">night_date =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(Hour <span class="sc">&gt;=</span> <span class="dv">22</span>, <span class="fu">as.Date</span>(Timestamp), <span class="fu">as.Date</span>(Timestamp) <span class="sc">-</span> <span class="dv">1</span>))</span>
<span id="cb359-6"><a href="#cb359-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb359-7"><a href="#cb359-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Nkeep nights with enough data points</span></span>
<span id="cb359-8"><a href="#cb359-8" aria-hidden="true" tabindex="-1"></a>dat_nights <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb359-9"><a href="#cb359-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID, night_date) <span class="sc">%&gt;%</span></span>
<span id="cb359-10"><a href="#cb359-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">n</span>() <span class="sc">&gt;=</span> MIN_POINTS) <span class="sc">%&gt;%</span></span>
<span id="cb359-11"><a href="#cb359-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Test for one ID and two Nights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb360"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb360-1"><a href="#cb360-1" aria-hidden="true" tabindex="-1"></a>test_dat <span class="ot">&lt;-</span> dat_nights <span class="sc">%&gt;%</span></span>
<span id="cb360-2"><a href="#cb360-2" aria-hidden="true" tabindex="-1"></a> dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">==</span> <span class="fu">unique</span>(ID)[<span class="dv">1</span>],</span>
<span id="cb360-3"><a href="#cb360-3" aria-hidden="true" tabindex="-1"></a>                 night_date <span class="sc">%in%</span> <span class="fu">head</span>(<span class="fu">unique</span>(night_date), <span class="dv">2</span>))</span>
<span id="cb360-4"><a href="#cb360-4" aria-hidden="true" tabindex="-1"></a> res_test <span class="ot">&lt;-</span> test_dat <span class="sc">%&gt;%</span></span>
<span id="cb360-5"><a href="#cb360-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID, night_date) <span class="sc">%&gt;%</span></span>
<span id="cb360-6"><a href="#cb360-6" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">lomb_for_span</span>(.x, <span class="at">max_period_min =</span> MAX_PERIOD_MIN,</span>
<span id="cb360-7"><a href="#cb360-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">ofac =</span> OFAC, <span class="at">detrend =</span> <span class="cn">TRUE</span>,                                       <span class="at">round_minutes =</span> ROUND_MINUTES)) <span class="sc">%&gt;%</span></span>
<span id="cb360-8"><a href="#cb360-8" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb360-9"><a href="#cb360-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">print</span>(<span class="fu">head</span>(res_test, <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   ID    night_date period_minutes     power
   &lt;chr&gt; &lt;date&gt;              &lt;dbl&gt;     &lt;dbl&gt;
 1 102   2024-03-11           10   0.0000758
 2 102   2024-03-11           10.0 0.000125 
 3 102   2024-03-11           10.0 0.000188 
 4 102   2024-03-11           10.0 0.000147 
 5 102   2024-03-11           10.1 0.000118 
 6 102   2024-03-11           10.1 0.000114 
 7 102   2024-03-11           10.1 0.000245 
 8 102   2024-03-11           10.1 0.000341 
 9 102   2024-03-11           10.1 0.000481 
10 102   2024-03-11           10.1 0.000324 </code></pre>
</div>
</div>
<p><strong>Description:</strong> Compute for all IDs and Nights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb362"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb362-1"><a href="#cb362-1" aria-hidden="true" tabindex="-1"></a> out_dir <span class="ot">&lt;-</span> <span class="st">"lomb_per_person"</span></span>
<span id="cb362-2"><a href="#cb362-2" aria-hidden="true" tabindex="-1"></a> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir)) <span class="fu">dir.create</span>(out_dir)</span>
<span id="cb362-3"><a href="#cb362-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb362-4"><a href="#cb362-4" aria-hidden="true" tabindex="-1"></a> all_ids <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat_nights<span class="sc">$</span>ID))</span>
<span id="cb362-5"><a href="#cb362-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb362-6"><a href="#cb362-6" aria-hidden="true" tabindex="-1"></a> <span class="cf">for</span> (id <span class="cf">in</span> all_ids) {</span>
<span id="cb362-7"><a href="#cb362-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">message</span>(<span class="st">"Berechne ID = "</span>, id)</span>
<span id="cb362-8"><a href="#cb362-8" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb362-9"><a href="#cb362-9" aria-hidden="true" tabindex="-1"></a>   res_by_night <span class="ot">&lt;-</span> dat_nights <span class="sc">%&gt;%</span></span>
<span id="cb362-10"><a href="#cb362-10" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">==</span> id) <span class="sc">%&gt;%</span></span>
<span id="cb362-11"><a href="#cb362-11" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID, night_date) <span class="sc">%&gt;%</span></span>
<span id="cb362-12"><a href="#cb362-12" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">group_modify</span>(<span class="sc">~</span> <span class="fu">lomb_for_span</span>(.x, <span class="at">max_period_min =</span> MAX_PERIOD_MIN,</span>
<span id="cb362-13"><a href="#cb362-13" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">ofac =</span> OFAC, <span class="at">detrend =</span> <span class="cn">TRUE</span>,</span>
<span id="cb362-14"><a href="#cb362-14" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">round_minutes =</span> ROUND_MINUTES)) <span class="sc">%&gt;%</span></span>
<span id="cb362-15"><a href="#cb362-15" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb362-16"><a href="#cb362-16" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb362-17"><a href="#cb362-17" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="fu">nrow</span>(res_by_night) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb362-18"><a href="#cb362-18" aria-hidden="true" tabindex="-1"></a>     <span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">results =</span> <span class="fu">tibble</span>(), <span class="at">summary =</span> <span class="fu">tibble</span>(), <span class="at">peaks =</span> <span class="fu">tibble</span>()),</span>
<span id="cb362-19"><a href="#cb362-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">file =</span> <span class="fu">file.path</span>(out_dir, <span class="fu">paste0</span>(<span class="st">"lomb_ID_"</span>, id, <span class="st">".rds"</span>)))</span>
<span id="cb362-20"><a href="#cb362-20" aria-hidden="true" tabindex="-1"></a>     <span class="cf">next</span></span>
<span id="cb362-21"><a href="#cb362-21" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb362-22"><a href="#cb362-22" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb362-23"><a href="#cb362-23" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Per-ID: mean spectrum per night</span></span>
<span id="cb362-24"><a href="#cb362-24" aria-hidden="true" tabindex="-1"></a>   summary_id <span class="ot">&lt;-</span> res_by_night <span class="sc">%&gt;%</span></span>
<span id="cb362-25"><a href="#cb362-25" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID, period_minutes) <span class="sc">%&gt;%</span></span>
<span id="cb362-26"><a href="#cb362-26" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_power =</span> <span class="fu">mean</span>(power, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb362-27"><a href="#cb362-27" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">arrange</span>(period_minutes)</span>
<span id="cb362-28"><a href="#cb362-28" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb362-29"><a href="#cb362-29" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Per-ID: top peak per night</span></span>
<span id="cb362-30"><a href="#cb362-30" aria-hidden="true" tabindex="-1"></a>   peaks_id <span class="ot">&lt;-</span> res_by_night <span class="sc">%&gt;%</span></span>
<span id="cb362-31"><a href="#cb362-31" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID, night_date) <span class="sc">%&gt;%</span></span>
<span id="cb362-32"><a href="#cb362-32" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">slice_max</span>(<span class="at">order_by =</span> power, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb362-33"><a href="#cb362-33" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">peak_period_minutes =</span> period_minutes, <span class="at">peak_power =</span> power) <span class="sc">%&gt;%</span></span>
<span id="cb362-34"><a href="#cb362-34" aria-hidden="true" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb362-35"><a href="#cb362-35" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb362-36"><a href="#cb362-36" aria-hidden="true" tabindex="-1"></a>   <span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">results =</span> res_by_night,</span>
<span id="cb362-37"><a href="#cb362-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">summary =</span> summary_id,</span>
<span id="cb362-38"><a href="#cb362-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">peaks =</span> peaks_id),</span>
<span id="cb362-39"><a href="#cb362-39" aria-hidden="true" tabindex="-1"></a>           <span class="at">file =</span> <span class="fu">file.path</span>(out_dir, <span class="fu">paste0</span>(<span class="st">"lomb_ID_"</span>, id, <span class="st">".rds"</span>)))</span>
<span id="cb362-40"><a href="#cb362-40" aria-hidden="true" tabindex="-1"></a> }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Berechne ID = 102</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Berechne ID = 104</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Berechne ID = 107</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Berechne ID = 108</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Berechne ID = 109</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Berechne ID = 112</code></pre>
</div>
<div class="sourceCode cell-code" id="cb369"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb369-1"><a href="#cb369-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># every night has the same weight</span></span>
<span id="cb369-2"><a href="#cb369-2" aria-hidden="true" tabindex="-1"></a> files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(out_dir, <span class="at">pattern =</span> <span class="st">"^lomb_ID_.*</span><span class="sc">\\</span><span class="st">.rds$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb369-3"><a href="#cb369-3" aria-hidden="true" tabindex="-1"></a> all_results <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(files, <span class="sc">~</span> <span class="fu">readRDS</span>(.x)<span class="sc">$</span>results)</span>
<span id="cb369-4"><a href="#cb369-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb369-5"><a href="#cb369-5" aria-hidden="true" tabindex="-1"></a> pooled_by_night <span class="ot">&lt;-</span> all_results <span class="sc">%&gt;%</span></span>
<span id="cb369-6"><a href="#cb369-6" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">group_by</span>(period_minutes) <span class="sc">%&gt;%</span></span>
<span id="cb369-7"><a href="#cb369-7" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb369-8"><a href="#cb369-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">mean_power =</span> <span class="fu">mean</span>(power, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb369-9"><a href="#cb369-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">n_nights   =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(<span class="fu">paste</span>(ID, night_date)),</span>
<span id="cb369-10"><a href="#cb369-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb369-11"><a href="#cb369-11" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb369-12"><a href="#cb369-12" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">arrange</span>(period_minutes)</span>
<span id="cb369-13"><a href="#cb369-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-14"><a href="#cb369-14" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb369-15"><a href="#cb369-15" aria-hidden="true" tabindex="-1"></a> <span class="co"># plot pooled_by_night </span></span>
<span id="cb369-16"><a href="#cb369-16" aria-hidden="true" tabindex="-1"></a> fit <span class="ot">&lt;-</span> <span class="fu">loess</span>(mean_power <span class="sc">~</span> period_minutes, <span class="at">data =</span> pooled_by_night, <span class="at">span =</span> <span class="fl">0.25</span>)</span>
<span id="cb369-17"><a href="#cb369-17" aria-hidden="true" tabindex="-1"></a> plot_df <span class="ot">&lt;-</span> pooled_by_night <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">power_smooth =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(fit)))</span>
<span id="cb369-18"><a href="#cb369-18" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb369-19"><a href="#cb369-19" aria-hidden="true" tabindex="-1"></a> find_peaks <span class="ot">&lt;-</span> <span class="cf">function</span>(y) { i <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(<span class="fu">diff</span>(y))) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="dv">1</span>; i[<span class="fu">is.finite</span>(y[i])] }</span>
<span id="cb369-20"><a href="#cb369-20" aria-hidden="true" tabindex="-1"></a> pk_idx  <span class="ot">&lt;-</span> <span class="fu">find_peaks</span>(plot_df<span class="sc">$</span>power_smooth)</span>
<span id="cb369-21"><a href="#cb369-21" aria-hidden="true" tabindex="-1"></a> peak_tbl_all <span class="ot">&lt;-</span> plot_df[pk_idx, ] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(power_smooth)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb369-22"><a href="#cb369-22" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb369-23"><a href="#cb369-23" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(period_minutes, mean_power)) <span class="sc">+</span></span>
<span id="cb369-24"><a href="#cb369-24" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb369-25"><a href="#cb369-25" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> power_smooth)) <span class="sc">+</span></span>
<span id="cb369-26"><a href="#cb369-26" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">data =</span> peak_tbl_all, <span class="fu">aes</span>(<span class="at">y =</span> power_smooth), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb369-27"><a href="#cb369-27" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text</span>(<span class="at">data =</span> peak_tbl_all,</span>
<span id="cb369-28"><a href="#cb369-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> power_smooth, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(period_minutes), <span class="st">" min"</span>)),</span>
<span id="cb369-29"><a href="#cb369-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb369-30"><a href="#cb369-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="fu">max</span>(plot_df<span class="sc">$</span>period_minutes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb369-31"><a href="#cb369-31" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Pooled Lomb–Scargle Spectrum (per night)"</span>,</span>
<span id="cb369-32"><a href="#cb369-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="st">"jede Nacht gleich gewichtet · ofac = 4"</span>,</span>
<span id="cb369-33"><a href="#cb369-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> <span class="st">"Periode (Minuten)"</span>, <span class="at">y =</span> <span class="st">"Mean Power"</span>) <span class="sc">+</span></span>
<span id="cb369-34"><a href="#cb369-34" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-153-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb370"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb370-1"><a href="#cb370-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Per-ID summaries </span></span>
<span id="cb370-2"><a href="#cb370-2" aria-hidden="true" tabindex="-1"></a> all_summaries <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(files, <span class="sc">~</span> {</span>
<span id="cb370-3"><a href="#cb370-3" aria-hidden="true" tabindex="-1"></a>   r <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(.x)<span class="sc">$</span>summary</span>
<span id="cb370-4"><a href="#cb370-4" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(r) <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(r) <span class="sc">&gt;</span> <span class="dv">0</span>) r <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb370-5"><a href="#cb370-5" aria-hidden="true" tabindex="-1"></a> })</span>
<span id="cb370-6"><a href="#cb370-6" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb370-7"><a href="#cb370-7" aria-hidden="true" tabindex="-1"></a> <span class="co"># Smoothing + peak detection per ID </span></span>
<span id="cb370-8"><a href="#cb370-8" aria-hidden="true" tabindex="-1"></a> lomb_per_id <span class="ot">&lt;-</span> all_summaries <span class="sc">%&gt;%</span></span>
<span id="cb370-9"><a href="#cb370-9" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb370-10"><a href="#cb370-10" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb370-11"><a href="#cb370-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">power_smooth =</span> <span class="fu">as.numeric</span>(</span>
<span id="cb370-12"><a href="#cb370-12" aria-hidden="true" tabindex="-1"></a>       <span class="fu">predict</span>(<span class="fu">loess</span>(mean_power <span class="sc">~</span> period_minutes, <span class="at">span =</span> <span class="fl">0.25</span>))</span>
<span id="cb370-13"><a href="#cb370-13" aria-hidden="true" tabindex="-1"></a>     ),</span>
<span id="cb370-14"><a href="#cb370-14" aria-hidden="true" tabindex="-1"></a>     <span class="co"># local peaks within each ID</span></span>
<span id="cb370-15"><a href="#cb370-15" aria-hidden="true" tabindex="-1"></a>     <span class="at">peak_idx =</span> { idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(<span class="fu">diff</span>(power_smooth))) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb370-16"><a href="#cb370-16" aria-hidden="true" tabindex="-1"></a>     i <span class="ot">&lt;-</span> idx[<span class="fu">is.finite</span>(power_smooth[idx])]</span>
<span id="cb370-17"><a href="#cb370-17" aria-hidden="true" tabindex="-1"></a>     period_minutes <span class="sc">%in%</span> period_minutes[i] }</span>
<span id="cb370-18"><a href="#cb370-18" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">%&gt;%</span></span>
<span id="cb370-19"><a href="#cb370-19" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb370-20"><a href="#cb370-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb370-21"><a href="#cb370-21" aria-hidden="true" tabindex="-1"></a> peak_tbl <span class="ot">&lt;-</span> lomb_per_id <span class="sc">%&gt;%</span></span>
<span id="cb370-22"><a href="#cb370-22" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(peak_idx) <span class="sc">%&gt;%</span></span>
<span id="cb370-23"><a href="#cb370-23" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb370-24"><a href="#cb370-24" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(power_smooth)) <span class="sc">%&gt;%</span></span>
<span id="cb370-25"><a href="#cb370-25" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span>      <span class="co"># top 3 peaks per ID</span></span>
<span id="cb370-26"><a href="#cb370-26" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Plot faceted by ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb371"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb371-1"><a href="#cb371-1" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(lomb_per_id, <span class="fu">aes</span>(period_minutes, mean_power, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb371-2"><a href="#cb371-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb371-3"><a href="#cb371-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> power_smooth), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb371-4"><a href="#cb371-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">data =</span> peak_tbl, <span class="fu">aes</span>(<span class="at">y =</span> power_smooth, <span class="at">color =</span> ID), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb371-5"><a href="#cb371-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(lomb_per_id<span class="sc">$</span>period_minutes, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">by =</span> <span class="dv">50</span>))<span class="sc">+</span></span>
<span id="cb371-6"><a href="#cb371-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_text_repel</span>(</span>
<span id="cb371-7"><a href="#cb371-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> peak_tbl,</span>
<span id="cb371-8"><a href="#cb371-8" aria-hidden="true" tabindex="-1"></a>     <span class="fu">aes</span>(<span class="at">y =</span> power_smooth, <span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(period_minutes), <span class="st">" min"</span>), <span class="at">color =</span> ID),</span>
<span id="cb371-9"><a href="#cb371-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">angle =</span> <span class="dv">0</span>,</span>
<span id="cb371-10"><a href="#cb371-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb371-11"><a href="#cb371-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">nudge_y =</span> <span class="fl">0.05</span>,</span>
<span id="cb371-12"><a href="#cb371-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">min.segment.length =</span> <span class="dv">0</span>  <span class="co"># optional: draw line if text is moved</span></span>
<span id="cb371-13"><a href="#cb371-13" aria-hidden="true" tabindex="-1"></a>   )<span class="sc">+</span></span>
<span id="cb371-14"><a href="#cb371-14" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb371-15"><a href="#cb371-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(</span>
<span id="cb371-16"><a href="#cb371-16" aria-hidden="true" tabindex="-1"></a>     <span class="at">title =</span> <span class="st">"Lomb-Scargle Spectrum per ID"</span>,</span>
<span id="cb371-17"><a href="#cb371-17" aria-hidden="true" tabindex="-1"></a>     <span class="at">x =</span> <span class="st">"Periode (Minuten)"</span>, <span class="at">y =</span> <span class="st">"Mean Power"</span></span>
<span id="cb371-18"><a href="#cb371-18" aria-hidden="true" tabindex="-1"></a>   ) <span class="sc">+</span></span>
<span id="cb371-19"><a href="#cb371-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb371-20"><a href="#cb371-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">facet_wrap</span>(<span class="sc">~</span>ID)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-154-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Description:</strong> Check how many Nights were Included into Analysis</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb372"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb372-1"><a href="#cb372-1" aria-hidden="true" tabindex="-1"></a>night_counts <span class="ot">&lt;-</span> dat_nights <span class="sc">%&gt;%</span></span>
<span id="cb372-2"><a href="#cb372-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb372-3"><a href="#cb372-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n_nights =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(night_date),</span>
<span id="cb372-4"><a href="#cb372-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb372-5"><a href="#cb372-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-6"><a href="#cb372-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(night_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  ID    n_nights
  &lt;chr&gt;    &lt;int&gt;
1 102        270
2 104        320
3 107        193
4 108         42
5 109        157
6 112        241</code></pre>
</div>
</div>
</section>
<section id="wavelet" class="level3">
<h3 class="anchored" data-anchor-id="wavelet">Wavelet</h3>
<p><strong>Description:</strong> Install and Load packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb374"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb374-1"><a href="#cb374-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"zoo"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb374-2"><a href="#cb374-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"zoo"</span>)</span>
<span id="cb374-3"><a href="#cb374-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb374-4"><a href="#cb374-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"biwavelet"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb374-5"><a href="#cb374-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"biwavelet"</span>)</span>
<span id="cb374-6"><a href="#cb374-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb374-7"><a href="#cb374-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"gridExtra"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb374-8"><a href="#cb374-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"gridExtra"</span>)</span>
<span id="cb374-9"><a href="#cb374-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb374-10"><a href="#cb374-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"viridis"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb374-11"><a href="#cb374-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"viridis"</span>)</span>
<span id="cb374-12"><a href="#cb374-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb374-13"><a href="#cb374-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="sourceCode cell-code" id="cb377"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb377-1"><a href="#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biwavelet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>biwavelet 0.20.22 loaded.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'biwavelet'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    arrow</code></pre>
</div>
<div class="sourceCode cell-code" id="cb381"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb381-1"><a href="#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb384"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb384-1"><a href="#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: viridisLite</code></pre>
</div>
</div>
<p><strong>Description:</strong> Helper Functions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb386"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb386-1"><a href="#cb386-1" aria-hidden="true" tabindex="-1"></a>PER_MIN <span class="ot">&lt;-</span> <span class="dv">10</span>     <span class="co"># min. period</span></span>
<span id="cb386-2"><a href="#cb386-2" aria-hidden="true" tabindex="-1"></a>PER_MAX <span class="ot">&lt;-</span> <span class="dv">180</span>    <span class="co"># max. period</span></span>
<span id="cb386-3"><a href="#cb386-3" aria-hidden="true" tabindex="-1"></a>DJ      <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>   <span class="co"># resolution</span></span>
<span id="cb386-4"><a href="#cb386-4" aria-hidden="true" tabindex="-1"></a>STEP    <span class="ot">&lt;-</span> <span class="dv">5</span>      <span class="co"># Zielraster Minuten</span></span>
<span id="cb386-5"><a href="#cb386-5" aria-hidden="true" tabindex="-1"></a>MINPTS  <span class="ot">&lt;-</span> <span class="dv">60</span>     <span class="co"># min measurement points</span></span>
<span id="cb386-6"><a href="#cb386-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-7"><a href="#cb386-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-8"><a href="#cb386-8" aria-hidden="true" tabindex="-1"></a><span class="co"># prepare night: 5-min frame, interpolation, t_min, detrend + center</span></span>
<span id="cb386-9"><a href="#cb386-9" aria-hidden="true" tabindex="-1"></a>prep_night_series <span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">tz =</span> <span class="st">"Europe/Berlin"</span>, <span class="at">step_min =</span> STEP,</span>
<span id="cb386-10"><a href="#cb386-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">detrend =</span> <span class="cn">TRUE</span>, <span class="at">center =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb386-11"><a href="#cb386-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"Glucose (mg/dl)"</span> <span class="sc">%in%</span> <span class="fu">names</span>(df)) df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(df, <span class="at">glucose =</span> <span class="st">`</span><span class="at">Glucose (mg/dl)</span><span class="st">`</span>)</span>
<span id="cb386-12"><a href="#cb386-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"Timestamp"</span>,<span class="st">"glucose"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(df)))</span>
<span id="cb386-13"><a href="#cb386-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(df<span class="sc">$</span>Timestamp, <span class="st">"POSIXct"</span>))</span>
<span id="cb386-14"><a href="#cb386-14" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(df, <span class="at">Timestamp =</span> <span class="fu">as.POSIXct</span>(Timestamp, <span class="at">tz =</span> tz))</span>
<span id="cb386-15"><a href="#cb386-15" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Timestamp), <span class="sc">!</span><span class="fu">is.na</span>(glucose)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(Timestamp)</span>
<span id="cb386-16"><a href="#cb386-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(df) <span class="sc">&lt;</span> <span class="dv">8</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb386-17"><a href="#cb386-17" aria-hidden="true" tabindex="-1"></a>  t0 <span class="ot">&lt;-</span> df<span class="sc">$</span>Timestamp[<span class="dv">1</span>]; t1 <span class="ot">&lt;-</span> df<span class="sc">$</span>Timestamp[<span class="fu">nrow</span>(df)]</span>
<span id="cb386-18"><a href="#cb386-18" aria-hidden="true" tabindex="-1"></a>  grid <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">Timestamp =</span> <span class="fu">seq</span>(t0, t1, <span class="at">by =</span> <span class="fu">paste</span>(step_min, <span class="st">"min"</span>)))</span>
<span id="cb386-19"><a href="#cb386-19" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> grid <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(df, <span class="at">by =</span> <span class="st">"Timestamp"</span>)</span>
<span id="cb386-20"><a href="#cb386-20" aria-hidden="true" tabindex="-1"></a>  x<span class="sc">$</span>glucose <span class="ot">&lt;-</span> zoo<span class="sc">::</span><span class="fu">na.approx</span>(x<span class="sc">$</span>glucose, x<span class="sc">$</span>Timestamp, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">rule =</span> <span class="dv">2</span>)</span>
<span id="cb386-21"><a href="#cb386-21" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(glucose))</span>
<span id="cb386-22"><a href="#cb386-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(x) <span class="sc">&lt;</span> <span class="dv">16</span>) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb386-23"><a href="#cb386-23" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">t_min =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(Timestamp, dplyr<span class="sc">::</span><span class="fu">first</span>(Timestamp), <span class="at">units =</span> <span class="st">"mins"</span>)))</span>
<span id="cb386-24"><a href="#cb386-24" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> x<span class="sc">$</span>glucose</span>
<span id="cb386-25"><a href="#cb386-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (detrend) y <span class="ot">&lt;-</span> <span class="fu">resid</span>(<span class="fu">lm</span>(y <span class="sc">~</span> t_min, <span class="at">data =</span> x))</span>
<span id="cb386-26"><a href="#cb386-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (center)  y <span class="ot">&lt;-</span> y <span class="sc">-</span> <span class="fu">mean</span>(y, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb386-27"><a href="#cb386-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">df =</span> x, <span class="at">y =</span> y)</span>
<span id="cb386-28"><a href="#cb386-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb386-29"><a href="#cb386-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-30"><a href="#cb386-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Wavelet (biwavelet::wt), periods in minutes</span></span>
<span id="cb386-31"><a href="#cb386-31" aria-hidden="true" tabindex="-1"></a>wavelet_for_night <span class="ot">&lt;-</span> <span class="cf">function</span>(t_min, y, <span class="at">period_min =</span> PER_MIN, <span class="at">period_max =</span> PER_MAX,</span>
<span id="cb386-32"><a href="#cb386-32" aria-hidden="true" tabindex="-1"></a>                              <span class="at">dj =</span> DJ, <span class="at">mother =</span> <span class="st">"morlet"</span>) {</span>
<span id="cb386-33"><a href="#cb386-33" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">t =</span> t_min, <span class="at">y =</span> y)</span>
<span id="cb386-34"><a href="#cb386-34" aria-hidden="true" tabindex="-1"></a>  s0  <span class="ot">&lt;-</span> period_min</span>
<span id="cb386-35"><a href="#cb386-35" aria-hidden="true" tabindex="-1"></a>  J1  <span class="ot">&lt;-</span> <span class="fu">floor</span>(<span class="fu">log2</span>(period_max <span class="sc">/</span> period_min) <span class="sc">/</span> dj)</span>
<span id="cb386-36"><a href="#cb386-36" aria-hidden="true" tabindex="-1"></a>  biwavelet<span class="sc">::</span><span class="fu">wt</span>(dat, <span class="at">dj =</span> dj, <span class="at">s0 =</span> s0, <span class="at">J1 =</span> J1, <span class="at">mother =</span> mother)</span>
<span id="cb386-37"><a href="#cb386-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb386-38"><a href="#cb386-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-39"><a href="#cb386-39" aria-hidden="true" tabindex="-1"></a><span class="co"># GWS (Global Wavelet Spectrum) inside COI</span></span>
<span id="cb386-40"><a href="#cb386-40" aria-hidden="true" tabindex="-1"></a>gws_from_wt <span class="ot">&lt;-</span> <span class="cf">function</span>(wt, <span class="at">per_min =</span> PER_MIN, <span class="at">per_max =</span> PER_MAX) {</span>
<span id="cb386-41"><a href="#cb386-41" aria-hidden="true" tabindex="-1"></a>  period <span class="ot">&lt;-</span> wt<span class="sc">$</span>period; coi <span class="ot">&lt;-</span> wt<span class="sc">$</span>coi; P <span class="ot">&lt;-</span> wt<span class="sc">$</span>power</span>
<span id="cb386-42"><a href="#cb386-42" aria-hidden="true" tabindex="-1"></a>  inside <span class="ot">&lt;-</span> <span class="fu">outer</span>(period, coi, <span class="cf">function</span>(p, c) p <span class="sc">&lt;=</span> c)</span>
<span id="cb386-43"><a href="#cb386-43" aria-hidden="true" tabindex="-1"></a>  P_inside <span class="ot">&lt;-</span> P; P_inside[<span class="sc">!</span>inside] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb386-44"><a href="#cb386-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">period =</span> period,</span>
<span id="cb386-45"><a href="#cb386-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">power  =</span> <span class="fu">rowMeans</span>(P_inside, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb386-46"><a href="#cb386-46" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">between</span>(period, per_min, per_max))</span>
<span id="cb386-47"><a href="#cb386-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb386-48"><a href="#cb386-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb386-49"><a href="#cb386-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Peak-finder </span></span>
<span id="cb386-50"><a href="#cb386-50" aria-hidden="true" tabindex="-1"></a>find_peaks_simple <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y, <span class="at">top_n =</span> <span class="dv">3</span>, <span class="at">min_sep =</span> <span class="dv">12</span>) {</span>
<span id="cb386-51"><a href="#cb386-51" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">diff</span>(<span class="fu">sign</span>(<span class="fu">diff</span>(y))) <span class="sc">==</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb386-52"><a href="#cb386-52" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> idx[<span class="fu">is.finite</span>(y[idx])]</span>
<span id="cb386-53"><a href="#cb386-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(idx)) <span class="fu">return</span>(<span class="fu">integer</span>(<span class="dv">0</span>))</span>
<span id="cb386-54"><a href="#cb386-54" aria-hidden="true" tabindex="-1"></a>  ord <span class="ot">&lt;-</span> idx[<span class="fu">order</span>(y[idx], <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb386-55"><a href="#cb386-55" aria-hidden="true" tabindex="-1"></a>  sel <span class="ot">&lt;-</span> <span class="fu">integer</span>(<span class="dv">0</span>)</span>
<span id="cb386-56"><a href="#cb386-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> ord) {</span>
<span id="cb386-57"><a href="#cb386-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(sel) <span class="sc">||</span> <span class="fu">all</span>(<span class="fu">abs</span>(x[i] <span class="sc">-</span> x[sel]) <span class="sc">&gt;=</span> min_sep)) sel <span class="ot">&lt;-</span> <span class="fu">c</span>(sel, i)</span>
<span id="cb386-58"><a href="#cb386-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(sel) <span class="sc">&gt;=</span> top_n) <span class="cf">break</span></span>
<span id="cb386-59"><a href="#cb386-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb386-60"><a href="#cb386-60" aria-hidden="true" tabindex="-1"></a>  sel</span>
<span id="cb386-61"><a href="#cb386-61" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Dates to Nights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb387"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb387-1"><a href="#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">exists</span>(<span class="st">"cleaned_data_deduplicated"</span>))</span>
<span id="cb387-2"><a href="#cb387-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> cleaned_data_deduplicated <span class="sc">%&gt;%</span></span>
<span id="cb387-3"><a href="#cb387-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb387-4"><a href="#cb387-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Timestamp =</span> <span class="fu">as.POSIXct</span>(Timestamp, <span class="at">tz =</span> <span class="st">"Europe/Berlin"</span>),</span>
<span id="cb387-5"><a href="#cb387-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Hour =</span> lubridate<span class="sc">::</span><span class="fu">hour</span>(Timestamp),</span>
<span id="cb387-6"><a href="#cb387-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">night_date =</span> dplyr<span class="sc">::</span><span class="fu">if_else</span>(Hour <span class="sc">&gt;=</span> <span class="dv">22</span>, <span class="fu">as.Date</span>(Timestamp), <span class="fu">as.Date</span>(Timestamp) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb387-7"><a href="#cb387-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb387-8"><a href="#cb387-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Hour <span class="sc">&gt;=</span> <span class="dv">22</span> <span class="sc">|</span> Hour <span class="sc">&lt;</span> <span class="dv">6</span>)</span>
<span id="cb387-9"><a href="#cb387-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-10"><a href="#cb387-10" aria-hidden="true" tabindex="-1"></a>dat_nights <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb387-11"><a href="#cb387-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID, night_date) <span class="sc">%&gt;%</span></span>
<span id="cb387-12"><a href="#cb387-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(dplyr<span class="sc">::</span><span class="fu">n</span>() <span class="sc">&gt;=</span> MINPTS) <span class="sc">%&gt;%</span></span>
<span id="cb387-13"><a href="#cb387-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb387-14"><a href="#cb387-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-15"><a href="#cb387-15" aria-hidden="true" tabindex="-1"></a><span class="co"># save GWS per ID</span></span>
<span id="cb387-16"><a href="#cb387-16" aria-hidden="true" tabindex="-1"></a>out_dir <span class="ot">&lt;-</span> <span class="st">"wavelet_per_person"</span></span>
<span id="cb387-17"><a href="#cb387-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(out_dir)) <span class="fu">dir.create</span>(out_dir)</span>
<span id="cb387-18"><a href="#cb387-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb387-19"><a href="#cb387-19" aria-hidden="true" tabindex="-1"></a>all_ids <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(dat_nights<span class="sc">$</span>ID))</span>
<span id="cb387-20"><a href="#cb387-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (id <span class="cf">in</span> all_ids) {</span>
<span id="cb387-21"><a href="#cb387-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Wavelet: ID = "</span>, id)</span>
<span id="cb387-22"><a href="#cb387-22" aria-hidden="true" tabindex="-1"></a>  nights_id <span class="ot">&lt;-</span> dat_nights <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">==</span> id) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">group_split</span>(night_date)</span>
<span id="cb387-23"><a href="#cb387-23" aria-hidden="true" tabindex="-1"></a>  gws_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(nights_id))</span>
<span id="cb387-24"><a href="#cb387-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_along</span>(nights_id)) {</span>
<span id="cb387-25"><a href="#cb387-25" aria-hidden="true" tabindex="-1"></a>    night_df <span class="ot">&lt;-</span> nights_id[[k]]</span>
<span id="cb387-26"><a href="#cb387-26" aria-hidden="true" tabindex="-1"></a>    nd <span class="ot">&lt;-</span> <span class="fu">unique</span>(night_df<span class="sc">$</span>night_date)</span>
<span id="cb387-27"><a href="#cb387-27" aria-hidden="true" tabindex="-1"></a>    prep <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">prep_night_series</span>(night_df), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb387-28"><a href="#cb387-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(prep)) { gws_list[[k]] <span class="ot">&lt;-</span> <span class="cn">NULL</span>; <span class="cf">next</span> }</span>
<span id="cb387-29"><a href="#cb387-29" aria-hidden="true" tabindex="-1"></a>    wt <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">wavelet_for_night</span>(prep<span class="sc">$</span>df<span class="sc">$</span>t_min, prep<span class="sc">$</span>y), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb387-30"><a href="#cb387-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(wt))  { gws_list[[k]] <span class="ot">&lt;-</span> <span class="cn">NULL</span>; <span class="cf">next</span> }</span>
<span id="cb387-31"><a href="#cb387-31" aria-hidden="true" tabindex="-1"></a>    gws <span class="ot">&lt;-</span> <span class="fu">gws_from_wt</span>(wt) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ID =</span> id, <span class="at">night_date =</span> nd)</span>
<span id="cb387-32"><a href="#cb387-32" aria-hidden="true" tabindex="-1"></a>    gws_list[[k]] <span class="ot">&lt;-</span> gws</span>
<span id="cb387-33"><a href="#cb387-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb387-34"><a href="#cb387-34" aria-hidden="true" tabindex="-1"></a>  gws_id <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">list_rbind</span>(gws_list)</span>
<span id="cb387-35"><a href="#cb387-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(gws_id) <span class="sc">||</span> <span class="fu">nrow</span>(gws_id) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb387-36"><a href="#cb387-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">gws_nights =</span> <span class="fu">tibble</span>(), <span class="at">gws_pooled =</span> <span class="fu">tibble</span>()),</span>
<span id="cb387-37"><a href="#cb387-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="fu">file.path</span>(out_dir, <span class="fu">paste0</span>(<span class="st">"wavelet_ID_"</span>, id, <span class="st">".rds"</span>)))</span>
<span id="cb387-38"><a href="#cb387-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">next</span></span>
<span id="cb387-39"><a href="#cb387-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb387-40"><a href="#cb387-40" aria-hidden="true" tabindex="-1"></a>  gws_pooled <span class="ot">&lt;-</span> gws_id <span class="sc">%&gt;%</span></span>
<span id="cb387-41"><a href="#cb387-41" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID, period) <span class="sc">%&gt;%</span></span>
<span id="cb387-42"><a href="#cb387-42" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_power =</span> <span class="fu">mean</span>(power, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb387-43"><a href="#cb387-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_nights   =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(night_date),</span>
<span id="cb387-44"><a href="#cb387-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">arrange</span>(period)</span>
<span id="cb387-45"><a href="#cb387-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">gws_nights =</span> gws_id, <span class="at">gws_pooled =</span> gws_pooled),</span>
<span id="cb387-46"><a href="#cb387-46" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="fu">file.path</span>(out_dir, <span class="fu">paste0</span>(<span class="st">"wavelet_ID_"</span>, id, <span class="st">".rds"</span>)))</span>
<span id="cb387-47"><a href="#cb387-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Wavelet: ID = 102</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Wavelet: ID = 104</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Wavelet: ID = 107</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Wavelet: ID = 108</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Wavelet: ID = 109</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Wavelet: ID = 112</code></pre>
</div>
</div>
<p><strong>Description:</strong> Aggregation across all IDs and Nights</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb394"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb394-1"><a href="#cb394-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">list.files</span>(out_dir, <span class="at">pattern =</span> <span class="st">"^wavelet_ID_.*</span><span class="sc">\\</span><span class="st">.rds$"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb394-2"><a href="#cb394-2" aria-hidden="true" tabindex="-1"></a>all_gws_nights <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(files, <span class="sc">~</span> <span class="fu">readRDS</span>(.x)<span class="sc">$</span>gws_nights)</span>
<span id="cb394-3"><a href="#cb394-3" aria-hidden="true" tabindex="-1"></a>all_gws_pooled <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(files, <span class="sc">~</span> <span class="fu">readRDS</span>(.x)<span class="sc">$</span>gws_pooled)</span>
<span id="cb394-4"><a href="#cb394-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb394-5"><a href="#cb394-5" aria-hidden="true" tabindex="-1"></a>gws_pooled_all <span class="ot">&lt;-</span> all_gws_nights <span class="sc">%&gt;%</span></span>
<span id="cb394-6"><a href="#cb394-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(period) <span class="sc">%&gt;%</span></span>
<span id="cb394-7"><a href="#cb394-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_power =</span> <span class="fu">mean</span>(power, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb394-8"><a href="#cb394-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_nights   =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(<span class="fu">paste</span>(ID, night_date)),</span>
<span id="cb394-9"><a href="#cb394-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb394-10"><a href="#cb394-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(period)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Pooled Heatmap and GWS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb395"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb395-1"><a href="#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nights as GWS → pooled Heatmap inside COI</span></span>
<span id="cb395-2"><a href="#cb395-2" aria-hidden="true" tabindex="-1"></a>wt_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb395-3"><a href="#cb395-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (g <span class="cf">in</span> dat_nights <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">group_split</span>(ID, night_date)) {</span>
<span id="cb395-4"><a href="#cb395-4" aria-hidden="true" tabindex="-1"></a>  prep <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">prep_night_series</span>(g), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb395-5"><a href="#cb395-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(prep)) <span class="cf">next</span></span>
<span id="cb395-6"><a href="#cb395-6" aria-hidden="true" tabindex="-1"></a>  wt <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>(<span class="fu">wavelet_for_night</span>(prep<span class="sc">$</span>df<span class="sc">$</span>t_min, prep<span class="sc">$</span>y), <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NULL</span>)</span>
<span id="cb395-7"><a href="#cb395-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(wt)) <span class="cf">next</span></span>
<span id="cb395-8"><a href="#cb395-8" aria-hidden="true" tabindex="-1"></a>  wt_list[[<span class="fu">length</span>(wt_list)<span class="sc">+</span><span class="dv">1</span>]] <span class="ot">&lt;-</span> wt</span>
<span id="cb395-9"><a href="#cb395-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb395-10"><a href="#cb395-10" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">length</span>(wt_list) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb395-11"><a href="#cb395-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-12"><a href="#cb395-12" aria-hidden="true" tabindex="-1"></a>period_ref <span class="ot">&lt;-</span> wt_list[[<span class="dv">1</span>]]<span class="sc">$</span>period</span>
<span id="cb395-13"><a href="#cb395-13" aria-hidden="true" tabindex="-1"></a>step_min   <span class="ot">&lt;-</span> <span class="fu">median</span>(<span class="fu">diff</span>(wt_list[[<span class="dv">1</span>]]<span class="sc">$</span>t))   <span class="co"># ≈ STEP</span></span>
<span id="cb395-14"><a href="#cb395-14" aria-hidden="true" tabindex="-1"></a>T_common   <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">vapply</span>(wt_list, <span class="cf">function</span>(w) <span class="fu">max</span>(w<span class="sc">$</span>t), <span class="fu">numeric</span>(<span class="dv">1</span>)))</span>
<span id="cb395-15"><a href="#cb395-15" aria-hidden="true" tabindex="-1"></a>t_common   <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, T_common, <span class="at">by =</span> step_min)</span>
<span id="cb395-16"><a href="#cb395-16" aria-hidden="true" tabindex="-1"></a>nP <span class="ot">&lt;-</span> <span class="fu">length</span>(period_ref); nT <span class="ot">&lt;-</span> <span class="fu">length</span>(t_common)</span>
<span id="cb395-17"><a href="#cb395-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-18"><a href="#cb395-18" aria-hidden="true" tabindex="-1"></a>sum_power <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nP, <span class="at">ncol =</span> nT)</span>
<span id="cb395-19"><a href="#cb395-19" aria-hidden="true" tabindex="-1"></a>cnt_power <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> nP, <span class="at">ncol =</span> nT)</span>
<span id="cb395-20"><a href="#cb395-20" aria-hidden="true" tabindex="-1"></a>coi_pool  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">Inf</span>, nT)</span>
<span id="cb395-21"><a href="#cb395-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-22"><a href="#cb395-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (w <span class="cf">in</span> wt_list) {</span>
<span id="cb395-23"><a href="#cb395-23" aria-hidden="true" tabindex="-1"></a>  idx_t <span class="ot">&lt;-</span> <span class="fu">which</span>(w<span class="sc">$</span>t <span class="sc">&lt;=</span> T_common)</span>
<span id="cb395-24"><a href="#cb395-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(idx_t) <span class="sc">==</span> nT)</span>
<span id="cb395-25"><a href="#cb395-25" aria-hidden="true" tabindex="-1"></a>  Psub   <span class="ot">&lt;-</span> w<span class="sc">$</span>power[, idx_t, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb395-26"><a href="#cb395-26" aria-hidden="true" tabindex="-1"></a>  coisub <span class="ot">&lt;-</span> w<span class="sc">$</span>coi[idx_t]</span>
<span id="cb395-27"><a href="#cb395-27" aria-hidden="true" tabindex="-1"></a>  inside <span class="ot">&lt;-</span> <span class="fu">outer</span>(period_ref, coisub, <span class="cf">function</span>(p, c) p <span class="sc">&lt;=</span> c)</span>
<span id="cb395-28"><a href="#cb395-28" aria-hidden="true" tabindex="-1"></a>  Psub[<span class="sc">!</span>inside] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb395-29"><a href="#cb395-29" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.na</span>(Psub); Psub[<span class="sc">!</span>ok] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb395-30"><a href="#cb395-30" aria-hidden="true" tabindex="-1"></a>  sum_power <span class="ot">&lt;-</span> sum_power <span class="sc">+</span> Psub</span>
<span id="cb395-31"><a href="#cb395-31" aria-hidden="true" tabindex="-1"></a>  cnt_power <span class="ot">&lt;-</span> cnt_power <span class="sc">+</span> ok</span>
<span id="cb395-32"><a href="#cb395-32" aria-hidden="true" tabindex="-1"></a>  coi_pool  <span class="ot">&lt;-</span> <span class="fu">pmin</span>(coi_pool, coisub)</span>
<span id="cb395-33"><a href="#cb395-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb395-34"><a href="#cb395-34" aria-hidden="true" tabindex="-1"></a>mean_power_mat <span class="ot">&lt;-</span> sum_power <span class="sc">/</span> cnt_power</span>
<span id="cb395-35"><a href="#cb395-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-36"><a href="#cb395-36" aria-hidden="true" tabindex="-1"></a>keep_p <span class="ot">&lt;-</span> <span class="fu">which</span>(period_ref <span class="sc">&gt;=</span> PER_MIN <span class="sc">&amp;</span> period_ref <span class="sc">&lt;=</span> PER_MAX)</span>
<span id="cb395-37"><a href="#cb395-37" aria-hidden="true" tabindex="-1"></a>df_pool <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">time =</span> t_common, <span class="at">period =</span> period_ref[keep_p])</span>
<span id="cb395-38"><a href="#cb395-38" aria-hidden="true" tabindex="-1"></a>df_pool<span class="sc">$</span>power <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(mean_power_mat[keep_p, , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb395-39"><a href="#cb395-39" aria-hidden="true" tabindex="-1"></a>coi_df_pool <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">time =</span> t_common, <span class="at">coi =</span> coi_pool)</span>
<span id="cb395-40"><a href="#cb395-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-41"><a href="#cb395-41" aria-hidden="true" tabindex="-1"></a>p_left <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df_pool, <span class="fu">aes</span>(time, period, <span class="at">fill =</span> power)) <span class="sc">+</span></span>
<span id="cb395-42"><a href="#cb395-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">interpolate =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb395-43"><a href="#cb395-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> coi_df_pool,</span>
<span id="cb395-44"><a href="#cb395-44" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">ymin =</span> coi, <span class="at">ymax =</span> <span class="fu">max</span>(df_pool<span class="sc">$</span>period)),</span>
<span id="cb395-45"><a href="#cb395-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> <span class="st">"grey90"</span>, <span class="at">alpha =</span> <span class="fl">0.65</span>) <span class="sc">+</span></span>
<span id="cb395-46"><a href="#cb395-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>(<span class="at">name =</span> <span class="st">"Power"</span>, <span class="at">option =</span> <span class="st">"C"</span>, <span class="at">na.value =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb395-47"><a href="#cb395-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb395-48"><a href="#cb395-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Wavelet Power (Morlet) – gepoolt (alle IDs × Nächte)"</span>,</span>
<span id="cb395-49"><a href="#cb395-49" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"grau = außerhalb der COI (unsicher)"</span>,</span>
<span id="cb395-50"><a href="#cb395-50" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Minuten seit Nachtbeginn"</span>, <span class="at">y =</span> <span class="st">"Periode (Minuten)"</span>) <span class="sc">+</span></span>
<span id="cb395-51"><a href="#cb395-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb395-52"><a href="#cb395-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-53"><a href="#cb395-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Global Wavelet Spectrum , smoothed + Peaks</span></span>
<span id="cb395-54"><a href="#cb395-54" aria-hidden="true" tabindex="-1"></a>fit_all <span class="ot">&lt;-</span> <span class="fu">loess</span>(mean_power <span class="sc">~</span> period, <span class="at">data =</span> gws_pooled_all, <span class="at">span =</span> <span class="fl">0.22</span>)</span>
<span id="cb395-55"><a href="#cb395-55" aria-hidden="true" tabindex="-1"></a>plot_all <span class="ot">&lt;-</span> gws_pooled_all <span class="sc">%&gt;%</span></span>
<span id="cb395-56"><a href="#cb395-56" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">power_smooth =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(fit_all)))</span>
<span id="cb395-57"><a href="#cb395-57" aria-hidden="true" tabindex="-1"></a>pk_all <span class="ot">&lt;-</span> {</span>
<span id="cb395-58"><a href="#cb395-58" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">find_peaks_simple</span>(plot_all<span class="sc">$</span>period, plot_all<span class="sc">$</span>power_smooth, <span class="at">top_n =</span> <span class="dv">3</span>, <span class="at">min_sep =</span> <span class="dv">12</span>)</span>
<span id="cb395-59"><a href="#cb395-59" aria-hidden="true" tabindex="-1"></a>  plot_all[idx, ] <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">paste0</span>(<span class="fu">round</span>(period), <span class="st">" min"</span>))</span>
<span id="cb395-60"><a href="#cb395-60" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb395-61"><a href="#cb395-61" aria-hidden="true" tabindex="-1"></a>p_right <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_all, <span class="fu">aes</span>(period, mean_power)) <span class="sc">+</span></span>
<span id="cb395-62"><a href="#cb395-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb395-63"><a href="#cb395-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> power_smooth)) <span class="sc">+</span></span>
<span id="cb395-64"><a href="#cb395-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> pk_all, <span class="fu">aes</span>(<span class="at">y =</span> power_smooth), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb395-65"><a href="#cb395-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> pk_all, <span class="fu">aes</span>(<span class="at">y =</span> power_smooth, <span class="at">label =</span> label), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb395-66"><a href="#cb395-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(PER_MIN, PER_MAX, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb395-67"><a href="#cb395-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Global Wavelet Spectrum – pooled (alle IDs × Nächte)"</span>,</span>
<span id="cb395-68"><a href="#cb395-68" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"jede Nacht gleich gewichtet · nur innerhalb COI"</span>,</span>
<span id="cb395-69"><a href="#cb395-69" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Periode (Minuten)"</span>, <span class="at">y =</span> <span class="st">"Mean Power"</span>) <span class="sc">+</span></span>
<span id="cb395-70"><a href="#cb395-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb395-71"><a href="#cb395-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb395-72"><a href="#cb395-72" aria-hidden="true" tabindex="-1"></a><span class="co"># show and save</span></span>
<span id="cb395-73"><a href="#cb395-73" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p_left, p_right, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-160-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb396"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb396-1"><a href="#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"plots"</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb396-2"><a href="#cb396-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots/wavelet_pooled_heatmap_gws.png"</span>,</span>
<span id="cb396-3"><a href="#cb396-3" aria-hidden="true" tabindex="-1"></a>       gridExtra<span class="sc">::</span><span class="fu">arrangeGrob</span>(p_left, p_right, <span class="at">ncol =</span> <span class="dv">2</span>),</span>
<span id="cb396-4"><a href="#cb396-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">width =</span> <span class="dv">12</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Description:</strong> Plot GWS per ID</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb397"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb397-1"><a href="#cb397-1" aria-hidden="true" tabindex="-1"></a>p_per_id <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(all_gws_pooled, <span class="fu">aes</span>(period, mean_power, <span class="at">color =</span> ID)) <span class="sc">+</span></span>
<span id="cb397-2"><a href="#cb397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb397-3"><a href="#cb397-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(PER_MIN, PER_MAX, <span class="at">by =</span> <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb397-4"><a href="#cb397-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Global Wavelet Spectrum – pro ID (über Nächte gemittelt)"</span>,</span>
<span id="cb397-5"><a href="#cb397-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"jede Nacht gleich gewichtet"</span>,</span>
<span id="cb397-6"><a href="#cb397-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Periode (Minuten)"</span>, <span class="at">y =</span> <span class="st">"Mean Power"</span>) <span class="sc">+</span></span>
<span id="cb397-7"><a href="#cb397-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb397-8"><a href="#cb397-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-9"><a href="#cb397-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(p_per_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Masterarbeit_files/figure-html/unnamed-chunk-161-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb398"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb398-1"><a href="#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  save</span></span>
<span id="cb398-2"><a href="#cb398-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">"plots/wavelet_gws_per_id.png"</span>, p_per_id, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">dpi =</span> <span class="dv">150</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb399"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb399-1"><a href="#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 1) Pooled (all IDs × nights) ----</span></span>
<span id="cb399-2"><a href="#cb399-2" aria-hidden="true" tabindex="-1"></a>fit_all <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(</span>
<span id="cb399-3"><a href="#cb399-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loess</span>(mean_power <span class="sc">~</span> period,</span>
<span id="cb399-4"><a href="#cb399-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">data =</span> gws_pooled_all, <span class="at">span =</span> <span class="fl">0.22</span>,</span>
<span id="cb399-5"><a href="#cb399-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">control =</span> <span class="fu">loess.control</span>(<span class="at">surface =</span> <span class="st">"direct"</span>))</span>
<span id="cb399-6"><a href="#cb399-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb399-7"><a href="#cb399-7" aria-hidden="true" tabindex="-1"></a>plot_all <span class="ot">&lt;-</span> gws_pooled_all <span class="sc">%&gt;%</span></span>
<span id="cb399-8"><a href="#cb399-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(period) <span class="sc">%&gt;%</span></span>
<span id="cb399-9"><a href="#cb399-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">power_smooth =</span> <span class="fu">as.numeric</span>(<span class="fu">predict</span>(fit_all)))</span>
<span id="cb399-10"><a href="#cb399-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb399-11"><a href="#cb399-11" aria-hidden="true" tabindex="-1"></a>idx_all <span class="ot">&lt;-</span> <span class="fu">find_peaks_simple</span>(plot_all<span class="sc">$</span>period, plot_all<span class="sc">$</span>power_smooth,</span>
<span id="cb399-12"><a href="#cb399-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">top_n =</span> <span class="dv">3</span>, <span class="at">min_sep =</span> <span class="dv">12</span>)</span>
<span id="cb399-13"><a href="#cb399-13" aria-hidden="true" tabindex="-1"></a>pooled_peaks <span class="ot">&lt;-</span> plot_all[idx_all, ] <span class="sc">%&gt;%</span></span>
<span id="cb399-14"><a href="#cb399-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(power_smooth)) <span class="sc">%&gt;%</span></span>
<span id="cb399-15"><a href="#cb399-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">peak_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb399-16"><a href="#cb399-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(peak_rank, period, mean_power, power_smooth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb400"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb400-1"><a href="#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- 2) Per ID (averaged over nights within ID) ----</span></span>
<span id="cb400-2"><a href="#cb400-2" aria-hidden="true" tabindex="-1"></a>per_id_smoothed <span class="ot">&lt;-</span> all_gws_pooled <span class="sc">%&gt;%</span></span>
<span id="cb400-3"><a href="#cb400-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(ID, period) <span class="sc">%&gt;%</span></span>
<span id="cb400-4"><a href="#cb400-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb400-5"><a href="#cb400-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb400-6"><a href="#cb400-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">power_smooth =</span> <span class="fu">as.numeric</span>(</span>
<span id="cb400-7"><a href="#cb400-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">predict</span>(</span>
<span id="cb400-8"><a href="#cb400-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">suppressWarnings</span>(</span>
<span id="cb400-9"><a href="#cb400-9" aria-hidden="true" tabindex="-1"></a>          <span class="fu">loess</span>(mean_power <span class="sc">~</span> period, <span class="at">span =</span> <span class="fl">0.22</span>,</span>
<span id="cb400-10"><a href="#cb400-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">control =</span> <span class="fu">loess.control</span>(<span class="at">surface =</span> <span class="st">"direct"</span>))</span>
<span id="cb400-11"><a href="#cb400-11" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb400-12"><a href="#cb400-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb400-13"><a href="#cb400-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb400-14"><a href="#cb400-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb400-15"><a href="#cb400-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span>
<span id="cb400-16"><a href="#cb400-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb400-17"><a href="#cb400-17" aria-hidden="true" tabindex="-1"></a>per_id_peaks <span class="ot">&lt;-</span> per_id_smoothed <span class="sc">%&gt;%</span></span>
<span id="cb400-18"><a href="#cb400-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_split</span>(ID) <span class="sc">%&gt;%</span></span>
<span id="cb400-19"><a href="#cb400-19" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_dfr</span>(<span class="sc">~</span>{</span>
<span id="cb400-20"><a href="#cb400-20" aria-hidden="true" tabindex="-1"></a>    id  <span class="ot">&lt;-</span> <span class="fu">unique</span>(.x<span class="sc">$</span>ID)</span>
<span id="cb400-21"><a href="#cb400-21" aria-hidden="true" tabindex="-1"></a>    idx <span class="ot">&lt;-</span> <span class="fu">find_peaks_simple</span>(.x<span class="sc">$</span>period, .x<span class="sc">$</span>power_smooth, <span class="at">top_n =</span> <span class="dv">3</span>, <span class="at">min_sep =</span> <span class="dv">12</span>)</span>
<span id="cb400-22"><a href="#cb400-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(idx)) <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb400-23"><a href="#cb400-23" aria-hidden="true" tabindex="-1"></a>    .x[idx, ] <span class="sc">%&gt;%</span></span>
<span id="cb400-24"><a href="#cb400-24" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">arrange</span>(dplyr<span class="sc">::</span><span class="fu">desc</span>(power_smooth)) <span class="sc">%&gt;%</span></span>
<span id="cb400-25"><a href="#cb400-25" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">peak_rank =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>(), <span class="at">ID =</span> id, <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb400-26"><a href="#cb400-26" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(ID, peak_rank, period, mean_power, power_smooth)</span>
<span id="cb400-27"><a href="#cb400-27" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>